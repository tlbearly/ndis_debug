function searchInit(){try{var e="Fish species in known fishing spots";document.getElementById("searchLoadingImg").style.display="block";var a=app+"/SearchWidget.xml?v="+ndisVer,t=createXMLhttpRequest();t.onreadystatechange=function(){if(4==t.readyState&&200===t.status){var a=createXMLdoc(t);try{require(["dojo/dom","dijit/registry","dojo/_base/lang","dojo/mouse","dojo/_base/Color","dojo/store/Memory","dijit/form/ComboBox","dijit/form/Select","esri/toolbars/draw","esri/request","esri/tasks/query","esri/tasks/QueryTask","esri/graphic","esri/layers/GraphicsLayer","esri/urlUtils","esri/geometry/Point","esri/symbols/PictureMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/_base/declare","dgrid/OnDemandGrid","dgrid/extensions/DijitRegistry","dgrid/extensions/ColumnResizer","dojo/domReady!"],function(t,s,l,n,r,i,d,o,c,g,m,u,y,h,p,f,E,I,B,b,N,T,v){function x(e){document.getElementById("searchMsg").innerHTML="Loading...",document.getElementById("searchMsg").style.display="block",document.getElementById("searchLoadingImg").style.display="block",drawing=!1,searchtoolbar.deactivate(),document.getElementById("searchpoint").className="graphBtn",document.getElementById("searchpolyline").className="graphBtn",document.getElementById("searchrectangle").className="graphBtn",document.getElementById("searchpolygon").className="graphBtn",document.getElementById("clearSearchGraphics").style.display="inline-block";var a=e.geometry;V(a)}function k(e){var a=ce[he].getElementsByTagName("name")[0]&&ce[he].getElementsByTagName("name")[0].childNodes[0]?ce[he].getElementsByTagName("name")[0].childNodes[0].nodeValue:"undefined";alert("WARNING: In SearchWidget.xml file required value missing for tag: "+e+", in layer: "+a+".","Data Error"),document.getElementById("searchLoadingImg").style.display="none"}function w(e){try{if(O(),s.byId("searchText").set("placeHolder",""),"Township Range"===e)return document.getElementById("searchInput1").style.display="none",document.getElementById("searchInput2").style.display="block",document.getElementById("searchTwn").value="",document.getElementById("searchRng").value="",s.byId("searchSec").attr("value",""),void s.byId("searchBtn").set("disabled",!1);if("GMUs"==e&&settings.useGMUs&&("Big Game GMU"==gmu?(ge[e].fields=settings.elkField+",COUNTY",ge[e].displayfields="GMU,County",ge[e].titlefield=settings.elkField,ge[e].searchfield=settings.elkField,ge[e].expression=settings.elkField+" = [value]",ge[e].url=settings.elkUrl):"Bighorn GMU"==gmu?(ge[e].fields=settings.sheepField,ge[e].displayfields="Bighorn Sheep GMU",ge[e].titlefield=settings.sheepField,ge[e].searchfield=settings.sheepField,ge[e].expression=settings.sheepField+" = UPPER('[value]')",ge[e].url=settings.sheepUrl):(ge[e].fields=settings.goatField,ge[e].displayfields="Mountain Goat GMU",ge[e].titlefield=settings.goatField,ge[e].searchfield=settings.goatField,ge[e].expression=settings.goatField+" = UPPER('[value]')",ge[e].url=settings.goatUrl)),document.getElementById("searchInput1").style.display="block",document.getElementById("searchInput2").style.display="none",document.getElementById("searchLabel").innerHTML=ge[e].textsearchlabel+" ",""!=ge[e].searchvalues)return s.byId("searchBtn").set("disabled",!0),void L(e);if(""!=ge[e].lookupsearchvalues)return s.byId("searchBtn").set("disabled",!0),void M(e);var a,t=e;document.getElementById("searchLoadingImg").style.display="block",s.byId("searchBtn").set("disabled",!1),esri.config.defaults.io.proxyUrl="/proxy/DotNet/proxy.ashx";var l=s.byId("searchText").attr("displayedValue"),n=/'/g;l=l.replace(n,"''"),a=ge[e].expression.indexOf("= UPPER('[value]')",0)>0?ge[e].expression.replace("= UPPER('[value]')","LIKE UPPER('"+l+"%')"):ge[e].expression.indexOf("LIKE UPPER('%[value]%')",0)>0?ge[e].expression.replace("LIKE UPPER('%[value]%')","LIKE UPPER('"+l+"%')"):ge[e].expression.replace("= [value]","<> -1");var r=ge[e].searchfield;"GMUs"!=t||"Mountain Goat GMU"!=ge[t].displayfields&&"Bighorn Sheep GMU"!=ge[t].displayfields||(r+=",HUNTING"),g({url:ge[e].url+"/query",content:{where:a,returnGeometry:!1,outFields:r,f:"json",returnDistinctValues:!0,orderByFields:ge[e].searchfield},handleAs:"json"}).then(function(e){try{for(var a,l=[],n=0;n<e.features.length;n++)("GMUs"!=t||"Mountain Goat GMU"!=ge[t].displayfields&&"Bighorn Sheep GMU"!=ge[t].displayfields||"YES"==e.features[n].attributes.HUNTING)&&(a={},a[ge[t].searchfield]=e.features[n].attributes[ge[t].searchfield],l.push(a));if("GMUs"==t&&("Mountain Goat GMU"==ge[t].displayfields||"Bighorn Sheep GMU"==ge[t].displayfields)){var r=[],d="S";"Mountain Goat GMU"==ge[t].displayfields&&(d="G"),l.forEach(function(e){"OUT"!=e[ge[t].searchfield]&&r.push(e[ge[t].searchfield].substring(1))}),r.sort(function(e,a){return e-a});l=null,l=[],r.forEach(function(e){a={},a[ge[t].searchfield]=d+e,l.push(a),a=null}),r=null,null,a=null}var o=new i({data:l}),c=s.byId("searchText");c.set("store",o),c.set("searchAttr",ge[t].searchfield),l=null,document.getElementById("searchLoadingImg").style.display="none"}catch(a){alert("Feature Search query error: "+a.message+" in search.js/updateSearchTextStore query response. response="+e,"Code Error",a),document.getElementById("searchLoadingImg").style.display="none"}},function(e){document.getElementById("searchLoadingImg").style.display="none",alert("Feature Search query error: looking up feature type suggestions in javascript/search.js updateSearchTextStore(). "+ge[t].url+"/query?where="+a+"&outfields="+ge[t].searchfield+" "+e.message,"Code Error",e)})}catch(e){document.getElementById("searchLoadingImg").style.display="none",alert("Feature Search error: "+e.message+" in search.js/updateSearchTextStore.","Code Error",e)}}function L(e){document.getElementById("searchLoadingImg").style.display="block";var a=ge[e].searchvalues.split(","),t=[];a.forEach(function(a){var s={};s[ge[e].searchfield]=a.trim(),t.push(s)});var l=new i({data:t}),n=s.byId("searchText");n.set("store",l),n.reset(),n.set("searchAttr",ge[e].searchfield),n.set("placeHolder","Select a "+ge[id].name),obj=null,t=null,e=null,a=null,document.getElementById("searchLoadingImg").style.display="none"}function M(e){document.getElementById("searchLoadingImg").style.display="block";var a=createXMLhttpRequest();a.onreadystatechange=function(){if(4==a.readyState&&200===a.status){for(var t=createXMLparser(a.responseText.substr(a.response.indexOf("?>")+2)),l=t.getElementsByTagName(ge[e].lookupfield),n=[],r=0;r<l.length;r++){var d={};d[ge[e].searchfield]=l[r].childNodes[0].nodeValue,n.push(d)}var o=new i({data:n}),c=s.byId("searchText");c.set("store",o),c.set("searchAttr",ge[e].searchfield),c.set("placeHolder","Select a "+ge[e].name),n=null,document.getElementById("searchLoadingImg").style.display="none"}else 404===a.status?(alert("File: "+app+"/"+ge[e].lookupsearchvalues+" not found.","Data Error"),document.getElementById("searchLoadingImg").style.display="none"):4===a.readyState&&500===a.status&&(alert("File: "+app+"/"+ge[e].lookupsearchvalues+" not found.","Data Error"),document.getElementById("searchLoadingImg").style.display="none")},a.open("GET",app+"/"+ge[e].lookupsearchvalues+"?v="+ndisVer,!0),a.send(null)}function _(){try{"function"==typeof ga&&ga("send","event","feature_search","click","Feature Search","1");var e=s.byId("searchText").get("value"),a=/([^a-zA-Z0-9 :#\-\',\.!_\*()/&])/g;a.test(e)&&alert("Illegal characters were removed from the search text.","Warning"),e=e.replace(a,"");var t=/'/g;e=e.replace(t,"''");var l,n=s.byId("featureType").attr("displayedValue");if(""==e&&"Township Range"!=n)return;if(O(),s.byId("searchRemoveBtn").set("disabled",!1),document.getElementById("searchLoadingImg").style.display="block",ge[n].database){document.getElementById("searchMsg").innerHTML="Loading...",document.getElementById("searchMsg").style.display="block";var r=createXMLhttpRequest();r.open("POST",ge[n].database+"?v="+ndisVer+"&key="+e,!0),r.send(null),r.onreadystatechange=function(){if(4===r.readyState&&200===r.status){var e=createXMLparser(r.responseText.substr(r.response.indexOf("?>")+2)),a=e.getElementsByTagName(ge[n].filename);if(0==a.length)return alert("No features found with that name. Please try again.","Warning"),document.getElementById("searchLoadingImg").style.display="none",void(document.getElementById("searchMsg").style.display="none");l=ge[n].database_field+" IN (";for(var t=0;t<a.length;t++)t>0&&(l+=","),"STRING"==ge[n].database_field_type.toUpperCase()?l+="'"+a[t].getElementsByTagName(ge[n].database_field)[0].childNodes[0].nodeValue+"'":l+=a[t].getElementsByTagName(ge[n].database_field)[0].childNodes[0].nodeValue;l+=")",H=ge[n].url,Y=ge[n].fields,A=ge[n].displayfields.split(","),X=ge[n].titlefield,z=ge[n].linkfield.split(","),K=ge[n].linktext.split(","),queryTask=new u(ge[n].url);var i=new m;i.where=l,i.outFields=ge[n].fields.split(","),i.returnGeometry=!0,i.outSpatialReference=map.spatialReference,queryTask.requestOptions={usePost:!0},queryTask.execute(i,function(e){if(0==e.features.length)return document.getElementById("searchLoadingImg").style.display="none",alert("No features found with that name. Please try again.","Warning"),void(document.getElementById("searchMsg").style.display="none");se=U(e,s.byId("featureType").attr("displayedValue"))},function(e){alert("Error in javascript/search.js/setSelect/queryTask.execute "+e.message,"Code Error",e),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none"})}},r.onerror=function(){alert("There was an error looking up the data from "+ge[n].database+"?key="+e,"Code Error"),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none"}}else{var i=ge[n].expression;if("Township Range"==n){if(document.getElementById("searchMsg").innerHTML="Loading...",document.getElementById("searchMsg").style.display="block",l=i.replace("[value1]",parseInt(document.getElementById("searchTwn").value)),l=l.replace("[value2]",s.byId("nsRadioForm").attr("value").nsBtn),l=l.replace("[value3]",parseInt(document.getElementById("searchRng").value)),l=l.replace("[value4]",s.byId("ewRadioForm").attr("value").ewBtn),s.byId("searchSec").get("value"))l=l.replace("[value5]",parseInt(s.byId("searchSec").get("value")));else{var d=l.indexOf("AND SECTION");l=l.substring(0,d)}e=document.getElementById("searchTwn").value+s.byId("nsRadioForm").attr("value").nsBtn+document.getElementById("searchRng").value+s.byId("ewRadioForm").attr("value").ewBtn,s.byId("searchSec").get("value")&&(e+=" Sec "+s.byId("searchSec").get("value")),document.getElementById("searchTwn").value="",document.getElementById("searchRng").value="",s.byId("searchSec").attr("value","")}else{if(isNaN(Number(e))&&-1!=i.indexOf("= [value]")){s.byId("searchText").set("value",""),updatedList=!1;var o="Your search for "+e+" failed.  Only numbers are allowed.  Please try again.";return alert(o,"Warning"),e="",document.getElementById("searchLoadingImg").style.display="none",void(document.getElementById("searchMsg").style.display="none")}"*"==e?(document.getElementById("searchMsg").innerHTML="Loading all features, please wait...",document.getElementById("searchMsg").style.display="block",l=i.indexOf("= UPPER('[value]')",0)>0?i.replace("= UPPER('[value]')","<> ''"):i.indexOf("LIKE UPPER('%[value]%')",0)>0?i.replace("LIKE UPPER('%[value]%')","<> ''"):i.replace("= [value]","<> -1"),s.byId("searchText").set("value","")):(document.getElementById("searchMsg").innerHTML="Loading...",document.getElementById("searchMsg").style.display="block",l=i.replace("[value]",e),s.byId("searchText").set("value",""))}H=ge[n].url,Y=ge[n].fields;var c=ge[n].displayfields;if(null!=c&&(A=ge[n].displayfields.split(",")),X=ge[n].titlefield,z=ge[n].linkfield.split(","),K=ge[n].linktext.split(","),H){queryTask=new u(H);var g=new m;g.where=l;var y=Y.split(",");"GMUs"!=n||"Mountain Goat GMU"!=ge[n].displayfields&&"Bighorn Sheep GMU"!=ge[n].displayfields||y.push("HUNTING"),g.outFields=y,g.returnGeometry=!0,g.outSpatialReference=map.spatialReference,queryTask.execute(g,function(e){if(0==e.features.length)return alert("No features found with that name. Please try again.","Warning"),document.getElementById("searchLoadingImg").style.display="none",void(document.getElementById("searchMsg").style.display="none");"Wildfire"==s.byId("featureType").attr("displayedValue")?G(e):U(e,s.byId("featureType").attr("displayedValue"))},function(e){alert("Error in javascript/search.js/setSelect/queryTask.execute, url="+H+". Where "+l+". Error message: "+e.message,"Code Error",e),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none"})}}}catch(e){alert(e.message+" in javascript/search.js/setSelection","Code Error",e),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none"}}function G(e){var a=0;for(he=0;he<e.features.length;he++)if(e.features[he].attributes.IRWINID){queryTask=new u("https://services3.arcgis.com/T4QMspbfLg3qTGWY/ArcGIS/rest/services/IRWIN_to_Inciweb_View/FeatureServer/0");var t=new m,l=e.features[he].attributes.IRWINID.substr(1,e.features[he].attributes.IRWINID.length-2).toLocaleLowerCase();t.where="IrwinID='"+l+"'",t.outFields=["LinkURI","IrwinID"],t.returnGeometry=!1,queryTask.execute(t,function(t){var l=0;if(a++,0!=t.features.length&&t.features[0].attributes&&t.features[0].attributes.IrwinID&&e.features[l].attributes.IRWINID){for(j=0;j<e.features.length;j++)e.features[j].attributes.IRWINID&&t.features[0].attributes.IrwinID&&e.features[j].attributes.IRWINID.toLowerCase()=="{"+t.features[0].attributes.IrwinID.toLowerCase()+"}"&&(l=j);e.features[l].attributes.IRWINID=t.features[0].attributes.LinkURI}else;if(a==e.features.length){var n=[];for(j=0;j<e.features.length;j++)e.features[j].attributes.IRWINID&&e.features[j].attributes.IRWINID.indexOf("inciweb")>-1&&n.push(e.features[j]);e.features=n,e.features.length>0?U(e,s.byId("featureType").attr("displayedValue")):(alert("No wildfire incident reports found with that name. Please try again.","Warning"),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none")}},function(e){alert("Error in javascript/search.js/setSelect/queryTask.execute, url="+H+". Where irwinID='"+l+"'. Error message: "+e.message,"Code Error",e),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none"})}else a++}function S(e){return e}function U(a,l){function n(e,a,t){var s="";return ns=t,a.forEach(function(e,t){"true"==ns[e]?(s+="if(parseInt(arguments[0]."+e+")-parseInt(arguments[1]."+e+")>0)return 1;",s+="else if(parseInt(arguments[0]."+e+")-parseInt(arguments[1]."+e+")==0)",s+=t<a.length-1?"{":"return 0"):(s+="if(arguments[0]."+e+">arguments[1]."+e+")return 1;",s+="else if(arguments[0]."+e+"==arguments[1]."+e+")",s+=t<a.length-1?"{":"return 0")}),s+=Array(a.length).join("}")+";return -1",e.sort(new Function(s))}l==e&&(l="Fish species"),document.getElementById("searchFound").innerHTML=a.features.length;for(var r=Y.split(","),i=6,d={},o=0;o<r.length;o++)d[r[o]]=0;se=[],W=null,W=[],X||(X=a.displayFieldName);var c=[],g=0;if(a.features.forEach(function(e){try{var a=e.attributes;if("GMUs"!=l||"Big Game GMU"==gmu||"YES"==a.HUNTING){var t,s=R(e),n={icon:J,point:s,geometry:e.geometry},i={icon:J,point:s,geometry:e.geometry},m={};for(m.id=g++,o=0;o<r.length;o++)a[r[o]]&&("Acres"==r[o]?m[r[o]]=a[r[o]].numberFormat(2):m[r[o]]=a[r[o]],-1==z.indexOf(r[o])&&a[r[o]].toString().length+3>d[r[o]]&&(d[r[o]]=a[r[o]].toString().length+3),d[r[o]]>35&&a[r[o]].toString().indexOf(" ")>-1&&(d[r[o]]=35));c.push(m),m=null;for(o=0;o<A.length;o++){try{t=a[r[o]].toString()}catch(e){t=""}if(r[o].toUpperCase()==X.toUpperCase()&&(n.title=t,i.title=t),z.indexOf(r[o])>-1){var u=z.indexOf(r[o]);""!=t&&" "!=t&&"key"!=A[o]?(n.link=[],n.link.push(t),n.linktext=[],n.linktext.push(K[u]),K[u].length>0?i[A[o].replace(/ /g,"_")]='<a target="_blank" href="'+t+'">'+K[u]+"</a>":i[A[o].replace(/ /g,"_")]=t,0):("key"!=A[o]&&0,i[A[o].replace(/ /g,"_")]="")}else"key"!=A[o]&&0,null!=A?"Acres"==A[o]?i[A[o]]=Number(t).numberFormat(2):i[A[o].replace(/ /g,"_")]=t:"Acres"==r[o]?i[r[o]]=Number(t).numberFormat(2):i[r[o]]=t}switch(se.push(i),e.attributes=n,e.geometry.type){case"point":e.symbol=ae;break;case"polyline":e.symbol=le;break;case"polygon":e.symbol=ne}$.add(e),W.push(e)}else document.getElementById("searchFound").innerHTML=Number(document.getElementById("searchFound").innerHTML)-1}catch(e){alert("Error in createRecordData search.js "+e.message,"Code Error",e),document.getElementById("searchLoadingImg").style.display="none"}}),"0"==document.getElementById("searchFound").innerHTML)return alert("No features found. Please try again.","Warning"),document.getElementById("searchMsg").style.display="none",document.getElementById("searchTools").style.display="none",document.getElementById("searchGrid").style.display="none",document.getElementById("searchContent").style.height=Q,void(document.getElementById("searchLoadingImg").style.display="none");$.id="searchLayer0",$.on("mouse-over",F),ee.on("mouse-out",function(){ee.clear()});var m={};for(f=0;f<A.length;f++){var u={label:A[f],resizable:!0};m[A[f].replace(/ /g,"_")]=u,m[A[f].replace(/ /g,"_")].label.length+10>d[r[f]]&&(d[r[f]]=m[A[f].replace(/ /g,"_")].label.length+10),d[r[f]]=d[r[f]]*i+"px",z.indexOf(r[f])>-1&&(m[A[f].replace(/ /g,"_")].formatter=S)}m.geometry={label:"geometry",width:"0px"},m.icon={label:"icon",width:"0px"},m.point={label:"point",width:"0px"},m.title={label:"title",width:"0px"};var h=t.byId("searchGrid");h.childNodes.length>0&&h.removeChild(h.childNodes[0]),de=new(b([N,T,v]))({columns:m,selectionMode:"single",cellNavigation:!1});for(var p=ge[l].sortfield.split(","),f=0;f<p.length;f++)p[f]=p[f].replace(/ /g,"_");var E={},I=ge[l].numericsort.split(",");for(f=0;f<p.length;f++)E[p[f]]=I[f];for(n(se,p,E),f=0;f<r.length;f++)de.styleColumn(A[f].replace(/ /g,"_"),"width:"+d[r[f]]);if(de.styleColumn("Acres","text-align: right;"),de.styleColumn("geometry","display: none;"),de.styleColumn("point","display: none;"),de.styleColumn("icon","display: none;"),de.styleColumn("title","display: none;"),de.on(".dgrid-row:click",function(e){require(["esri/geometry/Extent"],function(a){var t=de.row(e),s=(de.column(e),t.data.geometry.getExtent());if(null!=s){var l=new a({xmin:s.xmin,ymin:s.ymin,xmax:s.xmax,ymax:s.ymax,spatialReference:{wkid:wkid}});map.setExtent(l,!0)}else map.setScale(ye),map.centerAt(t.data.point)})}),de.on(".dgrid-row:mouseout",function(e){ee.clear()}),de.on(".dgrid-row:mouseover",function(e){var a=de.row(e);ee.clear();var t=new y(a.data.geometry);switch(t.geometry.type){case"point":t.symbol=te;break;case"polyline":t.symbol=re;break;case"polygon":t.symbol=ie}ee.add(t),addLabel(y(a.data.point),a.data.title,ee,"11pt"),t=null}),document.getElementById("searchContent").style.height=Z,d=null,document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchOpenBtn").style.display="none",document.getElementById("searchCloseBtn").style.display="inline-block",document.getElementById("searchTools").style.display="block",document.getElementById("searchGrid").style.display="block",document.getElementById("searchMsg").style.display="none",se&&1==se.length){var B=se[0].geometry.getExtent();null!=B?require(["esri/geometry/Extent"],function(e){var a=new e({xmin:B.xmin,ymin:B.ymin,xmax:B.xmax,ymax:B.ymax,spatialReference:{wkid:wkid}});map.setExtent(a,!0)}):(map.setScale(ye),map.centerAt(se[0].point))}else"Township"==A[0]?(map.setScale(ye),map.centerAt(se[0].point)):require(["esri/graphicsUtils"],function(e){map.setExtent(e.graphicsExtent(a.features),!0)});s.byId("FeatureSearchTabs").selectedChildWidget==s.byId("graphic_Pane")&&ge[l].graphical_db_fields&&""!=ge[l].graphical_db_fields?P(se,de,h,m):(de.renderArray(se),h.appendChild(de.domNode),de.startup())}function F(e){ee.clear();var a=new y(e.graphic.geometry);switch(a.geometry.type){case"point":a.symbol=te;break;case"polyline":a.symbol=re;break;case"polygon":a.symbol=ie}ee.add(a),addLabel(y(e.graphic.attributes.point),e.graphic.attributes.title,ee,"11pt"),a=null}function R(e){var a;switch(e.geometry.type){case"point":a=new f(e.geometry.x,e.geometry.y,map.spatialReference);break;case"polyline":var t=e.geometry,s=t.paths.length,l=parseInt(s/2-1),n=[];n=t.paths[l];var r=n.length,i=parseInt(r/2-1);a=t.getPoint(l,i);break;case"polygon":a=e.geometry.getCentroid()}return a}function C(){document.getElementById("graphicfeatures").innerHTML=s.byId("featureTypeGraphic").attr("displayedValue"),O()}function V(a){var t=a;require(["esri/tasks/query","esri/tasks/QueryTask"],function(a,l){"function"==typeof ga&&ga("send","event","graphical_search","click","Graphical Search","1");var n=s.byId("featureTypeGraphic").attr("displayedValue");n==e&&(n="Fish species"),"GMUs"==n&&settings.useGMUs&&("Big Game GMU"==gmu?(ge[n].fields=settings.elkField+",COUNTY",ge[n].displayfields="GMU,County",ge[n].titlefield=settings.elkField,ge[n].searchfield=settings.elkField,ge[n].expression=settings.elkField+" =[value]",ge[n].url=settings.elkUrl):"Bighorn GMU"==gmu?(ge[n].fields=settings.sheepField,ge[n].displayfields="Bighorn Sheep GMU",ge[n].titlefield=settings.sheepField,ge[n].searchfield=settings.sheepField,ge[n].expression=settings.sheepField+" = UPPER('[value]')",ge[n].url=settings.sheepUrl):(ge[n].fields=settings.goatField,ge[n].displayfields="Mountain Goat GMU",ge[n].titlefield=settings.goatField,ge[n].searchfield=settings.goatField,ge[n].expression=settings.goatField+" = UPPER('[value]')",ge[n].url=settings.goatUrl));var r="esriSpatialRelIntersects";Y=ge[n].fields;var i=ge[n].displayfields;if(null!=i&&(A=ge[n].displayfields.split(",")),ge[n].graphical_db_fields&&""!=ge[n].graphical_db_fields&&(Y+=","+ge[n].database_field,A.push("key")),X=ge[n].titlefield,z=ge[n].linkfield.split(","),K=ge[n].linktext.split(","),queryExpr=ge[n].graphical_expr,ge[n].url){queryTask=new l(ge[n].url);var d=new a;queryExpr&&""!=queryExpr&&(d.where=queryExpr),d.geometry=t;var o=Y.split(",");"GMUs"!=n||"Mountain Goat GMU"!=ge[n].displayfields&&"Bighorn Sheep GMU"!=ge[n].displayfields||o.push("HUNTING"),d.outFields=o,d.returnGeometry=!0,d.spatialRelationship=r,d.outSpatialReference=map.spatialReference,queryTask.execute(d,function(e){try{if(0==e.features.length)return alert("No features found in that location. Please try again.","Warning"),document.getElementById("searchLoadingImg").style.display="none",void(document.getElementById("searchMsg").style.display="none");"Wildfire"==s.byId("featureType").attr("displayedValue")?G(e):U(e,s.byId("featureTypeGraphic").attr("displayedValue"))}catch(e){alert("Feature Search error in javascript/search.js/queryFeaturesGraphical queryTask execute. Error message: "+e.message,"Code Error",e),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none"}},function(e){alert("While using Graphical Feature Search there was a possible error in SearchWidget.xml file. Querying: "+ge[n].url+" for field: "+ge[n].fields+" "+e.message,"Data Error",e),document.getElementById("searchMsg").style.display="none",document.getElementById("searchLoadingImg").style.display="none"})}})}function P(a,t,l,n){try{key="";for(var r=0;r<a.length;r++)r>0&&(key+=","),key+=a[r].key;var i=s.byId("featureTypeGraphic").attr("displayedValue");i==e&&(i="Fish species");var d=createXMLhttpRequest(),o=ge[i].graphical_database+"?v="+ndisVer+"&key="+key;d.open("POST",o,!0),d.onerror=function(){alert("In Graphical Feature Search, there was an error looking up the data from "+ge[i].graphical_database,"Code Error"),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none"},d.onreadystatechange=function(){if(4===d.readyState)if(200===d.status)try{var e=createXMLparser(d.responseText.substr(d.response.indexOf("?>")+2)),s=e.getElementsByTagName("NewDataSet");if(0==s.length)return alert("No features found with that name. Please try again.","Warning"),document.getElementById("searchLoadingImg").style.display="none",void(document.getElementById("searchMsg").style.display="none");for(var r,o,c=ge[i].graphical_db_fields.split(","),g=ge[i].graphical_db_displayfields.split(","),m=[],u=ge[i].graphical_db_sort.split(","),y=0;y<c.length;y++)for(m[y]=0,o=0;o<s.length;o++){a[o][g[y]]="";var h=s[o].getElementsByTagName(ge[i].graphical_filename);for(r=0;r<h.length;r++)r>0&&(a[o][g[y]]+=","),a[o][g[y]]+=h[r].getElementsByTagName(c[y])[0].childNodes[0].nodeValue,a[o][g[y]].length>m[y]&&(m[y]=a[o][g[y]].length+3),g[y].length+10>m[y]&&(m[y]=g[y].length+10),m[y]>35&&(m[y]=35)}var p=6;for(r=0;r<a.length;r++)for(delete a[r].key,y=0;y<c.length;y++)if("YES"==u[y].toUpperCase()){var f=[];a[r][g[y]]?(f=a[r][g[y]].split(","),f.sort(),a[r][g[y]]=f.toString(),f=null):a[r][g[y]]=""}for(y=0;y<g.length;y++)n[g[y]]={label:g[y],resizable:!0};for(delete n.key,t.set("columns",n),y=0;y<g.length;y++)t.styleColumn(g[y],"width:"+m[y]*p+"px");t.renderArray(a),l.appendChild(t.domNode),t.startup(),m=null,n=null,g=null}catch(e){alert("Graphical Feature Search error: "+e.message+" in javascript/search.js/queryGraphicalDatabase.","Code Error",e),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none"}else 404===d.status?(alert("Error: Missing "+ge[i].graphical_database+" file in "+app+" directory.","Data Error"),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none"):(alert("Graphical Feature Search Error: There was an error looking up the data from "+ge[i].graphical_database+" Error message: "+d.statusText,"Data Error"),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none")},d.send(null)}catch(e){alert("Graphical Feature Search Error: "+e.message+" in javascript/search.js/queryGraphicalDatabase.","Code Error",e),document.getElementById("searchLoadingImg").style.display="none",document.getElementById("searchMsg").style.display="none"}}function q(e){"graphBtnSelected"!=e.currentTarget.className?(drawing=!0,O(),e.currentTarget.className="graphBtnSelected","searchpoint"!=e.currentTarget.id&&(document.getElementById("searchpoint").className="graphBtn"),"searchpolyline"!=e.currentTarget.id&&(document.getElementById("searchpolyline").className="graphBtn"),"searchrectangle"!=e.currentTarget.id&&(document.getElementById("searchrectangle").className="graphBtn"),"searchpolygon"!=e.currentTarget.id&&(document.getElementById("searchpolygon").className="graphBtn"),require(["esri/toolbars/draw","dojo/i18n!esri/nls/jsapi"],function(a,t){"searchpoint"==e.currentTarget.id&&(t.toolbars.draw.addPoint="Click to select features at a point",searchtoolbar.activate(a.POINT)),"searchpolyline"==e.currentTarget.id&&searchtoolbar.activate(a.POLYLINE),"searchrectangle"==e.currentTarget.id&&(t.toolbars.draw.addShape="Press down to start and let go to finish",searchtoolbar.activate(a.RECTANGLE)),"searchpolygon"==e.currentTarget.id&&searchtoolbar.activate(a.POLYGON)})):D()}function D(){drawing=!1,searchtoolbar.deactivate(),document.getElementById("searchpoint").className="graphBtn",document.getElementById("searchpolyline").className="graphBtn",document.getElementById("searchrectangle").className="graphBtn",document.getElementById("searchpolygon").className="graphBtn"}function O(){$.clear(),ee.clear(),s.byId("searchRemoveBtn").set("disabled",!0),document.getElementById("clearSearchGraphics").style.display="none",document.getElementById("searchGrid").style.display="none",document.getElementById("searchContent").style.height=Q}try{var W;searchtoolbar=new c(map,{showTooltips:!0}),searchtoolbar.on("draw-end",x);var A,H,Y,X,z,K,Q="300px",Z="510px",J="assets/images/i_pin.png",$=new h,ee=new h,ae=new E(J,30,30);$.symbol=ae,map.addLayer($);var te=new E(J,40,40);ee.symbol=te;var se,le=new I(I.STYLE_SOLID,new r([255,0,0,.8]),2),ne=new B(I.STYLE_SOLID,le,new r([255,0,0,.1])),re=new I(I.STYLE_SOLID,new r([255,255,0,.8]),2),ie=new B(I.STYLE_SOLID,le,new r([255,255,0,.5]));map.addLayer(ee);var de,oe,ce=a.getElementsByTagName("layer"),ge=[],me=new i({data:[]}),ue=new i({data:[]});oe="0"==a.getElementsByTagName("selectedtab")[0].childNodes[0].nodeValue?"text_Pane":"graphic_Pane";var ye=72224;a.getElementsByTagName("zoomscale")[0]&&a.getElementsByTagName("zoomscale")[0].childNodes[0].nodeValue&&(ye=a.getElementsByTagName("zoomscale")[0].childNodes[0].nodeValue);for(var he=0;he<ce.length;he++){var pe="unknown";ce[he].getElementsByTagName("name")[0]&&ce[he].getElementsByTagName("name")[0].childNodes[0].nodeValue?pe=ce[he].getElementsByTagName("name")[0].childNodes[0].nodeValue:k("name"),ge[pe]={name:pe,url:ce[he].getElementsByTagName("url")[0].childNodes[0]?ce[he].getElementsByTagName("url")[0].childNodes[0].nodeValue:k("url"),expression:ce[he].getElementsByTagName("expression")[0].childNodes[0]?ce[he].getElementsByTagName("expression")[0].childNodes[0].nodeValue:k("expression"),graphicalexpression:ce[he].getElementsByTagName("graphicalexpression")[0].childNodes[0]?ce[he].getElementsByTagName("graphicalexpression")[0].childNodes[0].nodeValue:null,searchfield:ce[he].getElementsByTagName("searchfield")[0].childNodes[0]?ce[he].getElementsByTagName("searchfield")[0].childNodes[0].nodeValue:k("searchfield"),textsearchlabel:ce[he].getElementsByTagName("textsearchlabel")[0].childNodes[0]?ce[he].getElementsByTagName("textsearchlabel")[0].childNodes[0].nodeValue:k("textsearchlabel"),graphicalsearchlabel:ce[he].getElementsByTagName("graphicalsearchlabel")[0].childNodes[0]?ce[he].getElementsByTagName("graphicalsearchlabel")[0].childNodes[0].nodeValue:k("graphicalsearchlabel"),fields:ce[he].getElementsByTagName("fields")[0].childNodes[0]?ce[he].getElementsByTagName("fields")[0].childNodes[0].nodeValue:k("fields"),displayfields:ce[he].getElementsByTagName("displayfields")[0].childNodes[0]?ce[he].getElementsByTagName("displayfields")[0].childNodes[0].nodeValue:k("displayfields"),sortfield:ce[he].getElementsByTagName("sortfield")[0]&&ce[he].getElementsByTagName("sortfield")[0].childNodes[0]?ce[he].getElementsByTagName("sortfield")[0].childNodes[0].nodeValue:"none",numericsort:ce[he].getElementsByTagName("numericsort")[0]&&ce[he].getElementsByTagName("numericsort")[0].childNodes[0]?ce[he].getElementsByTagName("numericsort")[0].childNodes[0].nodeValue:"false",titlefield:ce[he].getElementsByTagName("titlefield")[0]&&ce[he].getElementsByTagName("titlefield")[0].childNodes[0]?ce[he].getElementsByTagName("titlefield")[0].childNodes[0].nodeValue:k("titlefield"),linkfield:ce[he].getElementsByTagName("linkfield")[0]&&ce[he].getElementsByTagName("linkfield")[0].childNodes[0]?ce[he].getElementsByTagName("linkfield")[0].childNodes[0].nodeValue:"",linktext:ce[he].getElementsByTagName("linktext")[0]&&ce[he].getElementsByTagName("linktext")[0].childNodes[0]?ce[he].getElementsByTagName("linktext")[0].childNodes[0].nodeValue:"unknown link",searchvalues:ce[he].getElementsByTagName("searchvalues")[0]&&ce[he].getElementsByTagName("searchvalues")[0].childNodes[0]?ce[he].getElementsByTagName("searchvalues")[0].childNodes[0].nodeValue:"",lookupsearchvalues:ce[he].getElementsByTagName("lookupsearchvalues")[0]&&ce[he].getElementsByTagName("lookupsearchvalues")[0].childNodes[0]?ce[he].getElementsByTagName("lookupsearchvalues")[0].childNodes[0].nodeValue:"",lookupfilename:ce[he].getElementsByTagName("lookupsearchvalues")[0]&&ce[he].getElementsByTagName("lookupsearchvalues")[0].childNodes[0]?ce[he].getElementsByTagName("lookupfilename")[0].childNodes[0]?ce[he].getElementsByTagName("lookupfilename")[0].childNodes[0].nodeValue:k("lookupfilename"):null,
lookupfield:ce[he].getElementsByTagName("lookupsearchvalues")[0]&&ce[he].getElementsByTagName("lookupsearchvalues")[0].childNodes[0]?ce[he].getElementsByTagName("lookupfield")[0].childNodes[0]?ce[he].getElementsByTagName("lookupfield")[0].childNodes[0].nodeValue:k("lookupfield"):null,database:ce[he].getElementsByTagName("database")[0]&&ce[he].getElementsByTagName("database")[0].childNodes[0]?ce[he].getElementsByTagName("database")[0].childNodes[0].nodeValue:null,filename:ce[he].getElementsByTagName("database")[0]&&ce[he].getElementsByTagName("database")[0].childNodes[0]?ce[he].getElementsByTagName("filename")[0].childNodes[0]?ce[he].getElementsByTagName("filename")[0].childNodes[0].nodeValue:k("filename"):null,database_field:ce[he].getElementsByTagName("database")[0]&&ce[he].getElementsByTagName("database")[0].childNodes[0]?ce[he].getElementsByTagName("database_field")[0].childNodes[0]?ce[he].getElementsByTagName("database_field")[0].childNodes[0].nodeValue:k("database_field"):null,database_field_type:ce[he].getElementsByTagName("database")[0]&&ce[he].getElementsByTagName("database")[0].childNodes[0]?ce[he].getElementsByTagName("database_field_type")[0].childNodes[0]?ce[he].getElementsByTagName("database_field_type")[0].childNodes[0].nodeValue:k("database_field_type"):null,graphical_database:ce[he].getElementsByTagName("database")[0]&&ce[he].getElementsByTagName("database")[0].childNodes[0]&&ce[he].getElementsByTagName("graphical_database")[0].childNodes[0]?ce[he].getElementsByTagName("graphical_database")[0].childNodes[0].nodeValue:null,graphical_filename:ce[he].getElementsByTagName("graphical_database")[0]&&ce[he].getElementsByTagName("graphical_database")[0].childNodes[0]?ce[he].getElementsByTagName("graphical_filename")[0].childNodes[0]?ce[he].getElementsByTagName("graphical_filename")[0].childNodes[0].nodeValue:k("graphical_filename"):null,graphical_db_fields:ce[he].getElementsByTagName("graphical_database")[0]&&ce[he].getElementsByTagName("graphical_database")[0].childNodes[0]?ce[he].getElementsByTagName("graphical_db_fields")[0].childNodes[0]?ce[he].getElementsByTagName("graphical_db_fields")[0].childNodes[0].nodeValue:k("graphical_db_fields"):null,graphical_db_displayfields:ce[he].getElementsByTagName("graphical_database")[0]&&ce[he].getElementsByTagName("graphical_database")[0].childNodes[0]?ce[he].getElementsByTagName("graphical_db_displayfields")[0].childNodes[0]?ce[he].getElementsByTagName("graphical_db_displayfields")[0].childNodes[0].nodeValue:k("graphical_db_displayfields"):null,graphical_db_sort:ce[he].getElementsByTagName("graphical_database")[0]&&ce[he].getElementsByTagName("graphical_database")[0].childNodes[0]?ce[he].getElementsByTagName("graphical_db_sort")[0].childNodes[0]?ce[he].getElementsByTagName("graphical_db_sort")[0].childNodes[0].nodeValue:k("graphical_db_sort"):null},me.data.push({name:ge[pe].name,id:he}),"fish species"==ge[pe].name.toLowerCase()?ue.data.push({name:e,id:he}):ue.data.push({name:ge[pe].name,id:he})}var fe=new i({data:[{name:"Loading..."}]}),Ee=new o({id:"featureType",name:"feature",store:me,value:me.data[0].name,sortByLabel:!1,labelAttr:"name",maxHeight:-1,style:{width:"250px"},onChange:function(){w(this.attr("displayedValue")),s.byId("searchText").reset()}},"featureType");Ee.startup();var Ie=new o({id:"featureTypeGraphic",name:"feature",store:ue,value:ue.data[0].name,sortByLabel:!1,labelAttr:"name",maxHeight:-1,style:{width:"250px"},onChange:function(){C(this.attr("displayedValue"))}},"featureTypeGraphic");Ie.startup(),document.getElementById("graphicfeatures").innerHTML=ue.data[0].name;new d({id:"searchText",store:fe,autoComplete:!1,searchAttr:ge[me.data[0].name].searchfield,style:{width:"250px"},hasDownArrow:!0,maxHeight:195,onClick:function(){"GMUs"==Ee.attr("displayedValue")&&settings.useGMUs&&("Big Game GMU"==gmu&&ge.GMUs.titlefield!=settings.elkField||"Bighorn GMU"==gmu&&ge.GMUs.titlefield!=settings.sheepField||"Goat GMU"==gmu&&ge.GMUs.titlefield!=settings.goatField)&&(this.loadAndOpenDropDown(),w("GMUs"))},onChange:function(){_()},onKeyUp:function(e){[16,17,27,33,34,35,36,37,38,39,40].indexOf(e.keyCode)>-1||([13].indexOf(e.keyCode)>-1?_(this.attr("displayedValue")):w(s.byId("featureType").attr("displayedValue")))}},"searchText").startup();var Be=new i({idProperty:"id",data:[]});for(he=0;he<37;he++)0==he?Be.data.push({id:"",name:""}):he<10?Be.data.push({id:"00"+he,name:"00"+he}):Be.data.push({id:"0"+he,name:"0"+he});var be=new o({id:"searchSec",labelAttr:"name",style:{width:"50px",position:"relative",left:"13px",top:"-1px"},maxHeight:158,store:Be},"searchSec");be.startup();var Ne=oe&&s.byId(oe);Ne&&s.byId("FeatureSearchTabs").selectChild(Ne),s.byId("FeatureSearchTabs").watch("selectedChildWidget",function(e,a,t){"Text Search"==t.title&&D()}),t.byId("searchDiv").addEventListener("click",function(e){s.byId("searchDiv").open||D()}),s.byId("searchBtn").on("click",_),s.byId("searchRemoveBtn").on("click",O),s.byId("searchRemoveBtn").set("disabled",!0),document.getElementById("clearSearchGraphics").style.display="none",document.getElementById("clearSearchGraphics").addEventListener("click",function(){O()}),document.getElementById("searchpoint").addEventListener("click",function(e){q(e)}),document.getElementById("searchpolyline").addEventListener("click",function(e){q(e)}),document.getElementById("searchrectangle").addEventListener("click",function(e){q(e)}),document.getElementById("searchpolygon").addEventListener("click",function(e){q(e)}),w(me.data[0].name),document.getElementById("searchLabel").innerHTML=ge[me.data[0].name].textsearchlabel+" "}catch(e){alert("Error in javascript/search.js searchInit. "+e.message,"Code Error",e),document.getElementById("searchLoadingImg").style.display="none"}})}catch(e){alert("Error in javascript/search.js searchInit. "+e.message,"Code Error",e),document.getElementById("searchLoadingImg").style.display="none"}}else 404===t.status?(alert("Error: Missing config.xml file in "+app+" directory.","Data Error"),hideLoading()):4===t.readyState&&500===t.status&&(alert("Make sure your application name is correct on the URL. app="+app,"Warning"),hideLoading())},t.open("GET",a,!0),t.send(null)}catch(e){alert(e.message+" in javascript/search.js trying to read SearchWidget.xml file.","Code Error",e),document.getElementById("searchLoadingImg").style.display="none"}}var searchtoolbar;