function readSettingsWidget(){var e=createXMLhttpRequest(),i=app+"/SettingsWidget.xml?v="+ndisVer;e.onreadystatechange=function(){if(4==e.readyState&&200==e.status)try{require(["dojo/dom","dijit/registry","dojo/query","dojo/dom-construct","dojo/on"],function(i,t,a,n,r){var s=createXMLdoc(e),o=getCookie("prj");settings=""!==o?{XYProjection:o}:{XYProjection:s.getElementsByTagName("xy_projection")[0].childNodes[0].nodeValue},t.byId("settings_xy_proj").set("value",settings.XYProjection),t.byId("help_xy_proj").set("value",settings.XYProjection),use_map_link=s.getElementsByTagName("use_map_link")[0]&&"true"==s.getElementsByTagName("use_map_link")[0].childNodes[0].nodeValue?1:0,use_map_link&&(document.getElementById("mapLinkBtn").style.display="block"),use_get_extent=s.getElementsByTagName("use_get_extent")&&"true"==s.getElementsByTagName("use_get_extent")[0].childNodes[0].nodeValue?1:0,use_get_extent&&(document.getElementById("showExtentBtn").style.display="block");var d=s.getElementsByTagName("use_gmus")[0]&&"true"==s.getElementsByTagName("use_gmus")[0].childNodes[0].nodeValue?1:0;d?(settings.useGMUs=!0,s.getElementsByTagName("gmu_url")[0]?settings.elkUrl=s.getElementsByTagName("gmu_url")[0].childNodes[0].nodeValue:alert("Missing tag: gmu_url in "+app+"/SettingsWidget.xml","Data Error"),s.getElementsByTagName("gmu_field")[0]?settings.elkField=s.getElementsByTagName("gmu_field")[0].childNodes[0].nodeValue:alert("Missing tag: gmu_field in "+app+"/SettingsWidget.xml","Data Error"),s.getElementsByTagName("sheep_gmu_url")[0]?settings.sheepUrl=s.getElementsByTagName("sheep_gmu_url")[0].childNodes[0].nodeValue:alert("Missing tag: sheep_gmu_url in "+app+"/SettingsWidget.xml","Data Error"),s.getElementsByTagName("sheep_gmu_field")[0]?settings.sheepField=s.getElementsByTagName("sheep_gmu_field")[0].childNodes[0].nodeValue:alert("Missing tag: sheep_gmu_field in "+app+"/SettingsWidget.xml","Data Error"),s.getElementsByTagName("goat_gmu_url")[0]?settings.goatUrl=s.getElementsByTagName("goat_gmu_url")[0].childNodes[0].nodeValue:alert("Missing tag: goat_gmu_url in "+app+"/SettingsWidget.xml","Data Error"),s.getElementsByTagName("goat_gmu_field")[0]?settings.goatField=s.getElementsByTagName("goat_gmu_field")[0].childNodes[0].nodeValue:alert("Missing tag: goat_gmu_field in "+app+"/SettingsWidget.xml","Data Error"),"Big Game GMU"==gmu?showGMUCombo(settings.elkUrl,settings.elkField):"Bighorn GMU"==gmu?showGMUCombo(settings.sheepUrl,settings.sheepField):"Goat GMU"==gmu&&showGMUCombo(settings.goatUrl,settings.goatField)):settings.useGMUs=!1;var l=s.getElementsByTagName("driving_directions")[0]&&"true"==s.getElementsByTagName("driving_directions")[0].childNodes[0].nodeValue?1:0;l&&(n.create("a",{id:"dirLink",class:"action",innerHTML:"Get Directions",href:"javascript:void(0)"},a(".actionList",map.infoWindow.domNode)[0]),r(i.byId("dirLink"),"click",getDirections)),r(a(".actionList .zoomTo")[0],"click",zoomToPt),n.create("div",{class:"action",id:"identifyPoint",innerHTML:"Loading click point..."},a(".actionList",map.infoWindow.domNode)[0]),s.getElementsByTagName("elevation")[0]&&s.getElementsByTagName("elevation")[0].firstChild.nodeValue&&(show_elevation="true"==s.getElementsByTagName("elevation")[0].firstChild.nodeValue?1:0),show_elevation&&s.getElementsByTagName("elevation_url")[0]&&(s.getElementsByTagName("elevation_url")[0].firstChild.nodeValue?elevation_url=s.getElementsByTagName("elevation_url")[0].firstChild.nodeValue:alert("Missing elevation_url tag in SettingsWidget.xml.","Data Error")),folder=s.getElementsByTagName("folder");for(var y=0;y<folder.length;y++){0==y&&(identifyGroup=folder[y].getAttribute("label")),identifyGroups.push(folder[y].getAttribute("label")),identifyLayerIds[identifyGroups[y]]=[];var f=folder[y].getElementsByTagName("layer");identifyLayers[identifyGroups[y]]={},folder[y].getElementsByTagName("desc")[0]&&(identifyLayers[identifyGroups[y]].desc=folder[y].getElementsByTagName("desc")[0].firstChild.nodeValue);for(var u="missing label",m=0;m<f.length;m++){f[m].getAttribute("label")?u=f[m].getAttribute("label"):alert("Error in "+app+"/SettingsWidget.xml. Missing label in folder: "+identifyGroups[y]+".","Data Error"),folder[y].getAttribute("id_vis_only")&&"true"==folder[y].getAttribute("id_vis_only").toLowerCase()&&(f[m].getElementsByTagName("vis_url")[0]&&f[m].getElementsByTagName("vis_id")[0]||alert("Error in "+app+"/SettingsWidget.xml. When vis_id_only is set in a folder, every layer in the folder must have a vis_id and vis_url tag for the layer that is in the map to check if it is visible or not. Missing vis_url and vis_id tags in folder: "+identifyGroups[y]+".","Data Error")),identifyLayers[identifyGroups[y]][u]={},"Wildfire Perimeters"===f[m].getAttribute("label")&&(f[m].getElementsByTagName("irwin_to_inciweb")&&f[m].getElementsByTagName("irwin_to_inciweb")[0]?irwin_to_inciweb_url=f[m].getElementsByTagName("irwin_to_inciweb")[0].childNodes[0].nodeValue:alert("Error in "+app+"/readSettingsWidget.xml. Missing irwin_to_inciweb tag in Wildfire Perimeters layer. This contains the report info."));var g=!1;if(f[m].getElementsByTagName("url")[0]&&f[m].getElementsByTagName("id")[0])for(var p=0;p<identifyLayerIds[identifyGroups[y]].length;p++)folder[y].getAttribute("id_vis_only")&&"true"==folder[y].getAttribute("id_vis_only").toLowerCase()&&identifyLayerIds[identifyGroups[y]][p].url==f[m].getElementsByTagName("url")[0].childNodes[0].nodeValue&&identifyLayerIds[identifyGroups[y]][p].vis_url==f[m].getElementsByTagName("vis_url")[0].childNodes[0].nodeValue&&identifyLayerIds[identifyGroups[y]][p].geometry==f[m].getElementsByTagName("geometry")[0].childNodes[0].nodeValue.toLowerCase()?(identifyLayerIds[identifyGroups[y]][p].ids.push(f[m].getElementsByTagName("id")[0].childNodes[0].nodeValue),identifyLayerIds[identifyGroups[y]][p].vis_ids.push(f[m].getElementsByTagName("vis_id")[0].childNodes[0].nodeValue),g=!0):identifyLayerIds[identifyGroups[y]][p].url==f[m].getElementsByTagName("url")[0].childNodes[0].nodeValue&&identifyLayerIds[identifyGroups[y]][p].geometry==f[m].getElementsByTagName("geometry")[0].childNodes[0].nodeValue.toLowerCase()&&(identifyLayerIds[identifyGroups[y]][p].ids.push(f[m].getElementsByTagName("id")[0].childNodes[0].nodeValue),g=!0);else alert("Error in "+app+"/SettingsWidget.xml. Missing url or id in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error");if(!g)if(f[m].getElementsByTagName("url")[0]&&f[m].getElementsByTagName("id")[0]){var c=null,h=[];folder[y].getAttribute("id_vis_only")&&"true"==folder[y].getAttribute("id_vis_only").toLowerCase()&&(c=f[m].getElementsByTagName("vis_url")[0].childNodes[0].nodeValue,h.push(f[m].getElementsByTagName("vis_id")[0].childNodes[0].nodeValue)),identifyLayerIds[identifyGroups[y]].push({url:f[m].getElementsByTagName("url")[0].childNodes[0].nodeValue,ids:new Array(f[m].getElementsByTagName("id")[0].childNodes[0].nodeValue),geometry:f[m].getElementsByTagName("geometry")[0].childNodes[0].nodeValue.toLowerCase(),id_vis_only:!(!folder[y].getAttribute("id_vis_only")||"true"!=folder[y].getAttribute("id_vis_only").toLowerCase()),vis_url:c,vis_ids:h})}else alert("Error in "+app+"/SettingsWidget.xml. Missing url or id in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error");f[m].getElementsByTagName("database")[0]?(f[m].getElementsByTagName("url")[0]?identifyLayers[identifyGroups[y]][u].url=f[m].getElementsByTagName("url")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing url in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("id")[0]?identifyLayers[identifyGroups[y]][u].id=f[m].getElementsByTagName("id")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing id in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("geometry")[0]?identifyLayers[identifyGroups[y]][u].geometry=f[m].getElementsByTagName("geometry")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing geometry in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("fields")[0]?identifyLayers[identifyGroups[y]][u].fields=f[m].getElementsByTagName("fields")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing fields in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("displaynames")[0]?identifyLayers[identifyGroups[y]][u].displaynames=f[m].getElementsByTagName("displaynames")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing displaynames in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("position")[0]?identifyLayers[identifyGroups[y]][u].position=f[m].getElementsByTagName("position")[0].childNodes[0].nodeValue:identifyLayers[identifyGroups[y]][u].position=0,f[m].getElementsByTagName("database")[0]?identifyLayers[identifyGroups[y]][u].database=f[m].getElementsByTagName("database")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing database in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("filename")[0]?identifyLayers[identifyGroups[y]][u].filename=f[m].getElementsByTagName("filename")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing filename in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("one2one_fields")[0]&&f[m].getElementsByTagName("one2one_fields")[0].childNodes.length>0&&(identifyLayers[identifyGroups[y]][u].one2one_fields=f[m].getElementsByTagName("one2one_fields")[0].childNodes[0].nodeValue.split(",")),f[m].getElementsByTagName("one2one_display")[0]&&f[m].getElementsByTagName("one2one_display")[0].childNodes.length>0&&(identifyLayers[identifyGroups[y]][u].one2one_display=f[m].getElementsByTagName("one2one_display")[0].childNodes[0].nodeValue.split(",")),f[m].getElementsByTagName("one2many_fields")[0]&&f[m].getElementsByTagName("one2many_fields")[0].childNodes.length>0&&(identifyLayers[identifyGroups[y]][u].one2many_fields=f[m].getElementsByTagName("one2many_fields")[0].childNodes[0].nodeValue.split(","))):(f[m].getElementsByTagName("url")[0]?identifyLayers[identifyGroups[y]][u].url=f[m].getElementsByTagName("url")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing url in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("id")[0]?identifyLayers[identifyGroups[y]][u].id=f[m].getElementsByTagName("id")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing id in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("geometry")[0]?identifyLayers[identifyGroups[y]][u].geometry=f[m].getElementsByTagName("geometry")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing geometry in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("fields")[0]?identifyLayers[identifyGroups[y]][u].fields=f[m].getElementsByTagName("fields")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing fields in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),f[m].getElementsByTagName("displaynames")[0]?identifyLayers[identifyGroups[y]][u].displaynames=f[m].getElementsByTagName("displaynames")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing displaynames in folder: "+identifyGroups[y]+" for layer: "+u+".","Data Error"),"Big Game GMU Boundaries"==u&&(identifyLayers[identifyGroups[y]]["Bighorn GMU"]={},identifyLayers[identifyGroups[y]]["Bighorn GMU"].url=settings.sheepUrl.slice(0,settings.sheepUrl.length-2),identifyLayers[identifyGroups[y]]["Bighorn GMU"].id=settings.sheepUrl.slice(settings.sheepUrl.length-1),identifyLayers[identifyGroups[y]]["Bighorn GMU"].geometry="polygon",identifyLayers[identifyGroups[y]]["Bighorn GMU"].fields=[settings.sheepField],identifyLayers[identifyGroups[y]]["Bighorn GMU"].displaynames=["GMU Number"],identifyLayers[identifyGroups[y]]["Goat GMU"]={},identifyLayers[identifyGroups[y]]["Goat GMU"].url=settings.goatUrl.slice(0,settings.goatUrl.length-2),identifyLayers[identifyGroups[y]]["Goat GMU"].id=settings.goatUrl.slice(settings.goatUrl.length-1),identifyLayers[identifyGroups[y]]["Goat GMU"].geometry="polygon",identifyLayers[identifyGroups[y]]["Goat GMU"].fields=[settings.goatField],identifyLayers[identifyGroups[y]]["Goat GMU"].displaynames=["GMU Number"]))}}drawInit()})}catch(e){alert("Error reading "+app+"/SettingsWidget.xml in javascript/identify.js readSettingsWidget(): "+e.message,"Data Error",e),hideLoading("")}else 404===e.status?(alert("Error: Missing "+app+"/settingsWidget.xml file.","Data Error"),hideLoading()):4===e.readyState&&500===e.status&&(alert("Error reading "+app+"/settingsWidget.xml.","Code Error"),hideLoading())},e.open("GET",i,!0),e.send()}function doIdentify(e){if(!drawing){firstClick?secondClick=!0:firstClick=!0;var i=new Date,t=i.getTime();setTimeout(function(){if(secondClick&&t-lastIdentifyTime<250)return firstClick=!1,secondClick=!1,void(map.infoWindow.isShowing&&(map.infoWindow.hide(),map.infoWindow.setTitle(""),hideLoading("")));firstClick&&(secondClick||(firstClick=!1,secondClick=!1,doIdentify2(e)))},250),lastIdentifyTime=t}}function doIdentify2(e){if(map.infoWindow.isShowing)return map.infoWindow.hide(),map.infoWindow.setTitle(""),void hideLoading("");require(["dojo/dom-construct","dojo/query","dojo/dom","dojo/on","dojo/domReady!"],function(i,t,a,n){numDatabaseCalls=0,processedDatabaseCalls=0,features=[],theEvt=e,showLoading();for(var r=0;r<identifyGroups.length;r++)groupContent[identifyGroups[r]]=null;clickPoint=e.mapPoint,map.infoWindow.hide(),map.infoWindow.setTitle("Identify"),map.infoWindow.setContent("<p align='center'>Loading...</p>"),a.byId("identifyPoint").innerHTML="Loading click point...",elevation_url&&(t(".actionList #elevation",map.infoWindow.domNode)[0]?(i.empty(t(".actionList #elevation",map.infoWindow.domNode)[0]),i.place(i.toDom("Elevation: loading..."),t(".actionList #elevation",map.infoWindow.domNode)[0])):i.create("span",{class:"action",id:"elevation",innerHTML:"Elevation: loading..."},t(".actionList",map.infoWindow.domNode)[0])),map.infoWindow.show(clickPoint),displayContent()})}function setInfoWindowHeader(){title="<span style='float:left;width:255px;text-overflow:ellipsis;'>Show: <select id='id_group' name='id_group' style='margin: 5px;color:black;' onChange='changeIdentifyGroup(this)'>";for(var e=0;e<identifyGroups.length;e++)title+="<option",identifyGroup==identifyGroups[e]&&(title+=" selected"),title+=">"+identifyGroups[e]+"</option>";title+="</select></span>",map.infoWindow.setTitle(title)}function displayContent(){require(["esri/tasks/IdentifyTask","dojo/promise/all","dojo/Deferred","esri/tasks/query","esri/tasks/QueryTask"],function(e,i,t,a,n){if(groupContent[identifyGroup])return map.infoWindow.setContent(groupContent[identifyGroup]),void hideLoading("");var r;identifyParams.geometry=clickPoint,identifyParams.mapExtent=map.extent,identifyParams.width=map.width,identifyParams.height=map.height;for(var s=-1,o=[],d=0;d<identifyLayerIds[identifyGroup].length;d++){var l=identifyLayerIds[identifyGroup][d];if(l){if(l.url.indexOf("Wildfire")>-1){for(var y=map.getLayersVisibleAtScale(),f=0,u=0;u<y.length;u++)if(y[u].id.indexOf("Wildfire")>-1){f=1;break}if(!f){alert("Cannot display incident report at this time. The external map service that provides Wildfire Perimeters is experiencing problems. This issue is out of CPW control. We will make the National Interagency Fire Center aware of this issue.","Notice");continue}r=new n(l.url);var m=new a;identifyLayers[identifyGroup][identifyGroup].url===r.url?m.outFields=identifyLayers[identifyGroup][identifyGroup].fields:identifyLayers[identifyGroup]["Wildfire Incidents"].url===r.url?(m.outFields=identifyLayers[identifyGroup]["Wildfire Incidents"].fields,m.distance=2,m.units="miles"):alert("In SettingsWidget.xml tag Wildfire Perimeters folder, must contain layers with the following names: Wildfire Perimeters or Wildfire Incidents.","Data Error"),m.geometry=clickPoint,m.returnGeometry=!0,m.spatialRelationship="esriSpatialRelIntersects",m.outSpatialReference=map.spatialReference,s=!0,o.push(r.execute(m,identifySuccess,handleQueryError));continue}if(identifyParams.layerIds=l.ids.slice(),"polygon"!=l.geometry?map.getScale()<=36112?identifyParams.tolerance=25:map.getScale()<=288895?identifyParams.tolerance=20:identifyParams.tolerance=10:identifyParams.tolerance=1,l.id_vis_only){r=new e(l.vis_url);var g=map.getLayersVisibleAtScale(map.getScale()),p=l.vis_url;"/"==l.vis_url[l.vis_url.length-1]&&(p=l.vis_url.substr(0,l.vis_url.length-1));var c=[];identifyParams.layerIds=l.vis_ids.slice(),g.forEach(function(e){if(e.url&&e.url.toLowerCase()==p.toLowerCase())if(1==e.visible){s=!1;for(var i=0;i<identifyParams.layerIds.length;i++)for(var t=identifyParams.layerIds[i];1==e.layerInfos[t].visible;){if(-1==e.layerInfos[t].parentLayerId){c.push(identifyParams.layerIds[i]);break}t=e.layerInfos[t].parentLayerId}identifyParams.layerIds=c}else-1==s&&(s=!0)})}else s=!1,r=new e(l.url);if(settings.elkUrl&&l.url==settings.elkUrl.slice(0,settings.elkUrl.lastIndexOf("/")+1)&&"Big Game GMU"!=gmu){var h=identifyParams.layerIds.indexOf(settings.elkUrl.slice(settings.elkUrl.lastIndexOf("/")+1));h>-1&&identifyParams.layerIds.splice(h,1)}0==identifyParams.layerIds.length&&(s=!0),s||o.push(r.execute(identifyParams,identifySuccess,handleQueryError))}}if("GMU and Land Management"===identifyGroup&&("Bighorn GMU"==gmu?(identifyParams.tolerance=1,identifyParams.layerIds=[settings.sheepUrl.slice(settings.sheepUrl.lastIndexOf("/")+1)],r=new e(settings.sheepUrl.slice(0,settings.sheepUrl.lastIndexOf("/")+1)),o.push(r.execute(identifyParams,identifySuccess,handleQueryError))):"Goat GMU"==gmu&&(identifyParams.tolerance=1,identifyParams.layerIds=[settings.goatUrl.slice(settings.goatUrl.lastIndexOf("/")+1)],r=new e(settings.goatUrl.slice(0,settings.goatUrl.lastIndexOf("/")+1)),o.push(r.execute(identifyParams,identifySuccess,handleQueryError)))),o&&o.length>0){var N=i(o);N.then(handleQueryResults)}else numDatabaseCalls=0,processedDatabaseCalls=0,features=[],setInfoWindowHeader(),displayInfoWindow()})}function identifySuccess(e){}function handleQueryError(e){e.details?alert("Error in identify.js/doIdentify.  "+e.details+" "+e.message+" Check "+app+"/SettingsWidget.xml urls.","Data Error"):alert("Error in identify.js/doIdentify.  "+e.message+" Check "+app+"/SettingsWidget.xml urls.","Data Error"),hideLoading("")}function handleQueryResults(e){try{if(!e)return void alert("Error in identify.js/handleQueryResults. IdentifyTask returned null.","Data Error");var t,a,n=getIdentifyHeader(identifyGroup);if("Wildfire Perimeters"==identifyGroup)return void require(["esri/tasks/query","esri/tasks/QueryTask"],function(i,r){var s;if(0==e[0].features.length&&0==e[1].features.length)return t="No "+identifyGroup,map.infoWindow.setTitle(t),getIdentifyFooter(),setInfoWindowHeader(),map.infoWindow.setContent("No Wildfire Perimeters/Incidents at this point.<br/><br/>"),groupContent[identifyGroup]="No Wildfire Perimeters/Incidents at this point.",displayElevation(),void hideLoading("");s=e[0].features.length>0?0:1,t=e[s].features[0].attributes.IncidentName,map.infoWindow.setTitle(t),a=e[s].features[0].attributes.IncidentName+"</strong><div style='padding-left: 10px;'>";var o,d=new r(irwin_to_inciweb_url),l=new i;o=0==s?e[s].features[0].attributes.IRWINID.substr(1,e[s].features[0].attributes.IRWINID.length-2).toLocaleLowerCase():e[s].features[0].attributes.IrwinID.substr(1,e[s].features[0].attributes.IrwinID.length-2).toLocaleLowerCase(),l.where="IrwinID='"+o+"'",l.outFields=["LinkURI","IrwinID"],l.returnGeometry=!1,d.execute(l,function(e){0!=e.features.length&&e.features[0].attributes&&e.features[0].attributes.LinkURI?a+="<br/><a href='"+e.features[0].attributes.LinkURI+"' target='_blank'>Incident Report</a>":a+="<br/>No incident report found",a+="</div><br/>",n+="<div><strong>"+a,groupContent[identifyGroup]=n,setInfoWindowHeader(),map.infoWindow.setContent(n),getIdentifyFooter(),displayElevation(),hideLoading("")},function(e){alert("Error in javascript/identify.js/handleQueryResults/queryTask.execute, url="+queryLayer+". Where irwinID='"+o+"'. Error message: "+e.message,"Code Error",e)})});for(e.forEach(function(e){e&&e.length>0&&e.forEach(function(e){void 0!==identifyLayers[identifyGroup][e.layerName]&&void 0!==identifyLayers[identifyGroup][e.layerName].database&&numDatabaseCalls++})}),index=0;XMLHttpRequestObjects.length>0;)XMLHttpRequestObjects.pop();setInfoWindowHeader(),e.forEach(function(e){e.length>0&&e.forEach(function(e){var t,r=e.feature;if(r.attributes.layerName=e.layerName,void 0!==identifyLayers[identifyGroup][e.layerName])if(void 0!==identifyLayers[identifyGroup][e.layerName].database)try{createMultiXMLhttpRequest();var s=app+"/"+identifyLayers[identifyGroup][e.layerName].database+"?v="+ndisVer+"&key="+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[0]];XMLHttpRequestObjects[index].open("GET",s,!0),XMLHttpRequestObjects[index].onreadystatechange=(t=index,function(){if(4==XMLHttpRequestObjects[t].readyState){if(200==XMLHttpRequestObjects[t].status){a=e.layerName+"</strong><div style='padding-left: 10px;'>";var i=createXMLdoc(XMLHttpRequestObjects[t]);for(y=0;y<identifyLayers[identifyGroup][e.layerName].displaynames.length;y++)if(y>0&&e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]&&" "!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]&&"Null"!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]&&""!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]&&("http"==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]].substring(0,4)?a+="<a href='"+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]]+"' target='_blank'>"+identifyLayers[identifyGroup][e.layerName].displaynames[y]+"</a>":"<a href"==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]].substring(0,7)&&-1==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]].indexOf("target")?a+=identifyLayers[identifyGroup][e.layerName].displaynames[y]+": "+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]].replace(">"," target='_blank'>"):a+=identifyLayers[identifyGroup][e.layerName].displaynames[y]+": "+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[y]],a+="<br/>"),identifyLayers[identifyGroup][e.layerName].position==y){if(void 0!==identifyLayers[identifyGroup][e.layerName].one2one_fields)for(j=0;j<identifyLayers[identifyGroup][e.layerName].one2one_fields.length;j++)if(i.getElementsByTagName(identifyLayers[identifyGroup][e.layerName].one2one_fields[j]).length>0){var r=i.getElementsByTagName(identifyLayers[identifyGroup][e.layerName].one2one_fields[j])[0];r.getElementsByTagName("linkname").length>0&&r.getElementsByTagName("linkurl").length>0?(a+=identifyLayers[identifyGroup][e.layerName].one2one_display[j]+": ",a+="<a href='"+r.getElementsByTagName("linkurl")[0].firstChild.nodeValue+"'>"+r.getElementsByTagName("linkname")[0].firstChild.nodeValue+"</a>",a+="<br/>"):r.childNodes.length>0&&(a+=identifyLayers[identifyGroup][e.layerName].one2one_display[j]+": ",a+=r.childNodes[0].nodeValue,a+="<br/>")}if(void 0!==identifyLayers[identifyGroup][e.layerName].one2many_fields)for(j=0;j<identifyLayers[identifyGroup][e.layerName].one2many_fields.length;j++){var o=i.getElementsByTagName(identifyLayers[identifyGroup][e.layerName].one2many_fields[j]);a+=identifyLayers[identifyGroup][e.layerName].displaynames[0]+":<ul style='margin-top: 0px; margin-bottom: 0px;'>";for(var d=0;d<o.length;d++)o[d].getElementsByTagName("linkname").length>0&&o[d].getElementsByTagName("linkurl").length>0?a+="<li><a href='"+o[d].getElementsByTagName("linkurl")[0].firstChild.nodeValue+"' target='_blank'>"+o[d].getElementsByTagName("linkname")[0].firstChild.nodeValue+"</a></li>":a+="<li>"+o[d].childNodes[0].nodeValue+"</li>";a+="</ul style='margin-bottom: 0px; margin-top: 0px;'>"}}a+="</div><br/>",processedDatabaseCalls++,-1==n.indexOf(a)&&(n+="<div><strong>"+a,groupContent[identifyGroup]=n,map.infoWindow.setContent(n),map.infoWindow.show(clickPoint)),features.push(e.feature)}else 404==XMLHttpRequestObjects[t].status?(alert("Identify failed. File not found: "+s,"Data Error"),processedDatabaseCalls=numDatabaseCalls,displayInfoWindow()):(alert("Identify failed for call to "+s+". Make sure it exists and does not have errors. Must be in the same directory as index.html or a lower directory. XMLHttpRequestObjects["+t+"].status was "+XMLHttpRequestObjects[t].status,"Data Error"),processedDatabaseCalls=numDatabaseCalls,displayInfoWindow());for(var l=!0,y=0;y<numDatabaseCalls;y++)if(!XMLHttpRequestObjects[y]||4!==XMLHttpRequestObjects[y].readyState){l=!1;break}l&&displayInfoWindow()}}),XMLHttpRequestObjects[index].send()}catch(i){alert("Identify on "+e.layerName+" failed with error: "+i.message+" in javascript/identify.js handleQueryResults().","Data Error"),console.log(i.message),hideLoading("")}else{a=e.layerName+"</strong><div style='padding-left: 10px;'>";var o=!0;for(i=0;i<identifyLayers[identifyGroup][e.layerName].displaynames.length;i++)e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]&&" "!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]&&"Null"!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]&&""!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]&&(o?o=!1:a+="<br/>","http"==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]].substring(0,4)?a+="<a href='"+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]+"' target='_blank'>"+identifyLayers[identifyGroup][e.layerName].displaynames[i]+"</a>":a+=identifyLayers[identifyGroup][e.layerName].displaynames[i]+": "+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[i]]);a+="</div></div><br/>",-1==n.indexOf(a)&&(n+="<div><strong>"+a,groupContent[identifyGroup]=n,map.infoWindow.setContent(n),map.infoWindow.show(clickPoint)),features.push(e.feature)}})}),displayInfoWindow()}catch(e){alert(e.message+" in javascript/identify.js handleQueryResults().","Code Error",e),hideLoading("")}}function highlightFeature(e){require(["esri/graphic","esri/layers/GraphicsLayer"],function(i,t){var a;"polygon"===features[e].geometry.type?a=polySymbol:"point"===features[e].geometry.type?a=pointSymbol:"line"===features[e].geometry.type&&(a=lineSymbol);var n=newGraphicsLayer();n.id="identifygraphics";for(var r=0;r<features.length;r++)features[r].attributes.layerName==features[e].attributes.layerName&&n.add(new i(features[e].geometry,a));map.addLayer(n),n=null,a=null})}function removeHighlight(){map.getLayer("identifygraphics")&&map.removeLayer(map.getLayer("identifygraphics"))}function getIdentifyHeader(e){return identifyLayers[e].desc?"<div style='height:100%;'><div class='esriPopupItemTitle'>"+e+" found at map click:</div><br/><p style='font-style:italic;top:-15px;position:relative;'>"+identifyLayers[e].desc+"</p>":"<div style='height:100%;'><div class='esriPopupItemTitle'>"+e+" found at map click:</div><br/>"}function getIdentifyFooter(){require(["dojo/dom","dijit/registry","esri/geometry/webMercatorUtils","esri/SpatialReference","esri/tasks/ProjectParameters","esri/tasks/GeometryService"],function(e,i,t,a,n,r){try{var s;if("dd"===i.byId("settings_xy_proj").value)s=t.webMercatorToGeographic(clickPoint),e.byId("identifyPoint").innerHTML="Lat Long: "+s.y.toFixed(5)+" N, "+s.x.toFixed(5)+" W";else if("dms"===i.byId("settings_xy_proj").value)s=mappoint_to_dms(clickPoint,!0),e.byId("identifyPoint").innerHTML="Lat Long: "+s[0]+" N, "+s[1]+" W";else if("dm"===i.byId("settings_xy_proj").value)s=mappoint_to_dm(clickPoint,!0),e.byId("identifyPoint").innerHTML="Lat Long: "+s[0]+" N, "+s[1]+" W";else{var o=new a(Number(i.byId("settings_xy_proj").value)),d=new n;d.geometries=[clickPoint],d.outSR=o,geometryService.project(d,function(i){var t;t=32612==o.wkid?"WGS84 UTM Zone 12N":32613==o.wkid?"WGS84 UTM Zone 13N":26912==o.wkid?"NAD83 UTM Zone 12N":26913==o.wkid?"NAD83 UTM Zone 13N":26712==o.wkid?"NAD27 UTM Zone 12N":26713==o.wkid?"NAD27 UTM Zone 13N":"unknown units",e.byId("identifyPoint").innerHTML=t+": "+i[0].x.toFixed(0)+", "+i[0].y.toFixed(0)},function(e){e.details?alert("Problem projecting point. "+e.message+" "+e.details[0],"Warning"):alert("Problem projecting point. "+e.message,"Warning"),hideLoading("")})}}catch(e){alert(e.message+" in javascript/identify.js getIdentifyFooter().","Code Error",e)}})}function changeIdentifyGroup(e){identifyGroup=e.options[e.selectedIndex].value,map.infoWindow.setContent("<p align='center'>Loading...</p>"),features=[],numDatabaseCalls=0,processedDatabaseCalls=0,displayContent()}function displayInfoWindow(){if(numDatabaseCalls==processedDatabaseCalls){if(numDatabaseCalls=0,processedDatabaseCalls=0,getIdentifyFooter(),0==features.length){var e,i="";identifyLayerIds[identifyGroup][0].id_vis_only&&(i="visible "),identifyLayers[identifyGroup].desc?(e="<div><p style='font-style:italic;top:-15px;position:relative;'>"+identifyLayers[identifyGroup].desc+"</p>No "+i+identifyGroup+" at this point.<br/><br/></div>",map.infoWindow.setContent(e),groupContent[identifyGroup]=e,e=null):(e="<div>No "+i+identifyGroup+" at this point.<br/><br/></div>",map.infoWindow.setContent(e),groupContent[identifyGroup]=e,e=null)}else if(-1!=map.infoWindow._contentPane.innerHTML.indexOf("Loading")){var t=map.infoWindow.map.infoWindow._contentPane.innerHTML+"</div>";map.infoWindow.setContent(t)}displayElevation(),map.infoWindow.show(clickPoint),hideLoading("")}}function displayElevation(){elevation_url&&require(["esri/request"],function(e){var i='{"xmin":'+map.extent.xmin+',"ymin":'+map.extent.ymin+',"xmax":'+map.extent.xmax+',"ymax":'+map.extent.ymax+',"spatialReference":{"wkid":102100,"latestWkid":102100}}',t=e({url:elevation_url+"/identify",content:{f:"json",geometry:JSON.stringify(clickPoint),geometryType:"esriGeometryPoint",tolerance:"5",mapExtent:i,sr:"102100",imageDisplay:map.width+","+map.height+",96",returnGeometry:!1},handleAs:"json",callbackParamName:"callback"});t.then(function(e){require(["dojo/dom-attr","dojo/dom-construct","dojo/query","dojo/dom","dojo/on","dojo/domReady!"],function(i,t,a,n,r){0==e.results.length||isNaN(e.results[0].attributes["Pixel Value"])?a(".actionList #elevation",map.infoWindow.domNode)[0]?(t.empty(a(".actionList #elevation",map.infoWindow.domNode)[0]),t.place(t.toDom("Elevation: data not available"),a(".actionList #elevation",map.infoWindow.domNode)[0])):t.create("span",{class:"action",id:"elevation",innerHTML:"Elevation: data not available"},a(".actionList",map.infoWindow.domNode)[0]):a(".actionList #elevation",map.infoWindow.domNode)[0]?(t.empty(a(".actionList #elevation",map.infoWindow.domNode)[0]),t.place(t.toDom("Elevation: "+Math.round(e.results[0].attributes["Pixel Value"])+" ft "+Math.round(.3048*e.results[0].attributes["Pixel Value"])+" m"),a(".actionList #elevation",map.infoWindow.domNode)[0])):t.create("span",{class:"action",id:"elevation",innerHTML:"Elevation: "+Math.round(e.results[0].attributes["Pixel Value"])+" ft "+Math.round(.3048*e.results[0].attributes["Pixel Value"])+" m"},a(".actionList",map.infoWindow.domNode)[0])})},function(e){require(["dojo/dom-attr","dojo/dom-construct","dojo/query","dojo/dom","dojo/on","dojo/domReady!"],function(e,i,t,a,n){t(".actionList #elevation",map.infoWindow.domNode)[0]?(i.empty(t(".actionList #elevation",map.infoWindow.domNode)[0]),
i.place(i.toDom("Elevation: data not available"),t(".actionList #elevation",map.infoWindow.domNode)[0])):i.create("span",{class:"action",id:"elevation",innerHTML:"Elevation: data not available"},t(".actionList",map.infoWindow.domNode)[0])}),hideLoading("")})})}function getDirections(e){require(["esri/geometry/webMercatorUtils"],function(e){var i=e.webMercatorToGeographic(clickPoint),t="http://google.com/maps?output=classic&q="+i.y+","+i.x;window.open(t,"_blank")})}function zoomToPt(){var e=5;map.getLevel()>5&&(e=map.getLevel()),map.centerAndZoom(clickPoint,e)}var tasks,clickPoint,identifyGroup,theEvt,polySymbol,pointSymbol,lineSymbol,identifyParams=null,features=[],numDatabaseCalls=0,processedDatabaseCalls=0,folder=[],identifyGroups=[],identifyLayers={},groupContent={},identifyLayerIds=[],show_elevation=!1,elevation_url=null,irwin_to_inciweb_url="",firstClick=!1,secondClick=!1,lastIdentifyTime=0;require(["esri/tasks/IdentifyParameters","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/PictureMarkerSymbol","dojo/_base/Color"],function(e,i,t,a,n){identifyParams=new e,identifyParams.tolerance=5,identifyParams.returnGeometry=!0,identifyParams.layerOption=e.LAYER_OPTION_ALL,polySymbol=new t(t.STYLE_SOLID,new i(i.STYLE_SOLID,new n([255,0,0]),1),new n([125,125,125,.35])),pointSymbol=new a("assets/images/i_flag.png",40,40),lineSymbol=new i(i.STYLE_SOLID,new n([255,0,10]),1)});