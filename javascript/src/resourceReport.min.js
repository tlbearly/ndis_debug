function reportInit(){require(["dojo/dom","dijit/registry","dojo/sniff","dijit/form/Select","esri/toolbars/draw","dojo/i18n!esri/nls/jsapi","esri/layers/GraphicsLayer","esri/geometry/Circle","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/_base/Color","esri/graphic","dijit/Dialog","esri/map","dijit/form/Button","esri/graphicsUtils","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/VectorTileLayer","esri/tasks/PrintTask","esri/tasks/PrintTemplate","esri/tasks/PrintParameters","esri/urlUtils","esri/geometry/webMercatorUtils","esri/tasks/query","esri/tasks/QueryTask","dojo/promise/all","dojo/on","dojo/_base/array"],function(e,t,r,n,s,o,l,d,p,u,y,m,b,f,c,h,v,B,R,L,w,I,A,E,x,_,O,M,T,S,C){function F(e){return Math.round(e/Te*72)}function N(){Me=Oe,Se=792-2*Oe,Ce=612-Me,ce=3060,he=2175,mapWidthPts=F(ce),mapHeightPts=F(he);new f({id:"reportPreviewDialog",style:{width:528*ce/he+14+"px",height:"666px",overflow:"none"},title:"Resource Report Preview",content:"<div data-dojo-type='dijit/layout/ContentPane'><button id='openReportBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Open Report</button><button id='saveReportBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Save Report</button><button id='cancelBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Cancel</button><span id='reportMsg1'></span></div><div id='reportPreview' style='width:100%;height:100%;'></div><div><button id='openReportBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Open Report</button><button id='saveReportBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Save Report</button><button id='cancelBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Cancel</button><span id='reportMsg2'></span></div>"});var a=[{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.992452562495,scale:4622324.434309},{level:8,resolution:611.4962262813797,scale:2311162.217155},{level:9,resolution:305.74811314055756,scale:1155581.108577},{level:10,resolution:152.87405657041106,scale:577790.554289},{level:11,resolution:76.43702828507324,scale:288895.277144},{level:12,resolution:38.21851414253662,scale:144447.638572},{level:13,resolution:19.10925707126831,scale:72223.819286},{level:14,resolution:9.554628535634155,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.388657133974685,scale:9027.977411},{level:17,resolution:1.1943285668550503,scale:4513.988705},{level:18,resolution:.5971642835598172,scale:2256.994353},{level:19,resolution:.29858214164761665,scale:1128.497176}];if(ve=new c("reportPreview",{showAttribution:!1,style:{width:ce+"px",height:he+"px",overflow:"auto"},autoResize:!0,logo:!1,isRubberBandZoom:!0,isScrollWheelZoom:!0,isShiftDoubleClick:!0,displayGraphicsOnPan:!r("ie"),sliderStyle:"large",basemap:de,minScale:9244649,extent:initExtent,lods:a}),Be=new l,Be.id="reportPreviewGraphicsLayer1",ve.on("layers-add-result",function(e){try{for(var t=0;t<e.layers.length;t++)e.layers[t].error&&(!0,alert("Problem loading layer: "+e.layers[t].layer.url+". "+e.layers[t].error.message+" in javascript/resourceReport.js. Check "+app+"/ResourceReportWidget.xml","Data Error"))}catch(e){alert("Resource Report Error in reportMap.on(layers-add-result): "+e.message,"Code Error",e)}}),"point"===be){for(var i=[],o=0;o<se.length;o++)i.push({label:se[o],value:parseInt(se[o])});new n({id:"distCombo",value:ne,sortByLabel:!1,labelAttr:"label",style:{width:"50px"},onChange:function(){ne=this.get("value"),Re=" within "+this.get("value")+" miles of map click",W(),_e=" ("+this.get("value")+" "+oe+" buffer radius)"},options:i},"reportDistCbo"),document.getElementById("reportDistLabel").innerHTML=" "+oe+" buffer radius",Re=" within "+t.byId("distCombo").get("value")+" miles of map click",_e=" ("+t.byId("distCombo").get("value")+" "+oe+" buffer radius)",i=null}pe=new s(map,{showTooltips:!0}),pe.on("draw-end",G),document.getElementById(fe).addEventListener("click",function(e){U()}),t.byId("reportPrintBtn").on("click",Y),t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").on("click",H),t.byId("reportCancelBtn").set("disabled",!0),t.byId("openReportBtn1").on("click",Q("open")),t.byId("saveReportBtn1").on("click",Q("save")),t.byId("openReportBtn2").on("click",Q("open")),t.byId("saveReportBtn2").on("click",Q("save")),t.byId("cancelBtn1").on("click",J),t.byId("cancelBtn2").on("click",J),e.byId("reportDiv").addEventListener("click",function(e){t.byId("reportDiv").open||H()})}function P(e){alert("WARNING: In "+app+"/ResourceReportWidget.xml file, required value missing for the "+e+".","Data Error")}function D(e){if(Ee){Pe.clear(),Be.clear();var t=new u(u.STYLE_SOLID,new m([0,0,0]),2),r=new y(y.STYLE_SOLID,t,new m([255,255,0,.1])),a=new y(y.STYLE_NULL,t),i=new b(e,r),n=new b(e,a);Pe.add(i),Be.add(n),i=null,t=null,r=null,a=null,n=null}}function W(){if(Ee){Pe.clear(),Be.clear(),xe=new d({center:Ee,geodesic:!0,radius:t.byId("distCombo").get("value"),radiusUnit:"esriMiles"});var e=new u(u.STYLE_SOLID,new m([0,0,0]),2),r=new y(y.STYLE_SOLID,e,new m([255,255,0,.1])),a=new y(y.STYLE_NULL,e),i=new b(xe,r),n=new b(xe,a);Pe.add(i),Be.add(n);var s=new p(p.STYLE_CROSS,20,e,new m([0,0,0,1])),o=new b(Ee,s);Pe.add(o),i=null,e=null,r=null,s=null,o=null,n=null}}function G(e){drawing=!1,pe.deactivate(),"polygon"===be?(document.getElementById("reportPolyBtn").className="graphBtn",Ee=e.geometry.getExtent().getCenter(),xe=e.geometry,D(e.geometry)):"point"===be&&(document.getElementById("reportPtBtn").className="graphBtn",Ee=e.geometry,W()),t.byId("reportPrintBtn").set("disabled",!1),t.byId("reportCancelBtn").set("disabled",!1)}function H(){document.getElementById(fe).className="graphBtn",drawing=!1,pe.deactivate(),Pe.clear(),Be.clear(),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").set("disabled",!0)}function U(){t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").set("disabled",!0),"graphBtnSelected"!==document.getElementById(fe).className?(Pe.clear(),Be.clear(),drawing=!0,"polygon"===be?(document.getElementById("reportPolyBtn").className="graphBtnSelected",pe.activate(s.FREEHAND_POLYGON)):"point"===be&&(o.toolbars.draw.addPoint="Click on location",document.getElementById("reportPtBtn").className="graphBtnSelected",pe.activate(s.POINT))):H()}function q(){C.forEach(ie,function(e){e.remove()}),ie=[]}function z(e){var r,a=e.layer;if(($.push(a),a.url&&a.url.toLowerCase().indexOf("mapserver")>-1)&&(null!=a.setVisibleLayers&&a.visibleLayers&&a.layerInfos)){var n=a.visibleLayers,s=a.layerInfos;for(j=0;j<a.visibleLayers.length;j++){k=a.visibleLayers[j];do{if(hideGroupSublayers.indexOf(s[k].name)>-1&&s[k].subLayerIds)for(r=0;r<s[k].subLayerIds.length;r++)if(-1==n.indexOf(s[k].subLayerIds[r])&&n.push(s[k].subLayerIds[r]),"Big Game GMU"==s[s[k].subLayerIds[r]+1].name){var o=1;"Bighorn GMU"==gmu?o=2:"Goat GMU"==gmu&&(o=3),-1==n.indexOf(s[k].subLayerIds[r]+o)&&n.push(s[k].subLayerIds[r]+o)}else-1==n.indexOf(s[k].subLayerIds[r]+1)&&n.push(s[k].subLayerIds[r]+1);k=s[k].parentLayerId}while(-1!=k)}var l=new Array(0,1,2,3,4,5,6,7,8,9);for(r=0;r<s.length;r++){-1!=n.indexOf(s[r].id)?s[r].visible=!0:-1==s[r].parentLayerId||s[r].subLayerIds?s[r].visible=!1:s[r].name.substr(s[r].name.length-3,3).indexOf("GMU")>-1?s[r].name==gmu?(-1==n.indexOf(r)&&(s[r].visible=!0),l.indexOf(parseInt(s[s[r].parentLayerId].name.substr(0,1)))>-1&&-1==n.indexOf(s[r].parentLayerId)&&(s[s[r].parentLayerId].visible=!0)):s[r].visible=!1:1==s[r].defaultVisibility&&-1===n.indexOf(s[r].parentLayerId)&&l.indexOf(parseInt(s[s[r].parentLayerId].name.substr(0,1)))>-1&&(s[s[r].parentLayerId].visible=!0);var d=n.indexOf(s[r].id);d>-1&&s[r].subLayerIds&&n.splice(d,1)}a.setVisibleLayers(n.sort(function(e,t){return e-t}),!1)}a.spatialReference=map.spatialReference,a.refresh(),ve.addLayer(a);var p=te;for(i=0;i<K.length;i++)for(j=0;j<$.length;j++)K[i]==$[j].id&&(ve.reorderLayer($[j],p),p++);K.length==$.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1))}function V(e){ee[e.target.id]<10?setTimeout(function(){X(map.getLayer(e.target.id))},500):10===ee[e.target.id]?(e.target.id.indexOf("Motor Vehicle")>-1||e.target.id.indexOf("Wildfire")>-1||e.target.id.indexOf("BLM")>-1?alert("While creating the report map, the external map service that provides "+e.target.id+" is experiencing problems.  This issue is out of CPW control. We will continue trying to load it. We apologize for any inconvenience.","External (Non-CPW) Map Service Error"):e.target.id.indexOf(layer)>-1?alert("While creating the report map, the basemap service is busy or not responding. We will continue trying to load it.","Data Error"):alert("While creating the report map, the "+e.target.id+" service is busy or not responding. We will continue trying to load it.","Data Error"),setTimeout(function(){X(map.getLayer(e.target.id))},500),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)):setTimeout(function(){X(map.getLayer(e.target.id))},1e3)}function X(e){if(t.byId("reportPreviewDialog").open){var r;if(ee[e.id]++,null===e.url&&e.graphics){r=new l({id:e.id,visible:e.visible}),r.id=e.id;var i=e.graphics;for(a=0;a<i.length;a++)g=i[a].clone(),r.add(g);return ve.addLayer(r),$.push(r),i=null,void(K.length==$.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)))}if(e.url.toLowerCase().indexOf("mapserver")>-1){if(r=new B(e.url,{opacity:parseFloat(e.opacity),id:e.id,visible:e.visible}),e.visibleLayers){for(var n=[],s=0;s<e.visibleLayers.length;s++)n.push(parseInt(e.visibleLayers[s]));r.setVisibleLayers(n),n=null}}else e.url.toLowerCase().indexOf("featureserver")>-1?r=new R(e.url,{opacity:parseFloat(e.opacity),id:e.id,visible:e.visible}):alert("Unknown map layer type for "+e.url+" in "+app+"/config.xml","Data Error");r&&(ie.push(S(r,"error",V)),ie.push(S(r,"load",z)))}}function Y(){"function"==typeof ga&&ga("send","event","resource_report","click","Resource Report","1"),"function"==typeof gtag&&gtag("event","widget_click",{widget_name:"Resource Report"}),document.getElementById("reportMsg1").innerHTML=Ne,document.getElementById("reportMsg2").innerHTML=Ne,t.byId("openReportBtn1").set("disabled",!0),t.byId("saveReportBtn1").set("disabled",!0),t.byId("openReportBtn2").set("disabled",!0),t.byId("saveReportBtn2").set("disabled",!0),ve.setExtent(v.graphicsExtent(Be.graphics),!0).then(function(){t.byId("reportPreviewDialog").set("title","Resource Report Preview "+_e),t.byId("reportPreviewDialog").show().then(function(){if(!ae){ae=!0;var e=ve.on("extent-change",function(){ve.centerAt(Ee),e.remove()})}var r=[];for(K=[],$=[],ee=[],te=0,ve.removeAllLayers(),i=0;i<map.layerIds.length;i++)map_layer=map.getLayer(map.layerIds[i]),"layer_osm"==map.layerIds[i]?(osmLayer=new OpenStreetMapLayer,osmLayer.id="layer_osm",ve.addLayer(osmLayer),osmLayer=null,te++):map_layer.attributionDataUrl&&map_layer.attributionDataUrl.indexOf("OpenStreet")>-1?(osmLayer=new OpenStreetMapLayer,osmLayer.id="layer_osm",ve.addLayer(osmLayer),osmLayer=null,te++):map.layerIds[i].indexOf("layer")>-1&&1==map.getLayer(map.layerIds[i]).visibleAtMapScale&&(map.getLayer(map.layerIds[i]).url.indexOf("MapServer")>-1?basemap=new L(map.getLayer(map.layerIds[i]).url,{id:"basemap",visible:!0}):(basemap=new w(map.getLayer(map.layerIds[i]).url,{id:"basemap",visible:!0}),basemap.setStyle(map.getLayer(map.layerIds[i]).url)),"reference"==map_layer._basemapGalleryLayerType?basemap.id="reference":i>0&&(basemap.id="basemap"+i),basemap.spatialReference=map.spatialReference,basemap._basemapGalleryLayerType=map_layer._basemapGalleryLayerType,basemap.refresh(),ve.addLayer(basemap),basemap=null,te++);for(var a=map.getLayersVisibleAtScale(),i=0;i<a.length;i++)a[i].visible&&-1==a[i].id.indexOf("layer")&&(r.push(a[i]),K.push(a[i].id));for(i=0;i<r.length;i++)r[i].visible&&(ee[r[i].id]=0,X(r[i]));0==r.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1))},function(){alert("Show map failed.","Warning")})},function(){alert("Set map extent failed.","Warning")})}function J(){q(),t.byId("reportPreviewDialog").hide()}function Z(){if(Ie){var e=[],t=[],r=[],a=document.getElementById("downloadButtons");a.style.display="block";for(var n=0;n<Ie.length;n++){t[n]=new M(we[i].url),e[n]=new O,e[n].geometry=xe,e[n].returnGeometry=!0,e[n].spatialRelationship=O.SPATIAL_REL_INTERSECTS,e[n].outFields=["*"],r.push(t[n].execute(e[n]));var s="My epic novel that I don't want to lose.",o=new Blob([s],{type:"text/plain"}),l=document.createElement("a");l.download="download.txt",l.href=window.URL.createObjectURL(o);var d=document.createElement("button");d.role="presentation",d.type="button",d.style.margin="5px",d.innerText=Ie[n].label,l.appendChild(d),a.appendChild(l)}}}function Q(e){return function(r){function a(e){var t,r,a,n;if(Le.gameBoundaries&&(u+=y,Fe.setFontSize(16),Fe.setFont(f,"bold"),"polygon"===be?Fe.text(Oe,u,"Location & Contact Information (at polygon center):"):Fe.text(Oe,u,"Location & Contact Information (at map click):"),u+=y,Fe.setFont(f,"normal"),Fe.setFontSize(m),Fe.text(Oe,u,"County:"),Fe.text(b,u,e[L].features[0].attributes.COUNTY),u+=y,Fe.text(Oe,u,"Game Mgt. Unit (GMU):"),Fe.text(b,u,e[L].features[0].attributes.GMUID.toString())),Le.contactBoundaries&&(u+=y,Fe.text(Oe,u,"Sheriff Phone:"),Fe.text(b,u,e[R].features[0].attributes.Sheriff_FOPhone),u+=2*y,Fe.setFont(f,"bold"),Fe.text(Oe,u,"CPW"),Fe.setLineWidth(.5),Fe.line(Oe,u+1,Oe+27,u+1),u+=y,Fe.setFont(f,"normal"),Fe.setFontSize(m),Fe.text(Oe,u,"CPW Area:"),Fe.text(b,u,e[R].features[0].attributes.CDOW_Area),u+=y,Fe.text(Oe,u,"CPW District:"),Fe.text(b,u,e[R].features[0].attributes.CDOW_District),u+=y,Fe.text(Oe,u,"CPW Field Office:"),Fe.text(b,u,e[R].features[0].attributes.CDOW_FOName),u+=y,Fe.text(Oe,u,"CPW Field Office Address:"),Fe.text(b,u,e[R].features[0].attributes.CDOW_FOAddress),u+=y,Fe.text(Oe,u,"CPW Field Office City, Zip:"),Fe.text(b,u,e[R].features[0].attributes.CDOW_FOCity+", CO "+e[R].features[0].attributes.CDOW_FOZipcode),u+=y,Fe.text(Oe,u,"CPW Field Office Phone:"),Fe.text(b,u,e[R].features[0].attributes.CDOW_FOPhone),u+=2*y,Fe.setFont(f,"bold"),Fe.text(Oe,u,"BLM"),Fe.setLineWidth(.5),Fe.line(Oe,u+1,Oe+27,u+1),u+=y,Fe.setFont(f,"normal"),Fe.setFontSize(m),Fe.text(Oe,u,"BLM District:"),Fe.text(b,u,e[R].features[0].attributes.BLM_District),u+=y,Fe.text(Oe,u,"BLM Field Office:"),Fe.text(b,u,e[R].features[0].attributes.BLM_FOName),u+=y,Fe.text(Oe,u,"BLM Field Office Address:"),Fe.text(b,u,e[R].features[0].attributes.BLM_FOAddress),u+=y,Fe.text(Oe,u,"BLM Field Office City, Zip:"),Fe.text(b,u,e[R].features[0].attributes.BLM_FOCity+", CO "+e[R].features[0].attributes.BLM_FOZipcode),u+=y,Fe.text(Oe,u,"BLM Field Office Phone:"),Fe.text(b,u,e[R].features[0].attributes.BLM_FOPhone),e[R].features[0].attributes.USFS_FOName)){u+=2*y,Fe.setFont(f,"bold"),Fe.text(Oe,u,"USFS"),Fe.setLineWidth(.5),Fe.line(Oe,u+1,Oe+34,u+1),u+=y,Fe.setFont(f,"normal"),Fe.setFontSize(m),Fe.text(Oe,u,"Forest:"),Fe.text(b,u,e[R].features[0].attributes.NF_NG_NAME),u+=y,Fe.text(Oe,u,"Forest Field Office:");var s=Fe.setFontSize(m).splitTextToSize(e[R].features[0].attributes.USFS_FOName,390,{fontName:"arial",fontStyle:"normal"});Fe.text(b,u,s),s.length>1&&(u+=y),u+=y,Fe.text(Oe,u,"Forest Field Office Address:"),Fe.text(b,u,e[R].features[0].attributes.USFS_FOAddress),u+=y,Fe.text(Oe,u,"Forest Field Office City, Zip:"),Fe.text(b,u,e[R].features[0].attributes.USFS_FOCity+", CO "+e[R].features[0].attributes.USFS_FOZipcode),u+=y,Fe.text(Oe,u,"Forest Field Office Phone:"),Fe.text(b,u,e[R].features[0].attributes.USFS_FOPhone)}if(Le.pointsOfInterest){t=[],r=[],a=[],n=[],ResMed=[],ResSheriff=[],ResLicAg=[],ResStPatrol=[],ResBLMOff=[],ResForOff=[],ResCPWOff=[],ResChamber=[],ResWelcome=[];for(var d=0;d<e[B].features.length;d++)feature=e[B].features[d],attr=e[B].features[d].attributes,xe.contains(feature.geometry)&&("campground"==attr.Type.toLowerCase()?"BLM"==attr.Manager?t.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"CPW"==attr.Manager||"CDOW"==attr.Manager?r.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"State Parks"==attr.Manager?a.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"USFS"==attr.Manager&&n.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"license agent"==attr.Type.toLowerCase()?ResLicAg.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"medical"==attr.Type.toLowerCase()?ResMed.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"sheriff"==attr.Type.toLowerCase()?ResSheriff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"state patrol"==attr.Type.toLowerCase()?ResStPatrol.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"blm field office"==attr.Type.toLowerCase()?ResBLMOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"forest service office"==attr.Type.toLowerCase()?ResForOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"cdow office"==attr.Type.toLowerCase()||"cpw office"==attr.Type.toLowerCase()?ResCPWOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"chamber of commerce"==attr.Type.toLowerCase()?ResChamber.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"welcome center"==attr.Type.toLowerCase()&&ResWelcome.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}));var g;(t.length>0||r.length>0||a.length>0||n.length>0)&&(t.sort(sortMultipleArryOfObj("property","name")),r.sort(sortMultipleArryOfObj("property","name")),a.sort(sortMultipleArryOfObj("property","name")),n.sort(sortMultipleArryOfObj("property","name")),l(),u=Me+14,Fe.addPage(),Fe.setFontSize(16),Fe.setFont(f,"bold"),Fe.text(Oe,u,"Campsites"+Re+":"),Fe.setFontSize(m),u+=2*y,g=[],g.push({displayname:"Property",field:"property",width:200}),g.push({displayname:"Name",field:"name",width:200}),g.push({displayname:"Website",field:"website",width:Se-400}),o("BLM",t,g),o("CPW",r,g),o("State Parks",a,g),o("USFS",n,g)),(ResChamber.length>0||ResBLMOff.length>0||ResCPWOff.length>0||ResForOff.length>0||ResLicAg.length>0||ResMed.length>0||ResSheriff.length>0||ResStPatrol.length>0||ResWelcome.length>0)&&(ResMed.sort(sortMultipleArryOfObj("city","name")),ResSheriff.sort(sortMultipleArryOfObj("city","name")),ResLicAg.sort(sortMultipleArryOfObj("city","name")),ResStPatrol.sort(sortMultipleArryOfObj("city","name")),ResBLMOff.sort(sortMultipleArryOfObj("city","name")),ResForOff.sort(sortMultipleArryOfObj("city","name")),ResCPWOff.sort(sortMultipleArryOfObj("city","name")),ResChamber.sort(sortMultipleArryOfObj("city","name")),ResWelcome.sort(sortMultipleArryOfObj("city","name")),l(),u=Me+14,Fe.addPage(),Fe.setFontSize(16),Fe.setFont(f,"bold"),Fe.text(Oe,u,"Information resources"+Re+":"),u+=2*y,g=null,g=[],g.push({displayname:"Name",field:"name",width:(Se-220)/2}),g.push({displayname:"Address",field:"address",width:(Se-220)/2}),g.push({displayname:"City",field:"city",width:120}),g.push({displayname:"Phone",field:"phone",width:100}),o("Chamber of Commerce",ResChamber,g),o("BLM Office",ResBLMOff,g),o("CPW Office",ResCPWOff,g),o("Forest Service Office",ResForOff,g),o("License Agent",ResLicAg,g),o("Medical",ResMed,g),o("Sheriff",ResSheriff,g),o("State Patrol",ResStPatrol,g),o("Welcome Center",ResWelcome,g))}we.length>0?(Le.gameBoundaries||Le.contactBoundaries||Le.pointsOfInterest?(l(),u=Me+14,Fe.addPage()):u+=y,i(e)):(l(),p())}function i(e){function t(e){var t=0;Le.gameBoundaries&&t++,Le.contactBoundaries&&t++,Le.pointsOfInterest&&t++,le=0;for(var a=0;a<we.length;a++){if(we[a].database&&""!=we[a].database){createMultiXMLhttpRequest();for(var i=we[a].keyField,n="",s=0;s<e[t].features.length;s++)e[t].features[s].attributes[i]&&""!=e[t].features[0].attributes[i]&&(0==s?n=e[t].features[s].attributes[i]:n+=","+e[t].features[s].attributes[i]);if(""==n){if(le++,Ae==le)return void r(e);t++;continue}var o=we[a].database+"?v="+ndisVer+"&key="+n;XMLHttpRequestObjects[index].open("POST",o,!0),XMLHttpRequestObjects[index].onreadystatechange=function(t){return function(){if(4==XMLHttpRequestObjects[t].readyState)if(200==XMLHttpRequestObjects[t].status){for(var a,i=createXMLdoc(XMLHttpRequestObjects[t]),n=-1,s=0;s<we.length;s++){var l=!1;if(e[s].features.length==i.getElementsByTagName("NewDataSet").length&&i.getElementsByTagName(we[s].keyField).length>0){for(var d=[],p=0;p<e[s].features.length;p++)i.getElementsByTagName("NewDataSet")[p].getElementsByTagName(we[s].keyField)[0]?d.push(i.getElementsByTagName("NewDataSet")[p].getElementsByTagName(we[s].keyField)[0].childNodes[0].nodeValue):d.push("undefined");for(l=!0,p=0;p<e[s].features.length;p++)if("undefined"!=d[p]&&d[p]!=e[s].features[p].attributes[we[s].keyField]){l=!1;break}}if(l){n=s;break}}if(-1==n)return void alert("Cannot find index for the XMLHttpRequest in javascript/resourceReport.js tableQuery(). ","Code Error");if(le++,i.childNodes[0].innerHTML&&i.childNodes[0].innerHTML.indexOf("error")>-1)return alert("Resource report error in database lookup. URL="+o+". "+i.childNodes[0].innerHTML,"Data Error"),void(le==Ae&&r(e));if(i.childNodes[0].textContent&&i.childNodes[0].textContent.indexOf("error")>-1)return alert("Resource report error in database lookup. URL="+o+". "+i.childNodes[0].textContent,"Data Error"),void(le==Ae&&r(e));for(s=0;s<i.getElementsByTagName("NewDataSet").length;s++){var u=i.getElementsByTagName("NewDataSet")[s];if(0!=u.getElementsByTagName(we[n].keyField).length){if(u.getElementsByTagName(we[n].keyField)[0].childNodes[0].nodeValue!=e[n].features[s].attributes[we[n].keyField]&&alert("Resource report error in database lookup. Key fields do not match. "+u.getElementsByTagName(we[n].keyField)[0].childNodes[0].nodeValue+" != "+e[n].features[s].attributes[we[n].keyField],"Data Error"),we[n].one2one_fields&&""!=we[n].one2one_fields)for(a=0;a<we[n].one2one_fields.length;a++)u.getElementsByTagName(we[n].one2one_fields[a])[0]&&u.getElementsByTagName(we[n].one2one_fields[a])[0].childNodes[0]&&""!=u.getElementsByTagName(we[n].one2one_fields[a])[0].childNodes[0].nodeValue&&(e[n].features[s].attributes[we[n].one2one_fields[a]]=u.getElementsByTagName(we[n].one2one_fields[a])[0].childNodes[0].nodeValue.toString());if(we[n].one2many_fields&&""!=we[n].one2many_fields)for(a=0;a<we[n].one2many_fields.length;a++){for(var g=[],y=0;y<u.getElementsByTagName(we[n].filename).length;y++){var m=u.getElementsByTagName(we[n].filename)[y];m.getElementsByTagName(we[n].one2many_fields[a])[0]&&m.getElementsByTagName(we[n].one2many_fields[a])[0].childNodes[0]&&""!=m.getElementsByTagName(we[n].one2many_fields[a])[0].childNodes[0].nodeValue&&g.push(m.getElementsByTagName(we[n].one2many_fields[a])[0].childNodes[0].nodeValue.toString())}g.sort();for(var b=0;b<g.length;b++)0==b?e[n].features[s].attributes[we[n].one2many_fields[a]]="* "+g[b]:e[n].features[s].attributes[we[n].one2many_fields[a]]+="\n* "+g[b];g=null}}}Ae==le&&r(e)}else 404==XMLHttpRequestObjects[t].status?(alert("Resource Report database lookup failed. Too many resources found. Try a smaller area. Status 404: file not found or not able to process.","Warning"),le==Ae&&r(e),hideLoading()):(alert("Resource Report database lookup failed for URL="+XMLHttpRequestObjects[t].responseURL+". (Note IE does not report the URL please use Chrome or Firefox.) Make sure it exists and does not have errors. Must be on the same machine. Edit "+app+"/ResourceReportWidget.xml.","Data Error"),le==Ae&&r(e),hideLoading())}}(index),XMLHttpRequestObjects[index].send()}t++}}function r(e){var t=0;Le.gameBoundaries&&t++,Le.contactBoundaries&&t++,Le.pointsOfInterest&&t++;for(var r=0;r<we.length;r++){we[r].title&&""!=we[r].title&&(l(),u=Me+14,Fe.addPage(),Fe.setFontSize(16),Fe.setFont(f,"bold"),"list"===we[r].type?"polygon"===be?Fe.text(Oe,u,we[r].title.replace("_distance_",ne)+" (at polygon center)"):"point"===be&&Fe.text(Oe,u,we[r].title.replace("_distance_",ne)+" (at map click)"):Fe.text(Oe,u,we[r].title.replace("_distance_",ne)),Fe.setFontSize(m),Fe.setFont(f,"normal"),u+=2*y);for(var a=[],i=[],n=0;n<we[r].displayfields.length;n++)i[n]=we[r].displayfields[n];for(var d=0;d<e[t].features.length;d++)if(feature=e[t].features[d],attr=feature.attributes,"point"==feature.geometry.type&&xe.contains(feature.geometry)||"point"!=feature.geometry.type){var g={};for(n=0;n<we[r].displayfields.length;n++)if(!i[n]&&attr[we[r].fields[n]]||attr[we[r].fields[n]]&&i[n].length<attr[we[r].fields[n]].toString().length)if(attr[we[r].fields[n]].toString().indexOf("\n")>-1)for(var b=attr[we[r].fields[n]].toString().split("\n"),c=0;c<b.length;c++)(!i[n]||i[n].length<b[c].length)&&(i[n]=b[c]);else i[n]=attr[we[r].fields[n]].toString();if(we[r].where_field&&""!=we[r].where_field){var h,v;switch("number"==we[r].where_type.toLowerCase()?(h=parseFloat(we[r].where_value),v=parseFloat(attr[we[r].where_field])):(h=we[r].where_value.toLowerCase(),v=attr[we[r].where_field].toLowerCase()),we[r].where_inequality){case"equal":if(v==h){for(n=0;n<we[r].displayfields.length;n++)g[we[r].fields[n]]=attr[we[r].fields[n]];a.push(g),g=null}break;case"not_equal":if(v!=h){for(n=0;n<we[r].displayfields.length;n++)g[we[r].fields[n]]=attr[we[r].fields[n]];a.push(g),g=null}break;case"less_than":if(v<h){for(n=0;n<we[r].displayfields.length;n++)g[we[r].fields[n]]=attr[we[r].fields[n]];a.push(g),g=null}break;case"greater_than":if(v>h){for(n=0;n<we[r].displayfields.length;n++)g[we[r].fields[n]]=attr[we[r].fields[n]];a.push(g),g=null}break;default:alert("Error in "+app+"/ResourceReportWidget.xml file in report tag, id="+we[r].id+" where_inequality must be: equal, not_equal, less_than, or greater_than.","Data Error")}}else{for(n=0;n<we[r].displayfields.length;n++)g[we[r].fields[n]]=attr[we[r].fields[n]];a.push(g),g=null}}var B=0,R=200;for(n=0;n<i.length;n++)i[n]=10+Math.round(Fe.getStringUnitWidth(i[n])*m/Fe.internal.scaleFactor),i[n]>R&&(i[n]=R),B+=i[n];var L=0;if(Se>B){var w=Math.round((Se-B)/i.length);for(n=0;n<i.length;n++)i[n]+=w,L+=i[n];L!=Se&&(i[0]+=Se-L)}else if(Se<B){var I=Se-B;for(n=0;n<i.length;n++)i[n]+=Math.round(i[n]/B*I),L+=i[n];L!=Se&&(i[0]+=Se-L)}var A=[];for(n=0;n<we[r].displayfields.length;n++)A.push({displayname:we[r].displayfields[n],field:we[r].fields[n],width:i[n]});a.length>0&&("descending"===we[r].sortorder?a.sort(descendingSortMultipleArryOfObj(we[r].sortfields)):a.sort(sortMultipleArryOfObj(we[r].sortfields)),"list"===we[r].type?s(we[r].subtitle,a,A):o(we[r].subtitle,a,A)),t++,i=null,A=null}l(),p()}if(Fe.setFontSize(16),Fe.setFont(f,"bold"),"list"===we[0].type?"polygon"===be?Fe.text(Oe,u,we[0].title.replace("_distance_",ne)+" (at polygon center)"):"point"===be&&Fe.text(Oe,u,we[0].title.replace("_distance_",ne)+" (at map click)"):Fe.text(Oe,u,we[0].title.replace("_distance_",ne)),Fe.setFontSize(m),Fe.setFont(f,"normal"),we[0].title="",u+=2*y,Ae>0){for(index=0;XMLHttpRequestObjects.length>0;)XMLHttpRequestObjects.pop();t(e)}else r(e)}function n(e){alert("Error message: "+e.message+" in ResourceReportWidget.xml at resourceReport.js, queryFaultHandler"),document.getElementById("reportMsg1").innerHTML="",document.getElementById("reportMsg2").innerHTML=""}function s(e,t,r){""!==e&&(Fe.setFont(f,"bold"),Fe.setFontSize(m),Fe.myText(Oe,u,e,{underline:!0}),u+=y),Fe.setFont(f,"normal");for(var a=0;a<r.length;a++)r[a].displayname&&(Fe.text(Oe,u,r[a].displayname+":"),Fe.text(b,u,t[0][r[a].field].toString()),u+=y);u+=y}function o(e,r,a){function i(){""!==e&&(Fe.setFont(f,"bold"),Fe.setFontSize(m),Fe.myText(Oe,u,e,{underline:!0}),u+=5),Fe.setFillColor(204,204,204),Fe.setDrawColor(0),Fe.rect(Oe,u,Se,o,"FD");var t=Oe+4;Fe.setFont(f,"normal"),u+=y;for(var r=0;r<a.length;r++)a[r].displayname&&Fe.text(t,u,a[r].displayname),t+=a[r].width,r<a.length-1&&Fe.line(t-4,u-y,t-4,u+6);u+=o}try{var n,s;if(0==r.length)return;var o=20,d=[],p=[],g=[];for(g[0]=Oe,n=0;n<r.length;n++)for(d[n]=[],p[n]=1,s=0;s<a.length;s++)r[n][a[s].field]?(""!=r[n][a[s].field]?d[n][s]=Fe.setFontSize(m).splitTextToSize(r[n][a[s].field].toString(),a[s].width-8,{fontName:"arial",fontStyle:"normal"}):d[n][s]="",d[n][s].length>p[n]&&(p[n]=d[n][s].length)):d[n][s]="",0==n&&s+1<a.length&&(g[s+1]=g[s]+a[s].width);for(u+5+o+y*p[0]+o>Ce-y&&(l(),u=Me+14,Fe.addPage()),i(),n=0;n<r.length;n++){for(s=0;s<a.length;s++)0==s&&Fe.line(g[s],u-y,g[s],u+y*(p[n]-1)+o-y),Fe.text(g[s]+4,u,d[n][s]),Fe.line(g[s]+a[s].width,u-y,g[s]+a[s].width,u+y*(p[n]-1)+o-y);Fe.line(Oe,u+y*(p[n]-1)+o-y,Se+Oe,u+y*(p[n]-1)+o-y),u+=y*p[n]+o-y,n<r.length-1&&u+y*p[n+1]+o-y>=Ce-y&&(l(),u=Me+14,Fe.addPage(),-1==e.indexOf("Continued")&&(e+=" - Continued"),i())}u+=y,d=null,g=null,p=null}catch(r){alert("Resource report error while creating table for "+e+". "+r.message,"Code Error",r),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}}function l(){Fe.setFontSize(10),Fe.setFont(f,"normal"),Fe.text(368,Ce-y,"page "+g),g++,Fe.setFontSize(m)}function d(){Fe.setFontSize(5),Fe.setFont(f,"normal"),Fe.text(Se+Oe-30,Ce-7,"page "+g),Fe.setFontSize(m)}function p(){function e(e){function r(){for(var e=Fe.output(),r=new ArrayBuffer(e.length),a=new Uint8Array(r),i=0;i<e.length;i++)a[i]=e.charCodeAt(i);var n=new Blob([a],{type:"application/pdf",encoding:"raw"});saveAs(n,"AtlasReport.pdf"),n=null,r=null,a=null,e=null,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}function a(){var e=Fe.output("datauristring"),r="<iframe width='100%' height='100%' referrerPolicy='origin' src='"+e+"'></iframe>",a=window.open();if(!a)return alert("Failed to open PDF. Make sure popups are allowed.","Warning"),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),document.getElementById("reportMsg1").innerHTML="",void(document.getElementById("reportMsg2").innerHTML="");a.document.open(),a.document.write(r),a.document.title="Atlas Report",a.document.close(),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),document.getElementById("reportMsg1").innerHTML="",document.getElementById("reportMsg2").innerHTML=""}var i=new Image;i.onerror=function(){document.getElementById("reportMsg1").innerHTML=Ne,document.getElementById("reportMsg2").innerHTML=Ne,alert("Resource report cannot load image: "+i.src,"Code Error"),i=null,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)},i.onload=function(){try{Fe.addImage(i,"JPEG",0,0,792,612),i=null,d(),"save"==je?(r(),
document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Downloaded PDF",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Downloaded PDF"):navigator.sayswho.indexOf("IE")>-1|navigator.sayswho.indexOf("Edge")>-1?(r(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Download or Open PDF in pop-up. Make sure pop-ups are enabled.",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Download or Open PDF in pop-up. Make sure pop-ups are enabled."):(a(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opening PDF in pop-up. Make sure pop-ups are enabled.",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opening PDF in pop-up. Make sure pop-ups are enabled.")}catch(e){document.getElementById("reportMsg1").innerHTML=Ne,document.getElementById("reportMsg2").innerHTML=Ne,alert("Resource report generation Error in javascript/resourceReport.js printResult() img.onload. "+e.message,"Code Error",e)}},i.src=e.url,window.location.hostname.indexOf("ndis-2020-dev")>-1?(i.src="assets/images/testmap.jpg",alert("The image in the pdf is a placeholder. <a href='"+e.url+"' target='pdf_image'>Here is a link to the true image.</a>","Note for Test Site")):-1===printServiceUrl.indexOf(window.location.hostname)&&alert("The fastmap url machine name or alias must match the printserviceurl in the ResourceReport.xml file.","Data Error")}function r(e){document.getElementById("reportMsg1").innerHTML=Ne,document.getElementById("reportMsg2").innerHTML=Ne,e.details?alert("Error creating resource report map: "+e+" Details: "+e.details,"Code Error",e):alert("Error printing resource report: "+e,"Code Error",e)}try{document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating map image for report",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating map image for report",Fe.addPage();var a=new I(printServiceUrl),i=new E,n=new A;n.exportOptions={dpi:Te,outputSize:[3150,2400]},n.layout="Letter ANSI A Landscape",n.format="JPG",n.preserveScale=!0,n.showAttribution=!1,n.layoutOptions={legendLayers:[],titleText:ge,authorText:me,customTextElements:[{Subtitle:ye}]},i.map=ve,i.template=n,a.execute(i,e,r)}catch(e){alert("Error creating map for resource report. "+e.message,"Code Error",e)}}if(Ee){t.byId("openReportBtn1").set("disabled",!0),t.byId("saveReportBtn1").set("disabled",!0),t.byId("openReportBtn2").set("disabled",!0),t.byId("saveReportBtn2").set("disabled",!0),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating tables for report...",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating tables for report...",je=e,Ce=612-Me,Fe=null,Fe=new jsPDF("landscape","pt","letter"),Fe.onerror=function(){document.getElementById("reportMsg1").innerHTML=Ne,document.getElementById("reportMsg2").innerHTML=Ne,alert("Error generating PDF for resource report.","Code Error"),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)};var u=Me+20,g=1,y=14,m=12,b=300,f="arial";Fe.setProperties({title:ue,author:"Colorado Parks and Wildlife",keywords:"hunting, fishing, atlas, ndis"}),Fe.setFontSize(22),Fe.setFont(f,"bold"),Fe.text(Oe,u,ue),u+=22,Fe.setFont(f,"normal"),Fe.setFontSize(m);var c={Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"};ke=new Date,ke=ke.toDateString(),ke="0"==ke.substr[8]?c[ke.substr(4,3)]+" "+ke.substr(9,1)+","+ke.substr(ke.length-5,ke.length):c[ke.substr(4,3)]+" "+ke.substr(8,2)+","+ke.substr(ke.length-5,ke.length),Fe.text(Oe,u,ke),u+=y,"point"===be?Fe.text(Oe,u,"X/Y at map click:"):"polygon"===be&&Fe.text(Oe,u,"X/Y at polygon center:");var h=_.webMercatorToGeographic(Ee);Fe.text(b,u,h.y.toFixed(5)+" N, "+-1*h.x.toFixed(5)+" W"),u+=y;var v,B,R,L,w=[],x=[],S=[],C=0;Le.pointsOfInterest&&(x[C]=new M(Le.pointsOfInterest.url),w[C]=new O,w[C].geometry=xe,w[C].returnGeometry=!0,w[C].spatialRelationship=O.SPATIAL_REL_INTERSECTS,w[C].outFields=["*"],S.push(x[C].execute(w[C])),B=C,C++),Le.contactBoundaries&&(w[C]=new O,x[C]=new M(Le.contactBoundaries.url),w[C].geometry=xe,w[C].returnGeometry=!0,w[C].spatialRelationship=O.SPATIAL_REL_INTERSECTS,w[C].outFields=["*"],w[C].geometry=Ee,S.push(x[C].execute(w[C])),R=C,C++),Le.gameBoundaries&&(w[C]=new O,x[C]=new M(Le.gameBoundaries.url),w[C].geometry=xe,w[C].returnGeometry=!0,w[C].spatialRelationship=O.SPATIAL_REL_INTERSECTS,w[C].outFields=["*"],w[C].geometry=Ee,S.push(x[C].execute(w[C])),L=C,C++);for(var F=0;F<we.length;F++)C,x[C]=new M(we[F].url),w[C]=new O,"list"===we[F].type?w[C].geometry=Ee:w[C].geometry=xe,w[C].returnGeometry=!0,w[C].spatialRelationship=O.SPATIAL_REL_INTERSECTS,w[C].outFields=["*"],S.push(x[C].execute(w[C])),C++;S.length>0&&(v=T(S),v.then(a),v.otherwise(n))}}}var K,$,ee,te,re,ae=!1,ie=[];try{var ne,se,oe,le,de,pe,ue,ge,ye,me,be,fe,ce,he,ve,Be,Re="",Le={pointsOfInterest:null,contactBoundaries:null,gameBoundaries:null},we=[],Ie=[],Ae=0,Ee=null,xe=null,_e="",Oe=18,Me=18,Te=300,Se=792-2*Oe,Ce=612-Me,Fe=new jsPDF("landscape","pt","letter"),Ne="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Adjust map boundaries. Click Open/Save Report when ready.",Pe=new l;Pe.id="reportGraphicsLayer1",map.addLayer(Pe);var ke,je,De=createXMLhttpRequest(),We=app+"/ResourceReportWidget.xml?v="+ndisVer;De.onerror=function(){alert("Error loading "+app+"/ResourceReportWidget.xml","Data Error")},De.onreadystatechange=function(){if(4==De.readyState)if(200==De.status){var e=createXMLdoc(De);e||alert("Missing "+app+"/ResourceReportWidget.xml file.","Data Error"),e.getElementsByTagName("reports")[0]&&alert("Warning: The reports tag has been renamed 'custom_reports'. Please fix this in "+We,"Data Error");var t=e.getElementsByTagName("custom_reports")[0]&&e.getElementsByTagName("custom_reports")[0].getElementsByTagName("report")?e.getElementsByTagName("custom_reports")[0].getElementsByTagName("report"):null;e.getElementsByTagName("reportserviceurl")[0]&&alert("reportserviceurl tag is no longer used in ResourceReportWidget.xml"),e.getElementsByTagName("printserviceurl")[0]&&alert("printserviceurl tag is no longer used in ResourceReportWidget.xml"),de=e.getElementsByTagName("basemapurl")[0]?e.getElementsByTagName("basemapurl")[0].firstChild.nodeValue:P("basemapurl tag"),ue=e.getElementsByTagName("reporttitle")[0]?e.getElementsByTagName("reporttitle")[0].firstChild.nodeValue:P("reporttitle tag"),be=e.getElementsByTagName("selectby")[0]?e.getElementsByTagName("selectby")[0].firstChild.nodeValue:"point";var r,a=e.getElementsByTagName("download_buttons")[0]&&e.getElementsByTagName("download_buttons")[0].getElementsByTagName("button")?e.getElementsByTagName("download_buttons")[0].getElementsByTagName("button"):null;if("polygon"===be)fe="reportPolyBtn",document.getElementById("polyReport").style.display="block",document.getElementById("pointReport").style.display="none",ne="";else if("point"===be){fe="reportPtBtn";var n=e.getElementsByTagName("buffer")[0]?e.getElementsByTagName("buffer")[0]:P("buffer tag");ne=n.getAttribute("default")?n.getAttribute("default"):P("default attribute of the buffer tag"),se=n.getAttribute("list")?n.getAttribute("list").split(","):P("list attribute of the buffer tag"),oe=n.getAttribute("unitslabel")?n.getAttribute("unitslabel"):P("unitslabel attribute of the buffer tag"),document.getElementById("pointReport").style.display="block",document.getElementById("polyReport").style.display="none"}else alert("Error in ResourceReportWidget.xml file. selectby tag must be point or polygon. If tag is missing 'point' will be assumed.");if(e.getElementsByTagName("pointsofinterest")[0]&&(Le.pointsOfInterest={url:e.getElementsByTagName("pointsofinterest")[0].getAttribute("url"),name:e.getElementsByTagName("pointsofinterest")[0].getAttribute("name")}),e.getElementsByTagName("contactinfo")[0]&&(Le.contactBoundaries={url:e.getElementsByTagName("contactinfo")[0].getAttribute("url"),name:e.getElementsByTagName("contactinfo")[0].getAttribute("name")}),e.getElementsByTagName("gameunits")[0]&&(Le.gameBoundaries={url:e.getElementsByTagName("gameunits")[0].getAttribute("url"),name:e.getElementsByTagName("gameunits")[0].getAttribute("name")}),t)for(i=0;i<t.length;i++)r={url:t[i].getAttribute("url")?t[i].getAttribute("url"):P("report tag, url attribute"),id:t[i].getAttribute("id")?t[i].getAttribute("id"):P("report tag, id attribute"),type:t[i].getAttribute("type")?t[i].getAttribute("type"):P("report tag, type attribute"),title:t[i].getAttribute("title")?t[i].getAttribute("title"):"",subtitle:t[i].getAttribute("subtitle")?t[i].getAttribute("subtitle"):"",displayfields:t[i].getAttribute("displayfields")?t[i].getAttribute("displayfields").split(","):P("report tag, displayfields attribute"),fields:t[i].getAttribute("fields")?t[i].getAttribute("fields").split(","):P("report tag, fields attribute"),where_field:t[i].getAttribute("where_field")?t[i].getAttribute("where_field"):"",where_inequality:t[i].getAttribute("where_inequality")?t[i].getAttribute("where_inequality"):"",where_value:t[i].getAttribute("where_value")?t[i].getAttribute("where_value"):"",where_type:t[i].getAttribute("where_type")?t[i].getAttribute("where_type"):"",sortfields:t[i].getAttribute("sortfields")?t[i].getAttribute("sortfields").split(","):t[i].getAttribute("fields").split(","),sortorder:t[i].getAttribute("sortorder")?t[i].getAttribute("sortorder"):"ascending",keyField:t[i].getAttribute("key")?t[i].getAttribute("key"):null,database:t[i].getAttribute("database")?t[i].getAttribute("database"):null,filename:t[i].getAttribute("filename")?t[i].getAttribute("filename"):null,one2one_fields:t[i].getAttribute("one2one_fields")?t[i].getAttribute("one2one_fields").split(","):null,one2one_display:t[i].getAttribute("one2one_display")?t[i].getAttribute("one2one_display").split(","):t[i].getAttribute("one2one_fields")?t[i].getAttribute("one2one_fields").split(","):null,one2many_fields:t[i].getAttribute("one2many_fields")?t[i].getAttribute("one2many_fields").split(","):null,one2many_display:t[i].getAttribute("one2many_display")?t[i].getAttribute("one2many_display").split(","):t[i].getAttribute("one2many_fields")?t[i].getAttribute("one2many_fields").split(","):null},we.push(r),r.database&&""!=r.database&&Ae++,r=null;if(a){for(i=0;i<a.length;i++)r={url:a[i].getAttribute("url")?a[i].getAttribute("url"):P("button tag, url attribute"),ids:a[i].getAttribute("ids")?a[i].getAttribute("ids"):P("button tag, ids attribute"),label:a[i].getAttribute("label")?a[i].getAttribute("label"):P("button tag, label attribute"),displayfields:a[i].getAttribute("displayfields")?a[i].getAttribute("displayfields").split(","):P("report tag, displayfields attribute"),fields:a[i].getAttribute("fields")?a[i].getAttribute("fields").split(","):P("report tag, fields attribute"),where_field:a[i].getAttribute("where_field")?a[i].getAttribute("where_field"):"",where_inequality:a[i].getAttribute("where_inequality")?a[i].getAttribute("where_inequality"):"",where_value:a[i].getAttribute("where_value")?a[i].getAttribute("where_value"):"",where_type:a[i].getAttribute("where_type")?a[i].getAttribute("where_type"):"",sortfields:a[i].getAttribute("sortfields")?a[i].getAttribute("sortfields").split(","):a[i].getAttribute("fields").split(","),sortorder:a[i].getAttribute("sortorder")?a[i].getAttribute("sortorder"):"ascending",keyField:a[i].getAttribute("key")?a[i].getAttribute("key"):null,database:a[i].getAttribute("database")?a[i].getAttribute("database"):null,filename:a[i].getAttribute("filename")?a[i].getAttribute("filename"):null,one2one_fields:a[i].getAttribute("one2one_fields")?a[i].getAttribute("one2one_fields").split(","):null,one2one_display:a[i].getAttribute("one2one_display")?a[i].getAttribute("one2one_display").split(","):a[i].getAttribute("one2one_fields")?a[i].getAttribute("one2one_fields").split(","):null,one2many_fields:a[i].getAttribute("one2many_fields")?a[i].getAttribute("one2many_fields").split(","):null,one2many_display:a[i].getAttribute("one2many_display")?a[i].getAttribute("one2many_display").split(","):a[i].getAttribute("one2many_fields")?a[i].getAttribute("one2many_fields").split(","):null},Ie.push(r),r.database&&""!=r.database&&Ae++,r=null;Z()}ge=e.getElementsByTagName("title")[0]?e.getElementsByTagName("title")[0].firstChild.nodeValue:P("title tag"),ye=e.getElementsByTagName("subtitle")[0]?e.getElementsByTagName("subtitle")[0].firstChild.nodeValue:P("subtitle tag"),me=e.getElementsByTagName("disclaimer")[0]?e.getElementsByTagName("disclaimer")[0].firstChild.nodeValue:P("disclaimer tag"),N()}else 404===De.status&&alert("File: "+app+"/ResourceReportWidget.xml not found.","Data Error")},De.open("GET",We,!0),De.send(null),re=jsPDF.API,re.myText=function(e,t,r,a,i){a=a||{};var n,s=this.internal.getFontSize();n=i||this.internal.pageSize.width,txtWidth=this.getStringUnitWidth(r)*s/this.internal.scaleFactor,"center"==a.align?(e+=(n-txtWidth)/2,this.text(r,e,t)):"right"==a.align?(e+=n-(txtWidth+3),this.text(r,e,t)):1==a.underline&&(this.text(r,e,t),this.line(e,t+1,e+1.15*txtWidth,t+1))}}catch(e){alert(e.message+" in javascript/resourceReport.js reportInit.","Code Error",e)}})}