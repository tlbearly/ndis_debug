function reportInit(){require(["dojo/dom","dijit/registry","dojo/sniff","dijit/form/Select","esri/toolbars/draw","dojo/i18n!esri/nls/jsapi","esri/layers/GraphicsLayer","esri/geometry/Circle","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/_base/Color","esri/graphic","dijit/Dialog","esri/map","dijit/form/Button","esri/graphicsUtils","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/VectorTileLayer","esri/tasks/PrintTask","esri/tasks/PrintTemplate","esri/tasks/PrintParameters","esri/urlUtils","esri/geometry/webMercatorUtils","esri/tasks/query","esri/tasks/QueryTask","dojo/promise/all","dojo/on","dojo/_base/array"],function(e,t,r,n,s,o,l,d,p,u,f,y,m,b,c,h,v,B,R,w,L,I,A,x,E,O,_,M,T,S,C){function F(e){return Math.round(e/je*72)}function N(){ke=Pe,De=792-2*Pe,We=612-ke,Ie=3060,Ae=2175,mapWidthPts=F(Ie),mapHeightPts=F(Ae);new b({id:"reportPreviewDialog",style:{width:528*Ie/Ae+14+"px",height:"666px",overflow:"none"},title:"Resource Report Preview",content:"<div data-dojo-type='dijit/layout/ContentPane'><button id='openReportBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Open Report</button><button id='saveReportBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Save Report</button><button id='cancelBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Cancel</button><span id='reportMsg1'></span></div><div id='reportPreview' style='width:100%;height:100%;'></div><div><button id='openReportBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Open Report</button><button id='saveReportBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Save Report</button><button id='cancelBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Cancel</button><span id='reportMsg2'></span></div>"});var a=[{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.992452562495,scale:4622324.434309},{level:8,resolution:611.4962262813797,scale:2311162.217155},{level:9,resolution:305.74811314055756,scale:1155581.108577},{level:10,resolution:152.87405657041106,scale:577790.554289},{level:11,resolution:76.43702828507324,scale:288895.277144},{level:12,resolution:38.21851414253662,scale:144447.638572},{level:13,resolution:19.10925707126831,scale:72223.819286},{level:14,resolution:9.554628535634155,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.388657133974685,scale:9027.977411},{level:17,resolution:1.1943285668550503,scale:4513.988705},{level:18,resolution:.5971642835598172,scale:2256.994353},{level:19,resolution:.29858214164761665,scale:1128.497176}];if(xe=new c("reportPreview",{showAttribution:!1,style:{width:Ie+"px",height:Ae+"px",overflow:"auto"},autoResize:!0,logo:!1,isRubberBandZoom:!0,isScrollWheelZoom:!0,isShiftDoubleClick:!0,displayGraphicsOnPan:!r("ie"),sliderStyle:"large",basemap:be,minScale:9244649,extent:initExtent,lods:a}),Ee=new l,Ee.id="reportPreviewGraphicsLayer1",xe.on("layers-add-result",function(e){try{for(var t=0;t<e.layers.length;t++)e.layers[t].error&&(!0,alert("Problem loading layer: "+e.layers[t].layer.url+". "+e.layers[t].error.message+" in javascript/resourceReport.js. Check "+app+"/ResourceReportWidget.xml","Data Error"))}catch(e){alert("Resource Report Error in reportMap.on(layers-add-result): "+e.message,"Code Error",e)}}),"point"===we){for(var i=[],o=0;o<fe.length;o++)i.push({label:fe[o],value:parseInt(fe[o])});new n({id:"distCombo",value:ge,sortByLabel:!1,labelAttr:"label",style:{width:"50px"},onChange:function(){ge=this.get("value"),Oe=" within "+this.get("value")+" miles of map click",W(),Ne=" ("+this.get("value")+" "+ye+" buffer radius)"},options:i},"reportDistCbo"),document.getElementById("reportDistLabel").innerHTML=" "+ye+" buffer radius",Oe=" within "+t.byId("distCombo").get("value")+" miles of map click",Ne=" ("+t.byId("distCombo").get("value")+" "+ye+" buffer radius)",i=null}ce=new s(map,{showTooltips:!0}),ce.on("draw-end",G),document.getElementById(Le).addEventListener("click",function(e){U()}),t.byId("reportPrintBtn").on("click",Y),t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").on("click",H),t.byId("reportCancelBtn").set("disabled",!0),t.byId("openReportBtn1").on("click",ae("open")),t.byId("saveReportBtn1").on("click",ae("save")),t.byId("openReportBtn2").on("click",ae("open")),t.byId("saveReportBtn2").on("click",ae("save")),t.byId("cancelBtn1").on("click",J),t.byId("cancelBtn2").on("click",J),e.byId("reportDiv").addEventListener("click",function(e){t.byId("reportDiv").open||H()})}function P(e){alert("WARNING: In "+app+"/ResourceReportWidget.xml file, required value missing for the "+e+".","Data Error")}function D(e){if(Ce){Ue.clear(),Ee.clear();var t=new u(u.STYLE_SOLID,new y([0,0,0]),2),r=new f(f.STYLE_SOLID,t,new y([255,255,0,.1])),a=new f(f.STYLE_NULL,t),i=new m(e,r),n=new m(e,a);Ue.add(i),Ee.add(n),i=null,t=null,r=null,a=null,n=null}}function W(){if(Ce){Ue.clear(),Ee.clear(),Fe=new d({center:Ce,geodesic:!0,radius:t.byId("distCombo").get("value"),radiusUnit:"esriMiles"});var e=new u(u.STYLE_SOLID,new y([0,0,0]),2),r=new f(f.STYLE_SOLID,e,new y([255,255,0,.1])),a=new f(f.STYLE_NULL,e),i=new m(Fe,r),n=new m(Fe,a);Ue.add(i),Ee.add(n);var s=new p(p.STYLE_CROSS,20,e,new y([0,0,0,1])),o=new m(Ce,s);Ue.add(o),i=null,e=null,r=null,s=null,o=null,n=null}}function G(e){drawing=!1,ce.deactivate(),"polygon"===we?(document.getElementById("reportPolyBtn").className="graphBtn",Ce=e.geometry.getExtent().getCenter(),Fe=e.geometry,D(e.geometry)):"point"===we&&(document.getElementById("reportPtBtn").className="graphBtn",Ce=e.geometry,W()),t.byId("reportPrintBtn").set("disabled",!1),t.byId("reportCancelBtn").set("disabled",!1),Q()}function H(){document.getElementById(Le).className="graphBtn",drawing=!1,ce.deactivate(),Ue.clear(),Ee.clear(),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").set("disabled",!0),$()}function U(){t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").set("disabled",!0),$(),"graphBtnSelected"!==document.getElementById(Le).className?(Ue.clear(),Ee.clear(),drawing=!0,"polygon"===we?(document.getElementById("reportPolyBtn").className="graphBtnSelected",ce.activate(s.FREEHAND_POLYGON)):"point"===we&&(o.toolbars.draw.addPoint="Click on location",document.getElementById("reportPtBtn").className="graphBtnSelected",ce.activate(s.POINT))):H()}function q(){C.forEach(ue,function(e){e.remove()}),ue=[]}function z(e){var r,a=e.layer;if((ne.push(a),a.url&&a.url.toLowerCase().indexOf("mapserver")>-1)&&(null!=a.setVisibleLayers&&a.visibleLayers&&a.layerInfos)){var n=a.visibleLayers,s=a.layerInfos;for(j=0;j<a.visibleLayers.length;j++){k=a.visibleLayers[j];do{if(hideGroupSublayers.indexOf(s[k].name)>-1&&s[k].subLayerIds)for(r=0;r<s[k].subLayerIds.length;r++)if(-1==n.indexOf(s[k].subLayerIds[r])&&n.push(s[k].subLayerIds[r]),"Big Game GMU"==s[s[k].subLayerIds[r]+1].name){var o=1;"Bighorn GMU"==gmu?o=2:"Goat GMU"==gmu&&(o=3),-1==n.indexOf(s[k].subLayerIds[r]+o)&&n.push(s[k].subLayerIds[r]+o)}else-1==n.indexOf(s[k].subLayerIds[r]+1)&&n.push(s[k].subLayerIds[r]+1);k=s[k].parentLayerId}while(-1!=k)}var l=new Array(0,1,2,3,4,5,6,7,8,9);for(r=0;r<s.length;r++){-1!=n.indexOf(s[r].id)?s[r].visible=!0:-1==s[r].parentLayerId||s[r].subLayerIds?s[r].visible=!1:s[r].name.substr(s[r].name.length-3,3).indexOf("GMU")>-1?s[r].name==gmu?(-1==n.indexOf(r)&&(s[r].visible=!0),l.indexOf(parseInt(s[s[r].parentLayerId].name.substr(0,1)))>-1&&-1==n.indexOf(s[r].parentLayerId)&&(s[s[r].parentLayerId].visible=!0)):s[r].visible=!1:1==s[r].defaultVisibility&&-1===n.indexOf(s[r].parentLayerId)&&l.indexOf(parseInt(s[s[r].parentLayerId].name.substr(0,1)))>-1&&(s[s[r].parentLayerId].visible=!0);var d=n.indexOf(s[r].id);d>-1&&s[r].subLayerIds&&n.splice(d,1)}a.setVisibleLayers(n.sort(function(e,t){return e-t}),!1)}a.spatialReference=map.spatialReference,a.refresh(),xe.addLayer(a);var p=oe;for(i=0;i<ie.length;i++)for(j=0;j<ne.length;j++)ie[i]==ne[j].id&&(xe.reorderLayer(ne[j],p),p++);ie.length==ne.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1))}function V(e){se[e.target.id]<10?setTimeout(function(){X(map.getLayer(e.target.id))},500):10===se[e.target.id]?(e.target.id.indexOf("Motor Vehicle")>-1||e.target.id.indexOf("Wildfire")>-1||e.target.id.indexOf("BLM")>-1?alert("While creating the report map, the external map service that provides "+e.target.id+" is experiencing problems.  This issue is out of CPW control. We will continue trying to load it. We apologize for any inconvenience.","External (Non-CPW) Map Service Error"):e.target.id.indexOf(layer)>-1?alert("While creating the report map, the basemap service is busy or not responding. We will continue trying to load it.","Data Error"):alert("While creating the report map, the "+e.target.id+" service is busy or not responding. We will continue trying to load it.","Data Error"),setTimeout(function(){X(map.getLayer(e.target.id))},500),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)):setTimeout(function(){X(map.getLayer(e.target.id))},1e3)}function X(e){if(t.byId("reportPreviewDialog").open){var r;if(se[e.id]++,null===e.url&&e.graphics){r=new l({id:e.id,visible:e.visible}),r.id=e.id;var i=e.graphics;for(a=0;a<i.length;a++)g=i[a].clone(),r.add(g);return xe.addLayer(r),ne.push(r),i=null,void(ie.length==ne.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)))}if(e.url.toLowerCase().indexOf("mapserver")>-1){if(r=new B(e.url,{opacity:parseFloat(e.opacity),id:e.id,visible:e.visible}),e.visibleLayers){for(var n=[],s=0;s<e.visibleLayers.length;s++)n.push(parseInt(e.visibleLayers[s]));r.setVisibleLayers(n),n=null}}else e.url.toLowerCase().indexOf("featureserver")>-1?r=new R(e.url,{opacity:parseFloat(e.opacity),id:e.id,visible:e.visible}):alert("Unknown map layer type for "+e.url+" in "+app+"/config.xml","Data Error");r&&(ue.push(S(r,"error",V)),ue.push(S(r,"load",z)))}}function Y(){"function"==typeof ga&&ga("send","event","resource_report","click","Resource Report","1"),"function"==typeof gtag&&gtag("event","widget_click",{widget_name:"Resource Report"}),document.getElementById("reportMsg1").innerHTML=He,document.getElementById("reportMsg2").innerHTML=He,t.byId("openReportBtn1").set("disabled",!0),t.byId("saveReportBtn1").set("disabled",!0),t.byId("openReportBtn2").set("disabled",!0),t.byId("saveReportBtn2").set("disabled",!0),xe.setExtent(v.graphicsExtent(Ee.graphics),!0).then(function(){t.byId("reportPreviewDialog").set("title","Resource Report Preview "+Ne),t.byId("reportPreviewDialog").show().then(function(){if(!pe){pe=!0;var e=xe.on("extent-change",function(){xe.centerAt(Ce),e.remove()})}var r=[];for(ie=[],ne=[],se=[],oe=0,xe.removeAllLayers(),i=0;i<map.layerIds.length;i++)map_layer=map.getLayer(map.layerIds[i]),"layer_osm"==map.layerIds[i]?(osmLayer=new OpenStreetMapLayer,osmLayer.id="layer_osm",xe.addLayer(osmLayer),osmLayer=null,oe++):map_layer.attributionDataUrl&&map_layer.attributionDataUrl.indexOf("OpenStreet")>-1?(osmLayer=new OpenStreetMapLayer,osmLayer.id="layer_osm",xe.addLayer(osmLayer),osmLayer=null,oe++):map.layerIds[i].indexOf("layer")>-1&&1==map.getLayer(map.layerIds[i]).visibleAtMapScale&&(map.getLayer(map.layerIds[i]).url.indexOf("MapServer")>-1?basemap=new w(map.getLayer(map.layerIds[i]).url,{id:"basemap",visible:!0}):(basemap=new L(map.getLayer(map.layerIds[i]).url,{id:"basemap",visible:!0}),basemap.setStyle(map.getLayer(map.layerIds[i]).url)),"reference"==map_layer._basemapGalleryLayerType?basemap.id="reference":i>0&&(basemap.id="basemap"+i),basemap.spatialReference=map.spatialReference,basemap._basemapGalleryLayerType=map_layer._basemapGalleryLayerType,basemap.refresh(),xe.addLayer(basemap),basemap=null,oe++);for(var a=map.getLayersVisibleAtScale(),i=0;i<a.length;i++)a[i].visible&&-1==a[i].id.indexOf("layer")&&(r.push(a[i]),ie.push(a[i].id));for(i=0;i<r.length;i++)r[i].visible&&(se[r[i].id]=0,X(r[i]));0==r.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1))},function(){alert("Show map failed.","Warning")})},function(){alert("Set map extent failed.","Warning")})}function J(){q(),t.byId("reportPreviewDialog").hide()}function Z(e,t){return e.replace(/([ :\-,\'\".;?\/()!@#$%^&*+=])/g,t)}function $(){for(var e=0;e<Te.length;e++){var r=t.byId(Z(Te[e].label+"Btn","_"));r.set("disabled",!0)}}function Q(e){for(e=0;e<Te.length;e++){var r=t.byId(Z(Te[e].label+"Btn","_"));r.set("disabled",!1)}}function K(){Te&&require(["dijit/form/Button"],function(e){var t=document.getElementById("downloadButtons");t.style.display="block";for(var r=0;r<Te.length;r++){var a=Z(Te[r].label,"_"),i=a+"Btn",n=new e({label:Te[r].label,id:i,onClick:function(e){var t=e.target.parentNode.innerText.replace("\n","");ee(t)}}).placeAt(t);n.set("disabled",!0)}})}function ee(e){le=-1;for(var t=0;t<Te.length;t++)Te[t].label===e&&(le=t);if(-1!=le){e=Z(Te[le].label,"_");document.getElementById(e+"Btn").innerText+="...";for(var r,a=[],i=[],n=[],s=[],o=Te[le].visOnly,l=Te[le].url,d=Te[le].ids.split(","),p=0;p<d.length;p++)if(d[p].indexOf("-")>-1){let e=d[p].split("-");for(r=parseInt(e[0]);r<parseInt(e[1])+1;r++)i.push(r)}else i.push(d[p]);var u="";if(o)for(r=0;r<map.layerIds.length;r++)if("/"!=l[l.length-1]&&(l+="/"),l===map.getLayer(map.layerIds[r]).url){u=map.layerIds[r];break}for(var g=0;g<i.length;g++){if(l=Te[le].url+"/"+i[g],l=l.replace(/\/\/([^\/\/]*)$/,"/$1"),1==o){var f=!1;if(map.getLayer(u).visibleLayers.includes(parseInt(i[g]))&&(f=!0),!f)continue}s[g]=new M(l),n[g]=new _,n[g].geometry=Fe,n[g].returnGeometry=!0,n[g].spatialRelationship=_.SPATIAL_REL_INTERSECTS,n[g].outFields=["*"],a.push(s[g].execute(n[g]))}a.length>0?(promises=T(a),promises.then(te),promises.otherwise(re)):(alert("Download file for "+e+" was not created since the data is not currently visible.","Notice"),document.getElementById(e+"Btn").innerText=document.getElementById(e+"Btn").innerText.replace("...",""))}else alert("Download button "+e+" not found!")}function te(e){for(var t=[],r=!0,a=0;a<e.length;a++){0!=e[a].features.length&&(r=!1);for(var i=0;i<e[a].features.length;i++){var n=e[a].features[i],s=n.attributes;if("point"==n.geometry.type&&Fe.contains(n.geometry)||"point"!=n.geometry.type){var o={};for(u=0;u<Te[le].displayfields.length;u++)"wgs84x"===Te[le].fields[u].toLowerCase()?o[Te[le].fields[u]]=n.geometry.x:"wgs84y"===Te[le].fields[u].toLowerCase()?o[Te[le].fields[u]]=n.geometry.y:o[Te[le].fields[u]]=s[Te[le].fields[u]];t.push(o),o=null}}}var l=Z(Te[le].label,"_");if(r)alert("No data found for "+Te[le].label,"Notice");else{"descending"===Te[le].sortorder?t.sort(descendingSortMultipleArryOfObj(Te[le].sortfields)):t.sort(sortMultipleArryOfObj(Te[le].sortfields));var d="";for(u=0;u<Te[le].displayfields.length;u++)u==Te[le].displayfields.length-1?d+=Te[le].displayfields[u]+"\n":d+=Te[le].displayfields[u]+",";for(var p=0;p<t.length;p++)for(var u=0;u<Te[le].fields.length;u++)u==Te[le].fields.length-1?d+=t[p][Te[le].fields[u]]+"\n":d+=t[p][Te[le].fields[u]]+",";var g=new Blob([d],{type:"text/plain"});saveAs(g,l+".csv")}var f=document.getElementById(l+"Btn");f.innerText=f.innerText.replace("...","")}function re(e){alert("Error creating file to download. Message: "+e.message+" in ResourceReportWidget.xml at resourceReport.js, queryCSVFaultHandler")}function ae(e){return function(r){function a(e){var t,r,a,n;if(_e.gameBoundaries&&(u+=f,Ge.setFontSize(16),Ge.setFont(b,"bold"),"polygon"===we?Ge.text(Pe,u,"Location & Contact Information (at polygon center):"):Ge.text(Pe,u,"Location & Contact Information (at map click):"),u+=f,Ge.setFont(b,"normal"),Ge.setFontSize(y),Ge.text(Pe,u,"County:"),Ge.text(m,u,e[w].features[0].attributes.COUNTY),u+=f,Ge.text(Pe,u,"Game Mgt. Unit (GMU):"),Ge.text(m,u,e[w].features[0].attributes.GMUID.toString())),_e.contactBoundaries&&(u+=f,Ge.text(Pe,u,"Sheriff Phone:"),Ge.text(m,u,e[R].features[0].attributes.Sheriff_FOPhone),u+=2*f,Ge.setFont(b,"bold"),Ge.text(Pe,u,"CPW"),Ge.setLineWidth(.5),Ge.line(Pe,u+1,Pe+27,u+1),u+=f,Ge.setFont(b,"normal"),Ge.setFontSize(y),Ge.text(Pe,u,"CPW Area:"),Ge.text(m,u,e[R].features[0].attributes.CDOW_Area),u+=f,Ge.text(Pe,u,"CPW District:"),Ge.text(m,u,e[R].features[0].attributes.CDOW_District),u+=f,Ge.text(Pe,u,"CPW Field Office:"),Ge.text(m,u,e[R].features[0].attributes.CDOW_FOName),u+=f,Ge.text(Pe,u,"CPW Field Office Address:"),Ge.text(m,u,e[R].features[0].attributes.CDOW_FOAddress),u+=f,Ge.text(Pe,u,"CPW Field Office City, Zip:"),Ge.text(m,u,e[R].features[0].attributes.CDOW_FOCity+", CO "+e[R].features[0].attributes.CDOW_FOZipcode),u+=f,Ge.text(Pe,u,"CPW Field Office Phone:"),Ge.text(m,u,e[R].features[0].attributes.CDOW_FOPhone),u+=2*f,Ge.setFont(b,"bold"),Ge.text(Pe,u,"BLM"),Ge.setLineWidth(.5),Ge.line(Pe,u+1,Pe+27,u+1),u+=f,Ge.setFont(b,"normal"),Ge.setFontSize(y),Ge.text(Pe,u,"BLM District:"),Ge.text(m,u,e[R].features[0].attributes.BLM_District),u+=f,Ge.text(Pe,u,"BLM Field Office:"),Ge.text(m,u,e[R].features[0].attributes.BLM_FOName),u+=f,Ge.text(Pe,u,"BLM Field Office Address:"),Ge.text(m,u,e[R].features[0].attributes.BLM_FOAddress),u+=f,Ge.text(Pe,u,"BLM Field Office City, Zip:"),Ge.text(m,u,e[R].features[0].attributes.BLM_FOCity+", CO "+e[R].features[0].attributes.BLM_FOZipcode),u+=f,Ge.text(Pe,u,"BLM Field Office Phone:"),Ge.text(m,u,e[R].features[0].attributes.BLM_FOPhone),e[R].features[0].attributes.USFS_FOName)){u+=2*f,Ge.setFont(b,"bold"),Ge.text(Pe,u,"USFS"),Ge.setLineWidth(.5),Ge.line(Pe,u+1,Pe+34,u+1),u+=f,Ge.setFont(b,"normal"),Ge.setFontSize(y),Ge.text(Pe,u,"Forest:"),Ge.text(m,u,e[R].features[0].attributes.NF_NG_NAME),u+=f,Ge.text(Pe,u,"Forest Field Office:");var s=Ge.setFontSize(y).splitTextToSize(e[R].features[0].attributes.USFS_FOName,390,{fontName:"arial",fontStyle:"normal"});Ge.text(m,u,s),s.length>1&&(u+=f),u+=f,Ge.text(Pe,u,"Forest Field Office Address:"),Ge.text(m,u,e[R].features[0].attributes.USFS_FOAddress),u+=f,Ge.text(Pe,u,"Forest Field Office City, Zip:"),Ge.text(m,u,e[R].features[0].attributes.USFS_FOCity+", CO "+e[R].features[0].attributes.USFS_FOZipcode),u+=f,Ge.text(Pe,u,"Forest Field Office Phone:"),Ge.text(m,u,e[R].features[0].attributes.USFS_FOPhone)}if(_e.pointsOfInterest){t=[],r=[],a=[],n=[],ResMed=[],ResSheriff=[],ResLicAg=[],ResStPatrol=[],ResBLMOff=[],ResForOff=[],ResCPWOff=[],ResChamber=[],ResWelcome=[];for(var d=0;d<e[B].features.length;d++)feature=e[B].features[d],attr=e[B].features[d].attributes,Fe.contains(feature.geometry)&&("campground"==attr.Type.toLowerCase()?"BLM"==attr.Manager?t.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"CPW"==attr.Manager||"CDOW"==attr.Manager?r.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"State Parks"==attr.Manager?a.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"USFS"==attr.Manager&&n.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"license agent"==attr.Type.toLowerCase()?ResLicAg.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"medical"==attr.Type.toLowerCase()?ResMed.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"sheriff"==attr.Type.toLowerCase()?ResSheriff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"state patrol"==attr.Type.toLowerCase()?ResStPatrol.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"blm field office"==attr.Type.toLowerCase()?ResBLMOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"forest service office"==attr.Type.toLowerCase()?ResForOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"cdow office"==attr.Type.toLowerCase()||"cpw office"==attr.Type.toLowerCase()?ResCPWOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"chamber of commerce"==attr.Type.toLowerCase()?ResChamber.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"welcome center"==attr.Type.toLowerCase()&&ResWelcome.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}));var g;(t.length>0||r.length>0||a.length>0||n.length>0)&&(t.sort(sortMultipleArryOfObj("property","name")),r.sort(sortMultipleArryOfObj("property","name")),a.sort(sortMultipleArryOfObj("property","name")),n.sort(sortMultipleArryOfObj("property","name")),l(),u=ke+14,Ge.addPage(),Ge.setFontSize(16),Ge.setFont(b,"bold"),Ge.text(Pe,u,"Campsites"+Oe+":"),Ge.setFontSize(y),u+=2*f,g=[],g.push({displayname:"Property",field:"property",width:200}),g.push({displayname:"Name",field:"name",width:200}),g.push({displayname:"Website",field:"website",width:De-400}),o("BLM",t,g),o("CPW",r,g),o("State Parks",a,g),o("USFS",n,g)),(ResChamber.length>0||ResBLMOff.length>0||ResCPWOff.length>0||ResForOff.length>0||ResLicAg.length>0||ResMed.length>0||ResSheriff.length>0||ResStPatrol.length>0||ResWelcome.length>0)&&(ResMed.sort(sortMultipleArryOfObj("city","name")),ResSheriff.sort(sortMultipleArryOfObj("city","name")),ResLicAg.sort(sortMultipleArryOfObj("city","name")),ResStPatrol.sort(sortMultipleArryOfObj("city","name")),ResBLMOff.sort(sortMultipleArryOfObj("city","name")),ResForOff.sort(sortMultipleArryOfObj("city","name")),ResCPWOff.sort(sortMultipleArryOfObj("city","name")),ResChamber.sort(sortMultipleArryOfObj("city","name")),ResWelcome.sort(sortMultipleArryOfObj("city","name")),l(),u=ke+14,Ge.addPage(),Ge.setFontSize(16),Ge.setFont(b,"bold"),Ge.text(Pe,u,"Information resources"+Oe+":"),u+=2*f,g=null,g=[],g.push({displayname:"Name",field:"name",width:(De-220)/2}),g.push({displayname:"Address",field:"address",width:(De-220)/2}),g.push({displayname:"City",field:"city",width:120}),g.push({displayname:"Phone",field:"phone",width:100}),o("Chamber of Commerce",ResChamber,g),o("BLM Office",ResBLMOff,g),o("CPW Office",ResCPWOff,g),o("Forest Service Office",ResForOff,g),o("License Agent",ResLicAg,g),o("Medical",ResMed,g),o("Sheriff",ResSheriff,g),o("State Patrol",ResStPatrol,g),o("Welcome Center",ResWelcome,g))}Me.length>0?(_e.gameBoundaries||_e.contactBoundaries||_e.pointsOfInterest?(l(),u=ke+14,Ge.addPage()):u+=f,i(e)):(l(),p())}function i(e){function t(e){var t=0;_e.gameBoundaries&&t++,_e.contactBoundaries&&t++,_e.pointsOfInterest&&t++,me=0;for(var a=0;a<Me.length;a++){if(Me[a].database&&""!=Me[a].database){createMultiXMLhttpRequest();for(var i=Me[a].keyField,n="",s=0;s<e[t].features.length;s++)e[t].features[s].attributes[i]&&""!=e[t].features[0].attributes[i]&&(0==s?n=e[t].features[s].attributes[i]:n+=","+e[t].features[s].attributes[i]);if(""==n){if(me++,Se==me)return void r(e);t++;continue}var o=Me[a].database+"?v="+ndisVer+"&key="+n;XMLHttpRequestObjects[index].open("POST",o,!0),XMLHttpRequestObjects[index].onreadystatechange=function(t){return function(){if(4==XMLHttpRequestObjects[t].readyState)if(200==XMLHttpRequestObjects[t].status){for(var a,i=createXMLdoc(XMLHttpRequestObjects[t]),n=-1,s=0;s<Me.length;s++){var l=!1;if(e[s].features.length==i.getElementsByTagName("NewDataSet").length&&i.getElementsByTagName(Me[s].keyField).length>0){for(var d=[],p=0;p<e[s].features.length;p++)i.getElementsByTagName("NewDataSet")[p].getElementsByTagName(Me[s].keyField)[0]?d.push(i.getElementsByTagName("NewDataSet")[p].getElementsByTagName(Me[s].keyField)[0].childNodes[0].nodeValue):d.push("undefined");for(l=!0,p=0;p<e[s].features.length;p++)if("undefined"!=d[p]&&d[p]!=e[s].features[p].attributes[Me[s].keyField]){l=!1;break}}if(l){n=s;break}}if(-1==n)return void alert("Cannot find index for the XMLHttpRequest in javascript/resourceReport.js tableQuery(). ","Code Error");if(me++,i.childNodes[0].innerHTML&&i.childNodes[0].innerHTML.indexOf("error")>-1)return alert("Resource report error in database lookup. URL="+o+". "+i.childNodes[0].innerHTML,"Data Error"),void(me==Se&&r(e));if(i.childNodes[0].textContent&&i.childNodes[0].textContent.indexOf("error")>-1)return alert("Resource report error in database lookup. URL="+o+". "+i.childNodes[0].textContent,"Data Error"),void(me==Se&&r(e));for(s=0;s<i.getElementsByTagName("NewDataSet").length;s++){var u=i.getElementsByTagName("NewDataSet")[s];if(0!=u.getElementsByTagName(Me[n].keyField).length){if(u.getElementsByTagName(Me[n].keyField)[0].childNodes[0].nodeValue!=e[n].features[s].attributes[Me[n].keyField]&&alert("Resource report error in database lookup. Key fields do not match. "+u.getElementsByTagName(Me[n].keyField)[0].childNodes[0].nodeValue+" != "+e[n].features[s].attributes[Me[n].keyField],"Data Error"),Me[n].one2one_fields&&""!=Me[n].one2one_fields)for(a=0;a<Me[n].one2one_fields.length;a++)u.getElementsByTagName(Me[n].one2one_fields[a])[0]&&u.getElementsByTagName(Me[n].one2one_fields[a])[0].childNodes[0]&&""!=u.getElementsByTagName(Me[n].one2one_fields[a])[0].childNodes[0].nodeValue&&(e[n].features[s].attributes[Me[n].one2one_fields[a]]=u.getElementsByTagName(Me[n].one2one_fields[a])[0].childNodes[0].nodeValue.toString());if(Me[n].one2many_fields&&""!=Me[n].one2many_fields)for(a=0;a<Me[n].one2many_fields.length;a++){for(var g=[],f=0;f<u.getElementsByTagName(Me[n].filename).length;f++){var y=u.getElementsByTagName(Me[n].filename)[f];y.getElementsByTagName(Me[n].one2many_fields[a])[0]&&y.getElementsByTagName(Me[n].one2many_fields[a])[0].childNodes[0]&&""!=y.getElementsByTagName(Me[n].one2many_fields[a])[0].childNodes[0].nodeValue&&g.push(y.getElementsByTagName(Me[n].one2many_fields[a])[0].childNodes[0].nodeValue.toString())}g.sort();for(var m=0;m<g.length;m++)0==m?e[n].features[s].attributes[Me[n].one2many_fields[a]]="* "+g[m]:e[n].features[s].attributes[Me[n].one2many_fields[a]]+="\n* "+g[m];g=null}}}Se==me&&r(e)}else 404==XMLHttpRequestObjects[t].status?(alert("Resource Report database lookup failed. Too many resources found. Try a smaller area. Status 404: file not found or not able to process.","Warning"),me==Se&&r(e),hideLoading()):(alert("Resource Report database lookup failed for URL="+XMLHttpRequestObjects[t].responseURL+". (Note IE does not report the URL please use Chrome or Firefox.) Make sure it exists and does not have errors. Must be on the same machine. Edit "+app+"/ResourceReportWidget.xml.","Data Error"),me==Se&&r(e),hideLoading())}}(index),XMLHttpRequestObjects[index].send()}t++}}function r(e){var t=0;_e.gameBoundaries&&t++,_e.contactBoundaries&&t++,_e.pointsOfInterest&&t++;for(var r=0;r<Me.length;r++){Me[r].title&&""!=Me[r].title&&(l(),u=ke+14,Ge.addPage(),Ge.setFontSize(16),Ge.setFont(b,"bold"),"list"===Me[r].type?"polygon"===we?Ge.text(Pe,u,Me[r].title.replace("_distance_",ge)+" (at polygon center)"):"point"===we&&Ge.text(Pe,u,Me[r].title.replace("_distance_",ge)+" (at map click)"):Ge.text(Pe,u,Me[r].title.replace("_distance_",ge)),Ge.setFontSize(y),Ge.setFont(b,"normal"),u+=2*f);for(var a=[],i=[],n=0;n<Me[r].displayfields.length;n++)i[n]=Me[r].displayfields[n];for(var d=0;d<e[t].features.length;d++)if(feature=e[t].features[d],attr=feature.attributes,"point"==feature.geometry.type&&Fe.contains(feature.geometry)||"point"!=feature.geometry.type){var g={};for(n=0;n<Me[r].displayfields.length;n++)if(!i[n]&&attr[Me[r].fields[n]]||attr[Me[r].fields[n]]&&i[n].length<attr[Me[r].fields[n]].toString().length)if(attr[Me[r].fields[n]].toString().indexOf("\n")>-1)for(var m=attr[Me[r].fields[n]].toString().split("\n"),c=0;c<m.length;c++)(!i[n]||i[n].length<m[c].length)&&(i[n]=m[c]);else i[n]=attr[Me[r].fields[n]].toString();if(Me[r].where_field&&""!=Me[r].where_field){var h,v;switch("number"==Me[r].where_type.toLowerCase()?(h=parseFloat(Me[r].where_value),v=parseFloat(attr[Me[r].where_field])):(h=Me[r].where_value.toLowerCase(),v=attr[Me[r].where_field].toLowerCase()),Me[r].where_inequality){case"equal":if(v==h){for(n=0;n<Me[r].displayfields.length;n++)g[Me[r].fields[n]]=attr[Me[r].fields[n]];a.push(g),g=null}break;case"not_equal":if(v!=h){for(n=0;n<Me[r].displayfields.length;n++)g[Me[r].fields[n]]=attr[Me[r].fields[n]];a.push(g),g=null}break;case"less_than":if(v<h){for(n=0;n<Me[r].displayfields.length;n++)g[Me[r].fields[n]]=attr[Me[r].fields[n]];a.push(g),g=null}break;case"greater_than":if(v>h){for(n=0;n<Me[r].displayfields.length;n++)g[Me[r].fields[n]]=attr[Me[r].fields[n]];a.push(g),g=null}break;default:alert("Error in "+app+"/ResourceReportWidget.xml file in report tag, id="+Me[r].id+" where_inequality must be: equal, not_equal, less_than, or greater_than.","Data Error")}}else{for(n=0;n<Me[r].displayfields.length;n++)g[Me[r].fields[n]]=attr[Me[r].fields[n]];a.push(g),g=null}}var B=0,R=200;for(n=0;n<i.length;n++)i[n]=10+Math.round(Ge.getStringUnitWidth(i[n])*y/Ge.internal.scaleFactor),i[n]>R&&(i[n]=R),B+=i[n];var w=0;if(De>B){var L=Math.round((De-B)/i.length);for(n=0;n<i.length;n++)i[n]+=L,w+=i[n];w!=De&&(i[0]+=De-w)}else if(De<B){var I=De-B;for(n=0;n<i.length;n++)i[n]+=Math.round(i[n]/B*I),w+=i[n];w!=De&&(i[0]+=De-w)}var A=[];for(n=0;n<Me[r].displayfields.length;n++)A.push({displayname:Me[r].displayfields[n],field:Me[r].fields[n],width:i[n]});a.length>0&&("descending"===Me[r].sortorder?a.sort(descendingSortMultipleArryOfObj(Me[r].sortfields)):a.sort(sortMultipleArryOfObj(Me[r].sortfields)),"list"===Me[r].type?s(Me[r].subtitle,a,A):o(Me[r].subtitle,a,A)),t++,i=null,A=null}l(),p()}if(Ge.setFontSize(16),Ge.setFont(b,"bold"),"list"===Me[0].type?"polygon"===we?Ge.text(Pe,u,Me[0].title.replace("_distance_",ge)+" (at polygon center)"):"point"===we&&Ge.text(Pe,u,Me[0].title.replace("_distance_",ge)+" (at map click)"):Ge.text(Pe,u,Me[0].title.replace("_distance_",ge)),Ge.setFontSize(y),Ge.setFont(b,"normal"),Me[0].title="",u+=2*f,Se>0){for(index=0;XMLHttpRequestObjects.length>0;)XMLHttpRequestObjects.pop();t(e)}else r(e)}function n(e){alert("Error message: "+e.message+" in ResourceReportWidget.xml at resourceReport.js, queryFaultHandler"),document.getElementById("reportMsg1").innerHTML="",document.getElementById("reportMsg2").innerHTML=""}function s(e,t,r){""!==e&&(Ge.setFont(b,"bold"),Ge.setFontSize(y),Ge.myText(Pe,u,e,{underline:!0}),u+=f),Ge.setFont(b,"normal");for(var a=0;a<r.length;a++)r[a].displayname&&(Ge.text(Pe,u,r[a].displayname+":"),Ge.text(m,u,t[0][r[a].field].toString()),u+=f);u+=f}function o(e,r,a){function i(){""!==e&&(Ge.setFont(b,"bold"),Ge.setFontSize(y),Ge.myText(Pe,u,e,{underline:!0}),u+=5),Ge.setFillColor(204,204,204),Ge.setDrawColor(0),Ge.rect(Pe,u,De,o,"FD");var t=Pe+4;Ge.setFont(b,"normal"),u+=f;for(var r=0;r<a.length;r++)a[r].displayname&&Ge.text(t,u,a[r].displayname),t+=a[r].width,r<a.length-1&&Ge.line(t-4,u-f,t-4,u+6);u+=o}try{var n,s;if(0==r.length)return;var o=20,d=[],p=[],g=[];for(g[0]=Pe,n=0;n<r.length;n++)for(d[n]=[],p[n]=1,s=0;s<a.length;s++)r[n][a[s].field]?(""!=r[n][a[s].field]?d[n][s]=Ge.setFontSize(y).splitTextToSize(r[n][a[s].field].toString(),a[s].width-8,{fontName:"arial",fontStyle:"normal"}):d[n][s]="",d[n][s].length>p[n]&&(p[n]=d[n][s].length)):d[n][s]="",0==n&&s+1<a.length&&(g[s+1]=g[s]+a[s].width);for(u+5+o+f*p[0]+o>We-f&&(l(),u=ke+14,Ge.addPage()),i(),n=0;n<r.length;n++){for(s=0;s<a.length;s++)0==s&&Ge.line(g[s],u-f,g[s],u+f*(p[n]-1)+o-f),Ge.text(g[s]+4,u,d[n][s]),
Ge.line(g[s]+a[s].width,u-f,g[s]+a[s].width,u+f*(p[n]-1)+o-f);Ge.line(Pe,u+f*(p[n]-1)+o-f,De+Pe,u+f*(p[n]-1)+o-f),u+=f*p[n]+o-f,n<r.length-1&&u+f*p[n+1]+o-f>=We-f&&(l(),u=ke+14,Ge.addPage(),-1==e.indexOf("Continued")&&(e+=" - Continued"),i())}u+=f,d=null,g=null,p=null}catch(r){alert("Resource report error while creating table for "+e+". "+r.message,"Code Error",r),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}}function l(){Ge.setFontSize(10),Ge.setFont(b,"normal"),Ge.text(368,We-f,"page "+g),g++,Ge.setFontSize(y)}function d(){Ge.setFontSize(5),Ge.setFont(b,"normal"),Ge.text(De+Pe-30,We-7,"page "+g),Ge.setFontSize(y)}function p(){function e(e){function r(){for(var e=Ge.output(),r=new ArrayBuffer(e.length),a=new Uint8Array(r),i=0;i<e.length;i++)a[i]=e.charCodeAt(i);var n=new Blob([a],{type:"application/pdf",encoding:"raw"});saveAs(n,"AtlasReport.pdf"),n=null,r=null,a=null,e=null,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}function a(){var e=Ge.output("datauristring"),r="<iframe width='100%' height='100%' referrerPolicy='origin' src='"+e+"'></iframe>",a=window.open();if(!a)return alert("Failed to open PDF. Make sure popups are allowed.","Warning"),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),document.getElementById("reportMsg1").innerHTML="",void(document.getElementById("reportMsg2").innerHTML="");a.document.open(),a.document.write(r),a.document.title="Atlas Report",a.document.close(),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),document.getElementById("reportMsg1").innerHTML="",document.getElementById("reportMsg2").innerHTML=""}var i=new Image;i.onerror=function(){document.getElementById("reportMsg1").innerHTML=He,document.getElementById("reportMsg2").innerHTML=He,alert("Resource report cannot load image: "+i.src,"Code Error"),i=null,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)},i.onload=function(){try{Ge.addImage(i,"JPEG",0,0,792,612),i=null,d(),"save"==ze?(r(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Downloaded PDF",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Downloaded PDF"):navigator.sayswho.indexOf("IE")>-1|navigator.sayswho.indexOf("Edge")>-1?(r(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Download or Open PDF in pop-up. Make sure pop-ups are enabled.",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Download or Open PDF in pop-up. Make sure pop-ups are enabled."):(a(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opening PDF in pop-up. Make sure pop-ups are enabled.",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opening PDF in pop-up. Make sure pop-ups are enabled.")}catch(e){document.getElementById("reportMsg1").innerHTML=He,document.getElementById("reportMsg2").innerHTML=He,alert("Resource report generation Error in javascript/resourceReport.js printResult() img.onload. "+e.message,"Code Error",e)}},i.src=e.url,window.location.hostname.indexOf("ndis-2020-dev")>-1?(i.src="assets/images/testmap.jpg",alert("The image in the pdf is a placeholder. <a href='"+e.url+"' target='pdf_image'>Here is a link to the true image.</a>","Note for Test Site")):window.location.hostname.toLowerCase().indexOf("gisweb")>-1?i.src=e.url.replace("https","http"):-1===printServiceUrl.indexOf(window.location.hostname)&&alert("The fastmap url machine name or alias must match the printserviceurl in the ResourceReport.xml file.","Data Error")}function r(e){document.getElementById("reportMsg1").innerHTML=He,document.getElementById("reportMsg2").innerHTML=He,e.details?alert("Error creating resource report map: "+e+" Details: "+e.details,"Code Error",e):alert("Error printing resource report: "+e,"Code Error",e)}try{document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating map image for report",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating map image for report",Ge.addPage();var a=new I(printServiceUrl),i=new x,n=new A;n.exportOptions={dpi:je,outputSize:[3150,2400]},n.layout="Letter ANSI A Landscape",n.format="JPG",n.preserveScale=!0,n.showAttribution=!1,n.layoutOptions={legendLayers:[],titleText:ve,authorText:Re,customTextElements:[{Subtitle:Be}]},i.map=xe,i.template=n,a.execute(i,e,r)}catch(e){alert("Error creating map for resource report. "+e.message,"Code Error",e)}}if(Ce){t.byId("openReportBtn1").set("disabled",!0),t.byId("saveReportBtn1").set("disabled",!0),t.byId("openReportBtn2").set("disabled",!0),t.byId("saveReportBtn2").set("disabled",!0),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating tables for report...",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating tables for report...",ze=e,We=612-ke,Ge=null,Ge=new jsPDF("landscape","pt","letter"),Ge.onerror=function(){document.getElementById("reportMsg1").innerHTML=He,document.getElementById("reportMsg2").innerHTML=He,alert("Error generating PDF for resource report.","Code Error"),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)};var u=ke+20,g=1,f=14,y=12,m=300,b="arial";Ge.setProperties({title:he,author:"Colorado Parks and Wildlife",keywords:"hunting, fishing, atlas, ndis"}),Ge.setFontSize(22),Ge.setFont(b,"bold"),Ge.text(Pe,u,he),u+=22,Ge.setFont(b,"normal"),Ge.setFontSize(y);var c={Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"};qe=new Date,qe=qe.toDateString(),qe="0"==qe.substr[8]?c[qe.substr(4,3)]+" "+qe.substr(9,1)+","+qe.substr(qe.length-5,qe.length):c[qe.substr(4,3)]+" "+qe.substr(8,2)+","+qe.substr(qe.length-5,qe.length),Ge.text(Pe,u,qe),u+=f,"point"===we?Ge.text(Pe,u,"X/Y at map click:"):"polygon"===we&&Ge.text(Pe,u,"X/Y at polygon center:");var h=O.webMercatorToGeographic(Ce);Ge.text(m,u,h.y.toFixed(5)+" N, "+-1*h.x.toFixed(5)+" W"),u+=f;var v,B,R,w,L=[],E=[],S=[],C=0;_e.pointsOfInterest&&(E[C]=new M(_e.pointsOfInterest.url),L[C]=new _,L[C].geometry=Fe,L[C].returnGeometry=!0,L[C].spatialRelationship=_.SPATIAL_REL_INTERSECTS,L[C].outFields=["*"],S.push(E[C].execute(L[C])),B=C,C++),_e.contactBoundaries&&(L[C]=new _,E[C]=new M(_e.contactBoundaries.url),L[C].returnGeometry=!0,L[C].spatialRelationship=_.SPATIAL_REL_INTERSECTS,L[C].outFields=["*"],L[C].geometry=Ce,S.push(E[C].execute(L[C])),R=C,C++),_e.gameBoundaries&&(L[C]=new _,E[C]=new M(_e.gameBoundaries.url),L[C].returnGeometry=!0,L[C].spatialRelationship=_.SPATIAL_REL_INTERSECTS,L[C].outFields=["*"],L[C].geometry=Ce,S.push(E[C].execute(L[C])),w=C,C++);for(var F=0;F<Me.length;F++)C,E[C]=new M(Me[F].url),L[C]=new _,"list"===Me[F].type?L[C].geometry=Ce:L[C].geometry=Fe,L[C].returnGeometry=!0,L[C].spatialRelationship=_.SPATIAL_REL_INTERSECTS,L[C].outFields=["*"],S.push(E[C].execute(L[C])),C++;S.length>0&&(v=T(S),v.then(a),v.otherwise(n))}}}var ie,ne,se,oe,le,de,pe=!1,ue=[];try{var ge,fe,ye,me,be,ce,he,ve,Be,Re,we,Le,Ie,Ae,xe,Ee,Oe="",_e={pointsOfInterest:null,contactBoundaries:null,gameBoundaries:null},Me=[],Te=[],Se=0,Ce=null,Fe=null,Ne="",Pe=18,ke=18,je=300,De=792-2*Pe,We=612-ke,Ge=new jsPDF("landscape","pt","letter"),He="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Adjust map boundaries. Click Open/Save Report when ready.",Ue=new l;Ue.id="reportGraphicsLayer1",map.addLayer(Ue);var qe,ze,Ve=createXMLhttpRequest(),Xe=app+"/ResourceReportWidget.xml?v="+ndisVer;Ve.onerror=function(){alert("Error loading "+app+"/ResourceReportWidget.xml","Data Error")},Ve.onreadystatechange=function(){if(4==Ve.readyState)if(200==Ve.status){var e=createXMLdoc(Ve);e||alert("Missing "+app+"/ResourceReportWidget.xml file.","Data Error"),e.getElementsByTagName("reports")[0]&&alert("Warning: The reports tag has been renamed 'custom_reports'. Please fix this in "+Xe,"Data Error");var t=e.getElementsByTagName("custom_reports")[0]&&e.getElementsByTagName("custom_reports")[0].getElementsByTagName("report")?e.getElementsByTagName("custom_reports")[0].getElementsByTagName("report"):null;e.getElementsByTagName("reportserviceurl")[0]&&alert("reportserviceurl tag is no longer used in ResourceReportWidget.xml"),e.getElementsByTagName("printserviceurl")[0]&&alert("printserviceurl tag is no longer used in ResourceReportWidget.xml"),be=e.getElementsByTagName("basemapurl")[0]?e.getElementsByTagName("basemapurl")[0].firstChild.nodeValue:P("basemapurl tag"),he=e.getElementsByTagName("reporttitle")[0]?e.getElementsByTagName("reporttitle")[0].firstChild.nodeValue:P("reporttitle tag"),we=e.getElementsByTagName("selectby")[0]?e.getElementsByTagName("selectby")[0].firstChild.nodeValue:"point";var r,a=e.getElementsByTagName("download_buttons")[0]&&e.getElementsByTagName("download_buttons")[0].getElementsByTagName("button")?e.getElementsByTagName("download_buttons")[0].getElementsByTagName("button"):null;if("polygon"===we)Le="reportPolyBtn",document.getElementById("polyReport").style.display="block",document.getElementById("pointReport").style.display="none",ge="";else if("point"===we){Le="reportPtBtn";var n=e.getElementsByTagName("buffer")[0]?e.getElementsByTagName("buffer")[0]:P("buffer tag");ge=n.getAttribute("default")?n.getAttribute("default"):P("default attribute of the buffer tag"),fe=n.getAttribute("list")?n.getAttribute("list").split(","):P("list attribute of the buffer tag"),ye=n.getAttribute("unitslabel")?n.getAttribute("unitslabel"):P("unitslabel attribute of the buffer tag"),document.getElementById("pointReport").style.display="block",document.getElementById("polyReport").style.display="none"}else alert("Error in ResourceReportWidget.xml file. selectby tag must be point or polygon. If tag is missing 'point' will be assumed.");if(e.getElementsByTagName("pointsofinterest")[0]&&(_e.pointsOfInterest={url:e.getElementsByTagName("pointsofinterest")[0].getAttribute("url"),name:e.getElementsByTagName("pointsofinterest")[0].getAttribute("name")}),e.getElementsByTagName("contactinfo")[0]&&(_e.contactBoundaries={url:e.getElementsByTagName("contactinfo")[0].getAttribute("url"),name:e.getElementsByTagName("contactinfo")[0].getAttribute("name")}),e.getElementsByTagName("gameunits")[0]&&(_e.gameBoundaries={url:e.getElementsByTagName("gameunits")[0].getAttribute("url"),name:e.getElementsByTagName("gameunits")[0].getAttribute("name")}),t)for(i=0;i<t.length;i++)r={url:t[i].getAttribute("url")?t[i].getAttribute("url"):P("report tag, url attribute"),id:t[i].getAttribute("id")?t[i].getAttribute("id"):P("report tag, id attribute"),type:t[i].getAttribute("type")?t[i].getAttribute("type"):P("report tag, type attribute"),title:t[i].getAttribute("title")?t[i].getAttribute("title"):"",subtitle:t[i].getAttribute("subtitle")?t[i].getAttribute("subtitle"):"",displayfields:t[i].getAttribute("displayfields")?t[i].getAttribute("displayfields").split(","):P("report tag, displayfields attribute"),fields:t[i].getAttribute("fields")?t[i].getAttribute("fields").split(","):P("report tag, fields attribute"),where_field:t[i].getAttribute("where_field")?t[i].getAttribute("where_field"):"",where_inequality:t[i].getAttribute("where_inequality")?t[i].getAttribute("where_inequality"):"",where_value:t[i].getAttribute("where_value")?t[i].getAttribute("where_value"):"",where_type:t[i].getAttribute("where_type")?t[i].getAttribute("where_type"):"",sortfields:t[i].getAttribute("sortfields")?t[i].getAttribute("sortfields").split(","):t[i].getAttribute("fields").split(","),sortorder:t[i].getAttribute("sortorder")?t[i].getAttribute("sortorder"):"ascending",keyField:t[i].getAttribute("key")?t[i].getAttribute("key"):null,database:t[i].getAttribute("database")?t[i].getAttribute("database"):null,filename:t[i].getAttribute("filename")?t[i].getAttribute("filename"):null,one2one_fields:t[i].getAttribute("one2one_fields")?t[i].getAttribute("one2one_fields").split(","):null,one2one_display:t[i].getAttribute("one2one_display")?t[i].getAttribute("one2one_display").split(","):t[i].getAttribute("one2one_fields")?t[i].getAttribute("one2one_fields").split(","):null,one2many_fields:t[i].getAttribute("one2many_fields")?t[i].getAttribute("one2many_fields").split(","):null,one2many_display:t[i].getAttribute("one2many_display")?t[i].getAttribute("one2many_display").split(","):t[i].getAttribute("one2many_fields")?t[i].getAttribute("one2many_fields").split(","):null},Me.push(r),r.database&&""!=r.database&&Se++,r=null;if(a){for(i=0;i<a.length;i++)r={visOnly:!!a[i].getAttribute("onlyIfVisible")&&a[i].getAttribute("onlyIfVisible")==="true".toLowerCase(),url:a[i].getAttribute("url")?a[i].getAttribute("url"):P("button tag, url attribute"),ids:a[i].getAttribute("ids")?a[i].getAttribute("ids"):P("button tag, ids attribute"),label:a[i].getAttribute("label")?a[i].getAttribute("label"):P("button tag, label attribute"),displayfields:a[i].getAttribute("displayfields")?a[i].getAttribute("displayfields").split(","):P("report tag, displayfields attribute"),fields:a[i].getAttribute("fields")?a[i].getAttribute("fields").split(","):P("report tag, fields attribute"),where_field:a[i].getAttribute("where_field")?a[i].getAttribute("where_field"):"",where_inequality:a[i].getAttribute("where_inequality")?a[i].getAttribute("where_inequality"):"",where_value:a[i].getAttribute("where_value")?a[i].getAttribute("where_value"):"",where_type:a[i].getAttribute("where_type")?a[i].getAttribute("where_type"):"",sortfields:a[i].getAttribute("sortfields")?a[i].getAttribute("sortfields").split(","):a[i].getAttribute("fields").split(","),sortorder:a[i].getAttribute("sortorder")?a[i].getAttribute("sortorder"):"ascending",keyField:a[i].getAttribute("key")?a[i].getAttribute("key"):null,database:a[i].getAttribute("database")?a[i].getAttribute("database"):null,filename:a[i].getAttribute("filename")?a[i].getAttribute("filename"):null,one2one_fields:a[i].getAttribute("one2one_fields")?a[i].getAttribute("one2one_fields").split(","):null,one2one_display:a[i].getAttribute("one2one_display")?a[i].getAttribute("one2one_display").split(","):a[i].getAttribute("one2one_fields")?a[i].getAttribute("one2one_fields").split(","):null,one2many_fields:a[i].getAttribute("one2many_fields")?a[i].getAttribute("one2many_fields").split(","):null,one2many_display:a[i].getAttribute("one2many_display")?a[i].getAttribute("one2many_display").split(","):a[i].getAttribute("one2many_fields")?a[i].getAttribute("one2many_fields").split(","):null},Te.push(r),r.database&&""!=r.database&&Se++,r=null;K()}ve=e.getElementsByTagName("title")[0]?e.getElementsByTagName("title")[0].firstChild.nodeValue:P("title tag"),Be=e.getElementsByTagName("subtitle")[0]?e.getElementsByTagName("subtitle")[0].firstChild.nodeValue:P("subtitle tag"),Re=e.getElementsByTagName("disclaimer")[0]?e.getElementsByTagName("disclaimer")[0].firstChild.nodeValue:P("disclaimer tag"),N()}else 404===Ve.status&&alert("File: "+app+"/ResourceReportWidget.xml not found.","Data Error")},Ve.open("GET",Xe,!0),Ve.send(null),de=jsPDF.API,de.myText=function(e,t,r,a,i){a=a||{};var n,s=this.internal.getFontSize();n=i||this.internal.pageSize.width,txtWidth=this.getStringUnitWidth(r)*s/this.internal.scaleFactor,"center"==a.align?(e+=(n-txtWidth)/2,this.text(r,e,t)):"right"==a.align?(e+=n-(txtWidth+3),this.text(r,e,t)):1==a.underline&&(this.text(r,e,t),this.line(e,t+1,e+1.15*txtWidth,t+1))}}catch(e){alert(e.message+" in javascript/resourceReport.js reportInit.","Code Error",e)}})}