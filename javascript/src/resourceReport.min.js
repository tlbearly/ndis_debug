function reportInit(){require(["dojo/dom","dijit/registry","dojo/sniff","dijit/form/Select","esri/toolbars/draw","dojo/i18n!esri/nls/jsapi","esri/layers/GraphicsLayer","esri/geometry/Circle","esri/symbols/SimpleMarkerSymbol","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","dojo/_base/Color","esri/graphic","dijit/Dialog","esri/map","dijit/form/Button","esri/graphicsUtils","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/VectorTileLayer","esri/tasks/PrintTask","esri/tasks/PrintTemplate","esri/tasks/PrintParameters","esri/urlUtils","esri/geometry/webMercatorUtils","esri/tasks/query","esri/tasks/QueryTask","dojo/promise/all","dojo/on","dojo/_base/array"],function(e,t,r,n,s,o,l,d,p,u,m,y,f,b,c,h,v,B,R,L,I,w,x,E,O,M,S,T,F,C,N){function A(e){return Math.round(e/Se*72)}function _(){Me=Oe,Te=792-2*Oe,Fe=612-Me,be=3060,ce=2175,mapWidthPts=A(be),mapHeightPts=A(ce);new b({id:"reportPreviewDialog",style:{width:528*be/ce+14+"px",height:"666px",overflow:"none"},title:"Resource Report Preview",content:"<div data-dojo-type='dijit/layout/ContentPane'><button id='openReportBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Open Report</button><button id='saveReportBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Save Report</button><button id='cancelBtn1' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Cancel</button><span id='reportMsg1'></span></div><div id='reportPreview' style='width:100%;height:100%;'></div><div><button id='openReportBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Open Report</button><button id='saveReportBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Save Report</button><button id='cancelBtn2' data-dojo-type='dijit/form/Button' role='presentation' type='button'>Cancel</button><span id='reportMsg2'></span></div>"});var a=[{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.992452562495,scale:4622324.434309},{level:8,resolution:611.4962262813797,scale:2311162.217155},{level:9,resolution:305.74811314055756,scale:1155581.108577},{level:10,resolution:152.87405657041106,scale:577790.554289},{level:11,resolution:76.43702828507324,scale:288895.277144},{level:12,resolution:38.21851414253662,scale:144447.638572},{level:13,resolution:19.10925707126831,scale:72223.819286},{level:14,resolution:9.554628535634155,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.388657133974685,scale:9027.977411},{level:17,resolution:1.1943285668550503,scale:4513.988705},{level:18,resolution:.5971642835598172,scale:2256.994353},{level:19,resolution:.29858214164761665,scale:1128.497176}];if(he=new c("reportPreview",{showAttribution:!1,style:{width:be+"px",height:ce+"px",overflow:"auto"},autoResize:!0,logo:!1,isRubberBandZoom:!0,isScrollWheelZoom:!0,isShiftDoubleClick:!0,displayGraphicsOnPan:!r("ie"),sliderStyle:"large",basemap:le,minScale:9244649,extent:initExtent,lods:a}),ve=new l,ve.id="reportPreviewGraphicsLayer1",he.on("layers-add-result",function(e){try{for(var t=0;t<e.layers.length;t++)e.layers[t].error&&(!0,alert("Problem loading layer: "+e.layers[t].layer.url+". "+e.layers[t].error.message+" in javascript/resourceReport.js. Check "+app+"/ResourceReportWidget.xml","Data Error"))}catch(e){alert("Resource Report Error in reportMap.on(layers-add-result): "+e.message,"Code Error",e)}}),"point"===ye){for(var i=[],o=0;o<ie.length;o++)i.push({label:ie[o],value:parseInt(ie[o])});new n({id:"distCombo",value:ne,sortByLabel:!1,labelAttr:"label",style:{width:"50px"},onChange:function(){ne=this.get("value"),Be=" within "+this.get("value")+" miles of map click",W(),Ee=" ("+this.get("value")+" "+se+" buffer radius)"},options:i},"reportDistCbo"),document.getElementById("reportDistLabel").innerHTML=" "+se+" buffer radius",Be=" within "+t.byId("distCombo").get("value")+" miles of map click",Ee=" ("+t.byId("distCombo").get("value")+" "+se+" buffer radius)",i=null}de=new s(map,{showTooltips:!0}),de.on("draw-end",G),document.getElementById(fe).addEventListener("click",function(e){U()}),t.byId("reportPrintBtn").on("click",Y),t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").on("click",H),t.byId("reportCancelBtn").set("disabled",!0),t.byId("openReportBtn1").on("click",Z("open")),t.byId("saveReportBtn1").on("click",Z("save")),t.byId("openReportBtn2").on("click",Z("open")),t.byId("saveReportBtn2").on("click",Z("save")),t.byId("cancelBtn1").on("click",J),t.byId("cancelBtn2").on("click",J),e.byId("reportDiv").addEventListener("click",function(e){t.byId("reportDiv").open||H()})}function P(e){alert("WARNING: In "+app+"/ResourceReportWidget.xml file, required value missing for the "+e+".","Data Error")}function D(e){if(we){Ae.clear(),ve.clear();var t=new u(u.STYLE_SOLID,new y([0,0,0]),2),r=new m(m.STYLE_SOLID,t,new y([255,255,0,.1])),a=new m(m.STYLE_NULL,t),n=new f(e,r),i=new f(e,a);Ae.add(n),ve.add(i),n=null,t=null,r=null,a=null,i=null}}function W(){if(we){Ae.clear(),ve.clear(),xe=new d({center:we,geodesic:!0,radius:t.byId("distCombo").get("value"),radiusUnit:"esriMiles"});var e=new u(u.STYLE_SOLID,new y([0,0,0]),2),r=new m(m.STYLE_SOLID,e,new y([255,255,0,.1])),a=new m(m.STYLE_NULL,e),n=new f(xe,r),i=new f(xe,a);Ae.add(n),ve.add(i);var s=new p(p.STYLE_CROSS,20,e,new y([0,0,0,1])),o=new f(we,s);Ae.add(o),n=null,e=null,r=null,s=null,o=null,i=null}}function G(e){drawing=!1,de.deactivate(),"polygon"===ye?(document.getElementById("reportPolyBtn").className="graphBtn",we=e.geometry.getExtent().getCenter(),xe=e.geometry,D(e.geometry)):"point"===ye&&(document.getElementById("reportPtBtn").className="graphBtn",we=e.geometry,W()),t.byId("reportPrintBtn").set("disabled",!1),t.byId("reportCancelBtn").set("disabled",!1)}function H(){document.getElementById(fe).className="graphBtn",drawing=!1,de.deactivate(),Ae.clear(),ve.clear(),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").set("disabled",!0)}function U(){t.byId("reportPrintBtn").set("disabled",!0),t.byId("reportCancelBtn").set("disabled",!0),"graphBtnSelected"!==document.getElementById(fe).className?(Ae.clear(),ve.clear(),drawing=!0,"polygon"===ye?(document.getElementById("reportPolyBtn").className="graphBtnSelected",de.activate(s.FREEHAND_POLYGON)):"point"===ye&&(o.toolbars.draw.addPoint="Click on location",document.getElementById("reportPtBtn").className="graphBtnSelected",de.activate(s.POINT))):H()}function z(){N.forEach(ae,function(e){e.remove()}),ae=[]}function q(e){var r,a=e.layer;if((K.push(a),a.url&&a.url.toLowerCase().indexOf("mapserver")>-1)&&(null!=a.setVisibleLayers&&a.visibleLayers&&a.layerInfos)){var n=a.visibleLayers,s=a.layerInfos;for(j=0;j<a.visibleLayers.length;j++){k=a.visibleLayers[j];do{if(hideGroupSublayers.indexOf(s[k].name)>-1&&s[k].subLayerIds)for(r=0;r<s[k].subLayerIds.length;r++)if(-1==n.indexOf(s[k].subLayerIds[r])&&n.push(s[k].subLayerIds[r]),"Big Game GMU"==s[s[k].subLayerIds[r]+1].name){var o=1;"Bighorn GMU"==gmu?o=2:"Goat GMU"==gmu&&(o=3),-1==n.indexOf(s[k].subLayerIds[r]+o)&&n.push(s[k].subLayerIds[r]+o)}else-1==n.indexOf(s[k].subLayerIds[r]+1)&&n.push(s[k].subLayerIds[r]+1);k=s[k].parentLayerId}while(-1!=k)}var l=new Array(0,1,2,3,4,5,6,7,8,9);for(r=0;r<s.length;r++){-1!=n.indexOf(s[r].id)?s[r].visible=!0:-1==s[r].parentLayerId||s[r].subLayerIds?s[r].visible=!1:s[r].name.substr(s[r].name.length-3,3).indexOf("GMU")>-1?s[r].name==gmu?(-1==n.indexOf(r)&&(s[r].visible=!0),l.indexOf(parseInt(s[s[r].parentLayerId].name.substr(0,1)))>-1&&-1==n.indexOf(s[r].parentLayerId)&&(s[s[r].parentLayerId].visible=!0)):s[r].visible=!1:1==s[r].defaultVisibility&&-1===n.indexOf(s[r].parentLayerId)&&l.indexOf(parseInt(s[s[r].parentLayerId].name.substr(0,1)))>-1&&(s[s[r].parentLayerId].visible=!0);var d=n.indexOf(s[r].id);d>-1&&s[r].subLayerIds&&n.splice(d,1)}a.setVisibleLayers(n.sort(function(e,t){return e-t}),!1)}a.spatialReference=map.spatialReference,a.refresh(),he.addLayer(a);var p=ee;for(i=0;i<Q.length;i++)for(j=0;j<K.length;j++)Q[i]==K[j].id&&(he.reorderLayer(K[j],p),p++);Q.length==K.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1))}function V(e){$[e.target.id]<10?setTimeout(function(){X(map.getLayer(e.target.id))},500):10===$[e.target.id]?(e.target.id.indexOf("Motor Vehicle")>-1||e.target.id.indexOf("Wildfire")>-1||e.target.id.indexOf("BLM")>-1?alert("While creating the report map, the external map service that provides "+e.target.id+" is experiencing problems.  This issue is out of CPW control. We will continue trying to load it. We apologize for any inconvenience.","External (Non-CPW) Map Service Error"):e.target.id.indexOf(layer)>-1?alert("While creating the report map, the basemap service is busy or not responding. We will continue trying to load it.","Data Error"):alert("While creating the report map, the "+e.target.id+" service is busy or not responding. We will continue trying to load it.","Data Error"),setTimeout(function(){X(map.getLayer(e.target.id))},500),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)):setTimeout(function(){X(map.getLayer(e.target.id))},1e3)}function X(e){if(t.byId("reportPreviewDialog").open){var r;if($[e.id]++,null===e.url&&e.graphics){r=new l({id:e.id,visible:e.visible}),r.id=e.id;var n=e.graphics;for(a=0;a<n.length;a++)g=n[a].clone(),r.add(g);return he.addLayer(r),K.push(r),n=null,void(Q.length==K.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)))}if(e.url.toLowerCase().indexOf("mapserver")>-1){if(r=new B(e.url,{opacity:parseFloat(e.opacity),id:e.id,visible:e.visible}),e.visibleLayers){for(var i=[],s=0;s<e.visibleLayers.length;s++)i.push(parseInt(e.visibleLayers[s]));r.setVisibleLayers(i),i=null}}else e.url.toLowerCase().indexOf("featureserver")>-1?r=new R(e.url,{opacity:parseFloat(e.opacity),id:e.id,visible:e.visible}):alert("Unknown map layer type for "+e.url+" in "+app+"/config.xml","Data Error");r&&(ae.push(C(r,"error",V)),ae.push(C(r,"load",q)))}}function Y(){"function"==typeof ga&&ga("send","event","resource_report","click","Resource Report","1"),"function"==typeof gtag&&gtag("event","widget_click",{widget_name:"Resource Report"}),document.getElementById("reportMsg1").innerHTML=Ne,document.getElementById("reportMsg2").innerHTML=Ne,t.byId("openReportBtn1").set("disabled",!0),t.byId("saveReportBtn1").set("disabled",!0),t.byId("openReportBtn2").set("disabled",!0),t.byId("saveReportBtn2").set("disabled",!0),he.setExtent(v.graphicsExtent(ve.graphics),!0).then(function(){t.byId("reportPreviewDialog").set("title","Resource Report Preview "+Ee),t.byId("reportPreviewDialog").show().then(function(){if(!re){re=!0;var e=he.on("extent-change",function(){he.centerAt(we),e.remove()})}var r=[];for(Q=[],K=[],$=[],ee=0,he.removeAllLayers(),n=0;n<map.layerIds.length;n++)map_layer=map.getLayer(map.layerIds[n]),"layer_osm"==map.layerIds[n]?(osmLayer=new OpenStreetMapLayer,osmLayer.id="layer_osm",he.addLayer(osmLayer),osmLayer=null,ee++):map_layer.attributionDataUrl&&map_layer.attributionDataUrl.indexOf("OpenStreet")>-1?(osmLayer=new OpenStreetMapLayer,osmLayer.id="layer_osm",he.addLayer(osmLayer),osmLayer=null,ee++):map.layerIds[n].indexOf("layer")>-1&&1==map.getLayer(map.layerIds[n]).visibleAtMapScale&&(map.getLayer(map.layerIds[n]).url.indexOf("MapServer")>-1?basemap=new L(map.getLayer(map.layerIds[n]).url,{id:"basemap",visible:!0}):(basemap=new I(map.getLayer(map.layerIds[n]).url,{id:"basemap",visible:!0}),basemap.setStyle(map.getLayer(map.layerIds[n]).url)),"reference"==map_layer._basemapGalleryLayerType?basemap.id="reference":n>0&&(basemap.id="basemap"+n),basemap.spatialReference=map.spatialReference,basemap._basemapGalleryLayerType=map_layer._basemapGalleryLayerType,basemap.refresh(),he.addLayer(basemap),basemap=null,ee++);for(var a=map.getLayersVisibleAtScale(),n=0;n<a.length;n++)a[n].visible&&-1==a[n].id.indexOf("layer")&&(r.push(a[n]),Q.push(a[n].id));for(n=0;n<r.length;n++)r[n].visible&&($[r[n].id]=0,X(r[n]));0==r.length&&(t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1))},function(){alert("Show map failed.","Warning")})},function(){alert("Set map extent failed.","Warning")})}function J(){z(),t.byId("reportPreviewDialog").hide()}function Z(e){return function(r){function a(e){var t,r,a,i;if(Re.gameBoundaries&&(u+=m,Ce.setFontSize(16),Ce.setFont(b,"bold"),"polygon"===ye?Ce.text(Oe,u,"Location & Contact Information (at polygon center):"):Ce.text(Oe,u,"Location & Contact Information (at map click):"),u+=m,Ce.setFont(b,"normal"),Ce.setFontSize(y),Ce.text(Oe,u,"County:"),Ce.text(f,u,e[L].features[0].attributes.COUNTY),u+=m,Ce.text(Oe,u,"Game Mgt. Unit (GMU):"),Ce.text(f,u,e[L].features[0].attributes.GMUID.toString())),Re.contactBoundaries&&(u+=m,Ce.text(Oe,u,"Sheriff Phone:"),Ce.text(f,u,e[R].features[0].attributes.Sheriff_FOPhone),u+=2*m,Ce.setFont(b,"bold"),Ce.text(Oe,u,"CPW"),Ce.setLineWidth(.5),Ce.line(Oe,u+1,Oe+27,u+1),u+=m,Ce.setFont(b,"normal"),Ce.setFontSize(y),Ce.text(Oe,u,"CPW Area:"),Ce.text(f,u,e[R].features[0].attributes.CDOW_Area),u+=m,Ce.text(Oe,u,"CPW District:"),Ce.text(f,u,e[R].features[0].attributes.CDOW_District),u+=m,Ce.text(Oe,u,"CPW Field Office:"),Ce.text(f,u,e[R].features[0].attributes.CDOW_FOName),u+=m,Ce.text(Oe,u,"CPW Field Office Address:"),Ce.text(f,u,e[R].features[0].attributes.CDOW_FOAddress),u+=m,Ce.text(Oe,u,"CPW Field Office City, Zip:"),Ce.text(f,u,e[R].features[0].attributes.CDOW_FOCity+", CO "+e[R].features[0].attributes.CDOW_FOZipcode),u+=m,Ce.text(Oe,u,"CPW Field Office Phone:"),Ce.text(f,u,e[R].features[0].attributes.CDOW_FOPhone),u+=2*m,Ce.setFont(b,"bold"),Ce.text(Oe,u,"BLM"),Ce.setLineWidth(.5),Ce.line(Oe,u+1,Oe+27,u+1),u+=m,Ce.setFont(b,"normal"),Ce.setFontSize(y),Ce.text(Oe,u,"BLM District:"),Ce.text(f,u,e[R].features[0].attributes.BLM_District),u+=m,Ce.text(Oe,u,"BLM Field Office:"),Ce.text(f,u,e[R].features[0].attributes.BLM_FOName),u+=m,Ce.text(Oe,u,"BLM Field Office Address:"),Ce.text(f,u,e[R].features[0].attributes.BLM_FOAddress),u+=m,Ce.text(Oe,u,"BLM Field Office City, Zip:"),Ce.text(f,u,e[R].features[0].attributes.BLM_FOCity+", CO "+e[R].features[0].attributes.BLM_FOZipcode),u+=m,Ce.text(Oe,u,"BLM Field Office Phone:"),Ce.text(f,u,e[R].features[0].attributes.BLM_FOPhone),e[R].features[0].attributes.USFS_FOName)){u+=2*m,Ce.setFont(b,"bold"),Ce.text(Oe,u,"USFS"),Ce.setLineWidth(.5),Ce.line(Oe,u+1,Oe+34,u+1),u+=m,Ce.setFont(b,"normal"),Ce.setFontSize(y),Ce.text(Oe,u,"Forest:"),Ce.text(f,u,e[R].features[0].attributes.NF_NG_NAME),u+=m,Ce.text(Oe,u,"Forest Field Office:");var s=Ce.setFontSize(y).splitTextToSize(e[R].features[0].attributes.USFS_FOName,390,{fontName:"arial",fontStyle:"normal"});Ce.text(f,u,s),s.length>1&&(u+=m),u+=m,Ce.text(Oe,u,"Forest Field Office Address:"),Ce.text(f,u,e[R].features[0].attributes.USFS_FOAddress),u+=m,Ce.text(Oe,u,"Forest Field Office City, Zip:"),Ce.text(f,u,e[R].features[0].attributes.USFS_FOCity+", CO "+e[R].features[0].attributes.USFS_FOZipcode),u+=m,Ce.text(Oe,u,"Forest Field Office Phone:"),Ce.text(f,u,e[R].features[0].attributes.USFS_FOPhone)}if(Re.pointsOfInterest){t=[],r=[],a=[],i=[],ResMed=[],ResSheriff=[],ResLicAg=[],ResStPatrol=[],ResBLMOff=[],ResForOff=[],ResCPWOff=[],ResChamber=[],ResWelcome=[];for(var d=0;d<e[B].features.length;d++)feature=e[B].features[d],attr=e[B].features[d].attributes,xe.contains(feature.geometry)&&("campground"==attr.Type.toLowerCase()?"BLM"==attr.Manager?t.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"CPW"==attr.Manager||"CDOW"==attr.Manager?r.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"State Parks"==attr.Manager?a.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"USFS"==attr.Manager&&i.push({property:attr.CGPropertyName?attr.CGPropertyName:attr.CGPropertyName2,name:attr.Name,website:attr.URL1}):"license agent"==attr.Type.toLowerCase()?ResLicAg.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"medical"==attr.Type.toLowerCase()?ResMed.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"sheriff"==attr.Type.toLowerCase()?ResSheriff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"state patrol"==attr.Type.toLowerCase()?ResStPatrol.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"blm field office"==attr.Type.toLowerCase()?ResBLMOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"forest service office"==attr.Type.toLowerCase()?ResForOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"cdow office"==attr.Type.toLowerCase()||"cpw office"==attr.Type.toLowerCase()?ResCPWOff.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"chamber of commerce"==attr.Type.toLowerCase()?ResChamber.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}):"welcome center"==attr.Type.toLowerCase()&&ResWelcome.push({name:attr.Name,address:attr.Address,city:attr.City,phone:attr.Phone}));var g;(t.length>0||r.length>0||a.length>0||i.length>0)&&(t.sort(sortMultipleArryOfObj("property","name")),r.sort(sortMultipleArryOfObj("property","name")),a.sort(sortMultipleArryOfObj("property","name")),i.sort(sortMultipleArryOfObj("property","name")),l(),u=Me+14,Ce.addPage(),Ce.setFontSize(16),Ce.setFont(b,"bold"),Ce.text(Oe,u,"Campsites"+Be+":"),Ce.setFontSize(y),u+=2*m,g=[],g.push({displayname:"Property",field:"property",width:200}),g.push({displayname:"Name",field:"name",width:200}),g.push({displayname:"Website",field:"website",width:Te-400}),o("BLM",t,g),o("CPW",r,g),o("State Parks",a,g),o("USFS",i,g)),(ResChamber.length>0||ResBLMOff.length>0||ResCPWOff.length>0||ResForOff.length>0||ResLicAg.length>0||ResMed.length>0||ResSheriff.length>0||ResStPatrol.length>0||ResWelcome.length>0)&&(ResMed.sort(sortMultipleArryOfObj("city","name")),ResSheriff.sort(sortMultipleArryOfObj("city","name")),ResLicAg.sort(sortMultipleArryOfObj("city","name")),ResStPatrol.sort(sortMultipleArryOfObj("city","name")),ResBLMOff.sort(sortMultipleArryOfObj("city","name")),ResForOff.sort(sortMultipleArryOfObj("city","name")),ResCPWOff.sort(sortMultipleArryOfObj("city","name")),ResChamber.sort(sortMultipleArryOfObj("city","name")),ResWelcome.sort(sortMultipleArryOfObj("city","name")),l(),u=Me+14,Ce.addPage(),Ce.setFontSize(16),Ce.setFont(b,"bold"),Ce.text(Oe,u,"Information resources"+Be+":"),u+=2*m,g=null,g=[],g.push({displayname:"Name",field:"name",width:(Te-220)/2}),g.push({displayname:"Address",field:"address",width:(Te-220)/2}),g.push({displayname:"City",field:"city",width:120}),g.push({displayname:"Phone",field:"phone",width:100}),o("Chamber of Commerce",ResChamber,g),o("BLM Office",ResBLMOff,g),o("CPW Office",ResCPWOff,g),o("Forest Service Office",ResForOff,g),o("License Agent",ResLicAg,g),o("Medical",ResMed,g),o("Sheriff",ResSheriff,g),o("State Patrol",ResStPatrol,g),o("Welcome Center",ResWelcome,g))}Le.length>0?(Re.gameBoundaries||Re.contactBoundaries||Re.pointsOfInterest?(l(),u=Me+14,Ce.addPage()):u+=m,n(e)):(l(),p())}function n(e){function t(e){var t=0;Re.gameBoundaries&&t++,Re.contactBoundaries&&t++,Re.pointsOfInterest&&t++,oe=0;for(var a=0;a<Le.length;a++){if(Le[a].database&&""!=Le[a].database){createMultiXMLhttpRequest();for(var n=Le[a].keyField,i="",s=0;s<e[t].features.length;s++)e[t].features[s].attributes[n]&&""!=e[t].features[0].attributes[n]&&(0==s?i=e[t].features[s].attributes[n]:i+=","+e[t].features[s].attributes[n]);if(""==i){if(oe++,Ie==oe)return void r(e);t++;continue}var o=Le[a].database+"?v="+ndisVer+"&key="+i;XMLHttpRequestObjects[index].open("POST",o,!0),XMLHttpRequestObjects[index].onreadystatechange=function(t){return function(){if(4==XMLHttpRequestObjects[t].readyState)if(200==XMLHttpRequestObjects[t].status){for(var a,n=createXMLdoc(XMLHttpRequestObjects[t]),i=-1,s=0;s<Le.length;s++){var l=!1;if(e[s].features.length==n.getElementsByTagName("NewDataSet").length&&n.getElementsByTagName(Le[s].keyField).length>0){for(var d=[],p=0;p<e[s].features.length;p++)n.getElementsByTagName("NewDataSet")[p].getElementsByTagName(Le[s].keyField)[0]?d.push(n.getElementsByTagName("NewDataSet")[p].getElementsByTagName(Le[s].keyField)[0].childNodes[0].nodeValue):d.push("undefined");for(l=!0,p=0;p<e[s].features.length;p++)if("undefined"!=d[p]&&d[p]!=e[s].features[p].attributes[Le[s].keyField]){l=!1;break}}if(l){i=s;break}}if(-1==i)return void alert("Cannot find index for the XMLHttpRequest in javascript/resourceReport.js tableQuery(). ","Code Error");if(oe++,n.childNodes[0].innerHTML&&n.childNodes[0].innerHTML.indexOf("error")>-1)return alert("Resource report error in database lookup. URL="+o+". "+n.childNodes[0].innerHTML,"Data Error"),void(oe==Ie&&r(e));if(n.childNodes[0].textContent&&n.childNodes[0].textContent.indexOf("error")>-1)return alert("Resource report error in database lookup. URL="+o+". "+n.childNodes[0].textContent,"Data Error"),void(oe==Ie&&r(e));for(s=0;s<n.getElementsByTagName("NewDataSet").length;s++){var u=n.getElementsByTagName("NewDataSet")[s];if(0!=u.getElementsByTagName(Le[i].keyField).length){if(u.getElementsByTagName(Le[i].keyField)[0].childNodes[0].nodeValue!=e[i].features[s].attributes[Le[i].keyField]&&alert("Resource report error in database lookup. Key fields do not match. "+u.getElementsByTagName(Le[i].keyField)[0].childNodes[0].nodeValue+" != "+e[i].features[s].attributes[Le[i].keyField],"Data Error"),Le[i].one2one_fields&&""!=Le[i].one2one_fields)for(a=0;a<Le[i].one2one_fields.length;a++)u.getElementsByTagName(Le[i].one2one_fields[a])[0]&&u.getElementsByTagName(Le[i].one2one_fields[a])[0].childNodes[0]&&""!=u.getElementsByTagName(Le[i].one2one_fields[a])[0].childNodes[0].nodeValue&&(e[i].features[s].attributes[Le[i].one2one_fields[a]]=u.getElementsByTagName(Le[i].one2one_fields[a])[0].childNodes[0].nodeValue.toString());if(Le[i].one2many_fields&&""!=Le[i].one2many_fields)for(a=0;a<Le[i].one2many_fields.length;a++){for(var g=[],m=0;m<u.getElementsByTagName(Le[i].filename).length;m++){var y=u.getElementsByTagName(Le[i].filename)[m];y.getElementsByTagName(Le[i].one2many_fields[a])[0]&&y.getElementsByTagName(Le[i].one2many_fields[a])[0].childNodes[0]&&""!=y.getElementsByTagName(Le[i].one2many_fields[a])[0].childNodes[0].nodeValue&&g.push(y.getElementsByTagName(Le[i].one2many_fields[a])[0].childNodes[0].nodeValue.toString())}g.sort();for(var f=0;f<g.length;f++)0==f?e[i].features[s].attributes[Le[i].one2many_fields[a]]="* "+g[f]:e[i].features[s].attributes[Le[i].one2many_fields[a]]+="\n* "+g[f];g=null}}}Ie==oe&&r(e)}else 404==XMLHttpRequestObjects[t].status?(alert("Resource Report database lookup failed. Too many resources found. Try a smaller area. Status 404: file not found or not able to process.","Warning"),oe==Ie&&r(e),hideLoading()):(alert("Resource Report database lookup failed for URL="+XMLHttpRequestObjects[t].responseURL+". (Note IE does not report the URL please use Chrome or Firefox.) Make sure it exists and does not have errors. Must be on the same machine. Edit "+app+"/ResourceReportWidget.xml.","Data Error"),oe==Ie&&r(e),hideLoading())}}(index),XMLHttpRequestObjects[index].send()}t++}}function r(e){var t=0;Re.gameBoundaries&&t++,Re.contactBoundaries&&t++,Re.pointsOfInterest&&t++;for(var r=0;r<Le.length;r++){Le[r].title&&""!=Le[r].title&&(l(),u=Me+14,Ce.addPage(),Ce.setFontSize(16),Ce.setFont(b,"bold"),"list"===Le[r].type?"polygon"===ye?Ce.text(Oe,u,Le[r].title.replace("_distance_",ne)+" (at polygon center)"):"point"===ye&&Ce.text(Oe,u,Le[r].title.replace("_distance_",ne)+" (at map click)"):Ce.text(Oe,u,Le[r].title.replace("_distance_",ne)),Ce.setFontSize(y),Ce.setFont(b,"normal"),u+=2*m);for(var a=[],n=[],i=0;i<Le[r].displayfields.length;i++)n[i]=Le[r].displayfields[i];for(var d=0;d<e[t].features.length;d++)if(feature=e[t].features[d],attr=feature.attributes,"point"==feature.geometry.type&&xe.contains(feature.geometry)||"point"!=feature.geometry.type){var g={};for(i=0;i<Le[r].displayfields.length;i++)if(!n[i]&&attr[Le[r].fields[i]]||attr[Le[r].fields[i]]&&n[i].length<attr[Le[r].fields[i]].toString().length)if(attr[Le[r].fields[i]].toString().indexOf("\n")>-1)for(var f=attr[Le[r].fields[i]].toString().split("\n"),c=0;c<f.length;c++)(!n[i]||n[i].length<f[c].length)&&(n[i]=f[c]);else n[i]=attr[Le[r].fields[i]].toString();if(Le[r].where_field&&""!=Le[r].where_field){var h,v;switch("number"==Le[r].where_type.toLowerCase()?(h=parseFloat(Le[r].where_value),v=parseFloat(attr[Le[r].where_field])):(h=Le[r].where_value.toLowerCase(),v=attr[Le[r].where_field].toLowerCase()),Le[r].where_inequality){case"equal":if(v==h){for(i=0;i<Le[r].displayfields.length;i++)g[Le[r].fields[i]]=attr[Le[r].fields[i]];a.push(g),g=null}break;case"not_equal":if(v!=h){for(i=0;i<Le[r].displayfields.length;i++)g[Le[r].fields[i]]=attr[Le[r].fields[i]];a.push(g),g=null}break;case"less_than":if(v<h){for(i=0;i<Le[r].displayfields.length;i++)g[Le[r].fields[i]]=attr[Le[r].fields[i]];a.push(g),g=null}break;case"greater_than":if(v>h){for(i=0;i<Le[r].displayfields.length;i++)g[Le[r].fields[i]]=attr[Le[r].fields[i]];a.push(g),g=null}break;default:alert("Error in "+app+"/ResourceReportWidget.xml file in report tag, id="+Le[r].id+" where_inequality must be: equal, not_equal, less_than, or greater_than.","Data Error")}}else{for(i=0;i<Le[r].displayfields.length;i++)g[Le[r].fields[i]]=attr[Le[r].fields[i]];a.push(g),g=null}}var B=0,R=200;for(i=0;i<n.length;i++)n[i]=10+Math.round(Ce.getStringUnitWidth(n[i])*y/Ce.internal.scaleFactor),n[i]>R&&(n[i]=R),B+=n[i];var L=0;if(Te>B){var I=Math.round((Te-B)/n.length);for(i=0;i<n.length;i++)n[i]+=I,L+=n[i];L!=Te&&(n[0]+=Te-L)}else if(Te<B){var w=Te-B;for(i=0;i<n.length;i++)n[i]+=Math.round(n[i]/B*w),L+=n[i];L!=Te&&(n[0]+=Te-L)}var x=[];for(i=0;i<Le[r].displayfields.length;i++)x.push({displayname:Le[r].displayfields[i],field:Le[r].fields[i],width:n[i]});a.length>0&&("descending"===Le[r].sortorder?a.sort(descendingSortMultipleArryOfObj(Le[r].sortfields)):a.sort(sortMultipleArryOfObj(Le[r].sortfields)),"list"===Le[r].type?s(Le[r].subtitle,a,x):o(Le[r].subtitle,a,x)),t++,n=null,x=null}l(),p()}if(Ce.setFontSize(16),Ce.setFont(b,"bold"),"list"===Le[0].type?"polygon"===ye?Ce.text(Oe,u,Le[0].title.replace("_distance_",ne)+" (at polygon center)"):"point"===ye&&Ce.text(Oe,u,Le[0].title.replace("_distance_",ne)+" (at map click)"):Ce.text(Oe,u,Le[0].title.replace("_distance_",ne)),Ce.setFontSize(y),Ce.setFont(b,"normal"),Le[0].title="",u+=2*m,Ie>0){for(index=0;XMLHttpRequestObjects.length>0;)XMLHttpRequestObjects.pop();t(e)}else r(e)}function i(e){alert("Error message: "+e.message+" in ResourceReportWidget.xml at resourceReport.js, queryFaultHandler"),document.getElementById("reportMsg1").innerHTML="",document.getElementById("reportMsg2").innerHTML=""}function s(e,t,r){""!==e&&(Ce.setFont(b,"bold"),Ce.setFontSize(y),Ce.myText(Oe,u,e,{underline:!0}),u+=m),Ce.setFont(b,"normal");for(var a=0;a<r.length;a++)r[a].displayname&&(Ce.text(Oe,u,r[a].displayname+":"),Ce.text(f,u,t[0][r[a].field].toString()),u+=m);u+=m}function o(e,r,a){function n(){""!==e&&(Ce.setFont(b,"bold"),Ce.setFontSize(y),Ce.myText(Oe,u,e,{underline:!0}),u+=5),Ce.setFillColor(204,204,204),Ce.setDrawColor(0),Ce.rect(Oe,u,Te,o,"FD");var t=Oe+4;Ce.setFont(b,"normal"),u+=m;for(var r=0;r<a.length;r++)a[r].displayname&&Ce.text(t,u,a[r].displayname),t+=a[r].width,r<a.length-1&&Ce.line(t-4,u-m,t-4,u+6);u+=o}try{var i,s;if(0==r.length)return;var o=20,d=[],p=[],g=[];for(g[0]=Oe,i=0;i<r.length;i++)for(d[i]=[],p[i]=1,s=0;s<a.length;s++)r[i][a[s].field]?(""!=r[i][a[s].field]?d[i][s]=Ce.setFontSize(y).splitTextToSize(r[i][a[s].field].toString(),a[s].width-8,{fontName:"arial",fontStyle:"normal"}):d[i][s]="",d[i][s].length>p[i]&&(p[i]=d[i][s].length)):d[i][s]="",0==i&&s+1<a.length&&(g[s+1]=g[s]+a[s].width);for(u+5+o+m*p[0]+o>Fe-m&&(l(),u=Me+14,Ce.addPage()),n(),i=0;i<r.length;i++){for(s=0;s<a.length;s++)0==s&&Ce.line(g[s],u-m,g[s],u+m*(p[i]-1)+o-m),Ce.text(g[s]+4,u,d[i][s]),Ce.line(g[s]+a[s].width,u-m,g[s]+a[s].width,u+m*(p[i]-1)+o-m);Ce.line(Oe,u+m*(p[i]-1)+o-m,Te+Oe,u+m*(p[i]-1)+o-m),u+=m*p[i]+o-m,i<r.length-1&&u+m*p[i+1]+o-m>=Fe-m&&(l(),u=Me+14,Ce.addPage(),-1==e.indexOf("Continued")&&(e+=" - Continued"),n())}u+=m,d=null,g=null,p=null}catch(r){alert("Resource report error while creating table for "+e+". "+r.message,"Code Error",r),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}}function l(){Ce.setFontSize(10),Ce.setFont(b,"normal"),Ce.text(368,Fe-m,"page "+g),g++,Ce.setFontSize(y)}function d(){Ce.setFontSize(5),Ce.setFont(b,"normal"),Ce.text(Te+Oe-30,Fe-7,"page "+g),Ce.setFontSize(y)}function p(){function e(e){function r(){for(var e=Ce.output(),r=new ArrayBuffer(e.length),a=new Uint8Array(r),n=0;n<e.length;n++)a[n]=e.charCodeAt(n);var i=new Blob([a],{type:"application/pdf",encoding:"raw"});saveAs(i,"AtlasReport.pdf"),i=null,r=null,a=null,e=null,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)}function a(){var e=Ce.output("datauristring"),r="<iframe width='100%' height='100%' referrerPolicy='origin' src='"+e+"'></iframe>",a=window.open();if(!a)return alert("Failed to open PDF. Make sure popups are allowed.","Warning"),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),document.getElementById("reportMsg1").innerHTML="",void(document.getElementById("reportMsg2").innerHTML="");a.document.open(),a.document.write(r),a.document.title="Atlas Report",a.document.close(),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1),document.getElementById("reportMsg1").innerHTML="",document.getElementById("reportMsg2").innerHTML=""}var n=new Image;n.onerror=function(){document.getElementById("reportMsg1").innerHTML=Ne,document.getElementById("reportMsg2").innerHTML=Ne,alert("Resource report cannot load image: "+n.src,"Code Error"),n=null,t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)},n.onload=function(){try{Ce.addImage(n,"JPEG",0,0,792,612),n=null,d(),"save"==Pe?(r(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Downloaded PDF",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Downloaded PDF"):navigator.sayswho.indexOf("IE")>-1|navigator.sayswho.indexOf("Edge")>-1?(r(),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Download or Open PDF in pop-up. Make sure pop-ups are enabled.",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Download or Open PDF in pop-up. Make sure pop-ups are enabled."):(a(),
document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opening PDF in pop-up. Make sure pop-ups are enabled.",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Opening PDF in pop-up. Make sure pop-ups are enabled.")}catch(e){document.getElementById("reportMsg1").innerHTML=Ne,document.getElementById("reportMsg2").innerHTML=Ne,alert("Resource report generation Error in javascript/resourceReport.js printResult() img.onload. "+e.message,"Code Error",e)}},n.src=e.url,window.location.hostname.indexOf("ndis-2020-dev")>-1?(n.src="assets/images/testmap.jpg",alert("The image in the pdf is a placeholder. <a href='"+e.url+"' target='pdf_image'>Here is a link to the true image.</a>","Note for Test Site")):-1===printServiceUrl.indexOf(window.location.hostname)&&alert("The fastmap url machine name or alias must match the printserviceurl in the ResourceReport.xml file.","Data Error")}function r(e){document.getElementById("reportMsg1").innerHTML=Ne,document.getElementById("reportMsg2").innerHTML=Ne,e.details?alert("Error creating resource report map: "+e+" Details: "+e.details,"Code Error",e):alert("Error printing resource report: "+e,"Code Error",e)}try{document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating map image for report",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating map image for report",Ce.addPage();var a=new w(printServiceUrl),n=new E,i=new x;i.exportOptions={dpi:Se,outputSize:[3150,2400]},i.layout="Letter ANSI A Landscape",i.format="JPG",i.preserveScale=!0,i.showAttribution=!1,i.layoutOptions={legendLayers:[],titleText:ue,authorText:me,customTextElements:[{Subtitle:ge}]},n.map=he,n.template=i,a.execute(n,e,r)}catch(e){alert("Error creating map for resource report. "+e.message,"Code Error",e)}}if(we){t.byId("openReportBtn1").set("disabled",!0),t.byId("saveReportBtn1").set("disabled",!0),t.byId("openReportBtn2").set("disabled",!0),t.byId("saveReportBtn2").set("disabled",!0),document.getElementById("reportMsg1").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating tables for report...",document.getElementById("reportMsg2").innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<img src='assets/images/loading.gif' width='20px' height='20px'/> Generating tables for report...",Pe=e,Fe=612-Me,Ce=null,Ce=new jsPDF("landscape","pt","letter"),Ce.onerror=function(){document.getElementById("reportMsg1").innerHTML=Ne,document.getElementById("reportMsg2").innerHTML=Ne,alert("Error generating PDF for resource report.","Code Error"),t.byId("openReportBtn1").set("disabled",!1),t.byId("saveReportBtn1").set("disabled",!1),t.byId("openReportBtn2").set("disabled",!1),t.byId("saveReportBtn2").set("disabled",!1)};var u=Me+20,g=1,m=14,y=12,f=300,b="arial";Ce.setProperties({title:pe,author:"Colorado Parks and Wildlife",keywords:"hunting, fishing, atlas, ndis"}),Ce.setFontSize(22),Ce.setFont(b,"bold"),Ce.text(Oe,u,pe),u+=22,Ce.setFont(b,"normal"),Ce.setFontSize(y);var c={Jan:"January",Feb:"February",Mar:"March",Apr:"April",May:"May",Jun:"June",Jul:"July",Aug:"August",Sep:"September",Oct:"October",Nov:"November",Dec:"December"};_e=new Date,_e=_e.toDateString(),_e="0"==_e.substr[8]?c[_e.substr(4,3)]+" "+_e.substr(9,1)+","+_e.substr(_e.length-5,_e.length):c[_e.substr(4,3)]+" "+_e.substr(8,2)+","+_e.substr(_e.length-5,_e.length),Ce.text(Oe,u,_e),u+=m,"point"===ye?Ce.text(Oe,u,"X/Y at map click:"):"polygon"===ye&&Ce.text(Oe,u,"X/Y at polygon center:");var h=M.webMercatorToGeographic(we);Ce.text(f,u,h.y.toFixed(5)+" N, "+-1*h.x.toFixed(5)+" W"),u+=m;var v,B,R,L,I=[],O=[],C=[],N=0;Re.pointsOfInterest&&(O[N]=new T(Re.pointsOfInterest.url),I[N]=new S,I[N].geometry=xe,I[N].returnGeometry=!0,I[N].spatialRelationship=S.SPATIAL_REL_INTERSECTS,I[N].outFields=["*"],C.push(O[N].execute(I[N])),B=N,N++),Re.contactBoundaries&&(I[N]=new S,O[N]=new T(Re.contactBoundaries.url),I[N].geometry=xe,I[N].returnGeometry=!0,I[N].spatialRelationship=S.SPATIAL_REL_INTERSECTS,I[N].outFields=["*"],I[N].geometry=we,C.push(O[N].execute(I[N])),R=N,N++),Re.gameBoundaries&&(I[N]=new S,O[N]=new T(Re.gameBoundaries.url),I[N].geometry=xe,I[N].returnGeometry=!0,I[N].spatialRelationship=S.SPATIAL_REL_INTERSECTS,I[N].outFields=["*"],I[N].geometry=we,C.push(O[N].execute(I[N])),L=N,N++);for(var A=0;A<Le.length;A++)N,O[N]=new T(Le[A].url),I[N]=new S,"list"===Le[A].type?I[N].geometry=we:I[N].geometry=xe,I[N].returnGeometry=!0,I[N].spatialRelationship=S.SPATIAL_REL_INTERSECTS,I[N].outFields=["*"],C.push(O[N].execute(I[N])),N++;C.length>0&&(v=F(C),v.then(a),v.otherwise(i))}}}var Q,K,$,ee,te,re=!1,ae=[];try{var ne,ie,se,oe,le,de,pe,ue,ge,me,ye,fe,be,ce,he,ve,Be="",Re={pointsOfInterest:null,contactBoundaries:null,gameBoundaries:null},Le=[],Ie=0,we=null,xe=null,Ee="",Oe=18,Me=18,Se=300,Te=792-2*Oe,Fe=612-Me,Ce=new jsPDF("landscape","pt","letter"),Ne="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Adjust map boundaries. Click Open/Save Report when ready.",Ae=new l;Ae.id="reportGraphicsLayer1",map.addLayer(Ae);var _e,Pe,ke=createXMLhttpRequest(),je=app+"/ResourceReportWidget.xml?v="+ndisVer;ke.onerror=function(){alert("Error loading "+app+"/ResourceReportWidget.xml","Data Error")},ke.onreadystatechange=function(){if(4==ke.readyState)if(200==ke.status){var e=createXMLdoc(ke);e||alert("Missing "+app+"/ResourceReportWidget.xml file.","Data Error"),e.getElementsByTagName("reports")[0]&&alert("Warning: The reports tag has been renamed 'custom_reports'. Please fix this in "+je,"Data Error");var t=e.getElementsByTagName("custom_reports")[0]&&e.getElementsByTagName("custom_reports")[0].getElementsByTagName("report")?e.getElementsByTagName("custom_reports")[0].getElementsByTagName("report"):null;if(e.getElementsByTagName("reportserviceurl")[0]&&alert("reportserviceurl tag is no longer used in ResourceReportWidget.xml"),e.getElementsByTagName("printserviceurl")[0]&&alert("printserviceurl tag is no longer used in ResourceReportWidget.xml"),le=e.getElementsByTagName("basemapurl")[0]?e.getElementsByTagName("basemapurl")[0].firstChild.nodeValue:P("basemapurl tag"),pe=e.getElementsByTagName("reporttitle")[0]?e.getElementsByTagName("reporttitle")[0].firstChild.nodeValue:P("reporttitle tag"),ye=e.getElementsByTagName("selectby")[0]?e.getElementsByTagName("selectby")[0].firstChild.nodeValue:"point","polygon"===ye)fe="reportPolyBtn",document.getElementById("polyReport").style.display="block",document.getElementById("pointReport").style.display="none",ne="";else if("point"===ye){fe="reportPtBtn";var r=e.getElementsByTagName("buffer")[0]?e.getElementsByTagName("buffer")[0]:P("buffer tag");ne=r.getAttribute("default")?r.getAttribute("default"):P("default attribute of the buffer tag"),ie=r.getAttribute("list")?r.getAttribute("list").split(","):P("list attribute of the buffer tag"),se=r.getAttribute("unitslabel")?r.getAttribute("unitslabel"):P("unitslabel attribute of the buffer tag"),document.getElementById("pointReport").style.display="block",document.getElementById("polyReport").style.display="none"}else alert("Error in ResourceReportWidget.xml file. selectby tag must be point or polygon. If tag is missing 'point' will be assumed.");if(e.getElementsByTagName("pointsofinterest")[0]&&(Re.pointsOfInterest={url:e.getElementsByTagName("pointsofinterest")[0].getAttribute("url"),name:e.getElementsByTagName("pointsofinterest")[0].getAttribute("name")}),e.getElementsByTagName("contactinfo")[0]&&(Re.contactBoundaries={url:e.getElementsByTagName("contactinfo")[0].getAttribute("url"),name:e.getElementsByTagName("contactinfo")[0].getAttribute("name")}),e.getElementsByTagName("gameunits")[0]&&(Re.gameBoundaries={url:e.getElementsByTagName("gameunits")[0].getAttribute("url"),name:e.getElementsByTagName("gameunits")[0].getAttribute("name")}),t)for(i=0;i<t.length;i++){var a={url:t[i].getAttribute("url")?t[i].getAttribute("url"):P("report tag, url attribute"),id:t[i].getAttribute("id")?t[i].getAttribute("id"):P("report tag, id attribute"),type:t[i].getAttribute("type")?t[i].getAttribute("type"):P("report tag, type attribute"),title:t[i].getAttribute("title")?t[i].getAttribute("title"):"",subtitle:t[i].getAttribute("subtitle")?t[i].getAttribute("subtitle"):"",displayfields:t[i].getAttribute("displayfields")?t[i].getAttribute("displayfields").split(","):P("report tag, displayfields attribute"),fields:t[i].getAttribute("fields")?t[i].getAttribute("fields").split(","):P("report tag, fields attribute"),where_field:t[i].getAttribute("where_field")?t[i].getAttribute("where_field"):"",where_inequality:t[i].getAttribute("where_inequality")?t[i].getAttribute("where_inequality"):"",where_value:t[i].getAttribute("where_value")?t[i].getAttribute("where_value"):"",where_type:t[i].getAttribute("where_type")?t[i].getAttribute("where_type"):"",sortfields:t[i].getAttribute("sortfields")?t[i].getAttribute("sortfields").split(","):t[i].getAttribute("fields").split(","),sortorder:t[i].getAttribute("sortorder")?t[i].getAttribute("sortorder"):"ascending",keyField:t[i].getAttribute("key")?t[i].getAttribute("key"):null,database:t[i].getAttribute("database")?t[i].getAttribute("database"):null,filename:t[i].getAttribute("filename")?t[i].getAttribute("filename"):null,one2one_fields:t[i].getAttribute("one2one_fields")?t[i].getAttribute("one2one_fields").split(","):null,one2one_display:t[i].getAttribute("one2one_display")?t[i].getAttribute("one2one_display").split(","):t[i].getAttribute("one2one_fields")?t[i].getAttribute("one2one_fields").split(","):null,one2many_fields:t[i].getAttribute("one2many_fields")?t[i].getAttribute("one2many_fields").split(","):null,one2many_display:t[i].getAttribute("one2many_display")?t[i].getAttribute("one2many_display").split(","):t[i].getAttribute("one2many_fields")?t[i].getAttribute("one2many_fields").split(","):null};Le.push(a),a.database&&""!=a.database&&Ie++,a=null}ue=e.getElementsByTagName("title")[0]?e.getElementsByTagName("title")[0].firstChild.nodeValue:P("title tag"),ge=e.getElementsByTagName("subtitle")[0]?e.getElementsByTagName("subtitle")[0].firstChild.nodeValue:P("subtitle tag"),me=e.getElementsByTagName("disclaimer")[0]?e.getElementsByTagName("disclaimer")[0].firstChild.nodeValue:P("disclaimer tag"),_()}else 404===ke.status&&alert("File: "+app+"/ResourceReportWidget.xml not found.","Data Error")},ke.open("GET",je,!0),ke.send(null),te=jsPDF.API,te.myText=function(e,t,r,a,n){a=a||{};var i,s=this.internal.getFontSize();i=n||this.internal.pageSize.width,txtWidth=this.getStringUnitWidth(r)*s/this.internal.scaleFactor,"center"==a.align?(e+=(i-txtWidth)/2,this.text(r,e,t)):"right"==a.align?(e+=i-(txtWidth+3),this.text(r,e,t)):1==a.underline&&(this.text(r,e,t),this.line(e,t+1,e+1.15*txtWidth,t+1))}}catch(e){alert(e.message+" in javascript/resourceReport.js reportInit.","Code Error",e)}})}