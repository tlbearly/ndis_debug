function printInit(){var e=createXMLhttpRequest(),t=app+"/PrintPdfWidget.xml?v="+ndisVer;e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var t=createXMLdoc(e);t.getElementsByTagName("disclaimer")[0]?prtDisclaimer=t.getElementsByTagName("disclaimer")[0].firstChild.nodeValue:alert("Missing tag, disclaimer, in "+app+"/PrintPdfWidget.xml file.","Data Error"),t.getElementsByTagName("helpvideo")[0]&&(document.getElementById("printVideo").innerHTML="<a target='help' href="+t.getElementsByTagName("helpvideo")[0].firstChild.nodeValue+">Click here to view help video.</a><br/><br/>")}else 404===e.status?(alert("Error: Missing PrintPdfWidget.aspx file in "+app+" directory.","Data Error"),hideLoading()):4===e.readyState&&500===e.status&&(alert("Missing PrintPdfWidget.aspx file. app="+app,"Data Error"),hideLoading())},e.open("GET",t,!0),e.send()}function printShow(){require(["esri/SpatialReference","esri/layers/GraphicsLayer","esri/graphic","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer","esri/layers/FeatureLayer","esri/geometry/Point","esri/layers/VectorTileLayer","esri/layers/OpenStreetMapLayer","dojo/dom","dojo/on","dojo/_base/array","dijit/registry"],function(e,t,i,n,r,d,l,p,s,o,y,m,u){function c(e){m.forEach(v,function(e){e.remove()}),v=[]}function b(e){var t,i=e.layer;if((T[e.target.id]>10&&alert("While printing, the "+e.target.id+" service loaded sucessfully.","Note"),i.url&&i.url.toLowerCase().indexOf("mapserver")>-1)&&(null!=i.setVisibleLayers&&i.visibleLayers&&i.layerInfos)){var n=i.visibleLayers,r=i.layerInfos;for(j=0;j<i.visibleLayers.length;j++){k=i.visibleLayers[j];do{if(hideGroupSublayers.indexOf(r[k].name)>-1&&r[k].subLayerIds)for(t=0;t<r[k].subLayerIds.length;t++)if(-1==n.indexOf(r[k].subLayerIds[t])&&n.push(r[k].subLayerIds[t]),"Big Game GMU"==r[r[k].subLayerIds[t]+1].name){var a=1;"Bighorn GMU"==gmu?a=2:"Goat GMU"==gmu&&(a=3),-1==n.indexOf(r[k].subLayerIds[t]+a)&&n.push(r[k].subLayerIds[t]+a)}else-1==n.indexOf(r[k].subLayerIds[t]+1)&&n.push(r[k].subLayerIds[t]+1);k=r[k].parentLayerId}while(-1!=k)}var d=new Array(0,1,2,3,4,5,6,7,8,9);for(t=0;t<r.length;t++){-1!=n.indexOf(r[t].id)?r[t].visible=!0:-1==r[t].parentLayerId||r[t].subLayerIds?r[t].visible=!1:r[t].name.substr(r[t].name.length-3,3).indexOf("GMU")>-1?r[t].name==gmu?(-1==n.indexOf(t)&&(r[t].visible=!0),d.indexOf(parseInt(r[r[t].parentLayerId].name.substr(0,1)))>-1&&-1==n.indexOf(r[t].parentLayerId)&&(r[r[t].parentLayerId].visible=!0)):r[t].visible=!1:1==r[t].defaultVisibility&&-1===n.indexOf(r[t].parentLayerId)&&d.indexOf(parseInt(r[r[t].parentLayerId].name.substr(0,1)))>-1&&(r[r[t].parentLayerId].visible=!0);var l=n.indexOf(r[t].id);l>-1&&r[t].subLayerIds&&n.splice(l,1)}i.setVisibleLayers(n.sort(function(e,t){return e-t}),!1)}i.spatialReference=map.spatialReference,i.refresh(),previewMap.addLayer(i),I.push(i),f++;var p=B;for(O=0;O<w.length;O++)for(j=0;j<I.length;j++)w[O]==I[j].id&&(previewMap.reorderLayer(I[j],p),p++);w.length==f&&(u.byId("print_button").set("disabled",!1),u.byId("print_button").set("label","Print"))}function h(e){T[e.target.id]<10?setTimeout(function(){L(map.getLayer(e.target.id))},500):10==T[e.target.id]?(e.target.id.indexOf("Motor Vehicle")>-1||e.target.id.indexOf("Wildfire")>-1||e.target.id.indexOf("BLM")>-1?alert("While printing, the external map service that provides "+e.target.id+" is experiencing problems.  This issue is out of CPW control. We will continue trying to load it. We apologize for any inconvenience.","External (Non-CPW) Map Service Error"):alert("While printing, the "+e.target.id+" service is busy or not responding. We will continue trying to load it.","Data Error"),setTimeout(function(){L(map.getLayer(e.target.id))},500),u.byId("print_button").set("disabled",!1),u.byId("print_button").set("label","Print")):setTimeout(function(){L(map.getLayer(e.target.id))},1e3)}function L(e){if("none"!==o.byId("printDiv").style.display){var i;if(T[e.id]++,e.id.indexOf("reportGraphicsLayer")>-1)return f++,void(w.length==f&&(u.byId("print_button").set("disabled",!1),u.byId("print_button").set("label","Print")));if(null===e.url&&e.graphics){i=new t({id:e.id,visible:e.visible}),i.id=e.id;var n=e.graphics;for(a=0;a<n.length;a++)g=n[a].clone(),i.add(g);return previewMap.addLayer(i),I.push(i),n=null,f++,void(w.length==f&&(u.byId("print_button").set("disabled",!1),u.byId("print_button").set("label","Print")))}if(e.url.toLowerCase().indexOf("mapserver")>-1){if(i=new r(e.url,{opacity:parseFloat(e.opacity),id:e.id,visible:e.visible}),e.visibleLayers){for(var l=[],p=0;p<e.visibleLayers.length;p++)l.push(parseInt(e.visibleLayers[p]));i.setVisibleLayers(l),l=null}}else e.url.toLowerCase().indexOf("featureserver")>-1?i=new d(e.url,{opacity:parseFloat(e.opacity),id:e.id,visible:e.visible}):alert("Unknown map layer type for "+e.url+" in "+app+"/config.xml","Data Error");i&&(v.push(y(i,"error",h)),v.push(y(i,"load",b)))}}u.byId("print_button").set("label","Loading..."),u.byId("print_button").set("disabled",!0);var f=0,v=[],I=[],w=[];v.push(printDialog.on("hide",c));var M,x,E,T=[],B=0;for(document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="",document.getElementById("printTitle").value="My Custom Map",document.getElementById("printSubTitle").value=o.byId("title").innerHTML,previewMap.removeAllLayers(),printDialog.show(),O=0;O<map.layerIds.length;O++)x=map.getLayer(map.layerIds[O]),"layer_osm"==map.layerIds[O]?(E=new s,E.id="layer_osm",previewMap.addLayer(E),E=null,B++):x.attributionDataUrl&&x.attributionDataUrl.indexOf("OpenStreet")>-1?(E=new s,E.id="layer_osm",previewMap.addLayer(E),E=null,B++):map.layerIds[O].indexOf("layer")>-1&&1==map.getLayer(map.layerIds[O]).visibleAtMapScale&&(map.getLayer(map.layerIds[O]).url.indexOf("MapServer")>-1?M=new n(map.getLayer(map.layerIds[O]).url,{id:"basemap",visible:!0}):(M=new p(map.getLayer(map.layerIds[O]).url,{id:"basemap",visible:!0}),M.setStyle(map.getLayer(map.layerIds[O]).url)),"reference"==x._basemapGalleryLayerType?M.id="reference":O>0&&(M.id="basemap"+O),M.spatialReference=map.spatialReference,M._basemapGalleryLayerType=x._basemapGalleryLayerType,M.refresh(),previewMap.addLayer(M),M=null,B++);var P=[];w=[],I=[],T=[],previewMap.spatialReference=map.spatialReference;for(var _=map.getLayersVisibleAtScale(),O=0;O<_.length;O++)_[O].visible&&-1==_[O].id.indexOf("layer")&&(P.push(_[O]),w.push(_[O].id));for(O=0;O<P.length;O++)P[O].visible&&(T[P[O].id]=0,L(P[O]));0==P.length&&(u.byId("print_button").set("disabled",!1),u.byId("print_button").set("label","Print"));var H=new l(map.extent.xmax+(map.extent.xmin-map.extent.xmax)/2,map.extent.ymin+(map.extent.ymax-map.extent.ymin)/2,map.spatialReference);previewMap.centerAndZoom(H,map.getLevel()).then(function(){changePrintSize()}),H=null})}function changePrintSize(){require(["dojo/dom","dijit/registry"],function(e,t){if(previewMap&&previewMap.extent){document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="";document.getElementById("printPreviewMap");var i=e.byId("orient");index=i.selectedIndex;var n=i.options[index].value,r=e.byId("size");index=r.selectedIndex;var a=r.options[index].value,d=previewMap.extent.getCenter(),l=previewMap.getLevel();"Landscape"==n?"Letter "==a?(previewMap.width=490,previewMap.height=348,inchesWidth=10.2,inchesHeight=7.25,t.byId("printPreviewMap").resize({w:490,h:348})):"Tabloid "==a?(previewMap.width=544,previewMap.height=328,inchesWidth=16.2,inchesHeight=8.75,t.byId("printPreviewMap").resize({w:544,h:328})):"8.5 x 14 "==a&&(previewMap.width=506,previewMap.height=278,inchesWidth=13.2,inchesHeight=7.25,t.byId("printPreviewMap").resize({w:506,h:278})):"Letter "==a?(previewMap.width=370,previewMap.height=468,inchesWidth=7.7,inchesHeight=9.75,t.byId("printPreviewMap").resize({w:370,h:468})):"Tabloid "==a?(previewMap.width=343,previewMap.height=529,inchesWidth=10.2,inchesHeight=15.75,t.byId("printPreviewMap").resize({w:343,h:529})):"8.5 x 14 "==a&&(previewMap.width=296,previewMap.height=490,inchesWidth=7.7,inchesHeight=12.75,t.byId("printPreviewMap").resize({w:296,h:490})),l>-1&&previewMap.centerAndZoom(d,l),d=null}else alert("Please wait for page to load.")})}function grayOutLegend(e){require(["dojo/dom"],function(t){document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="","geopdf"!=e.value&&"pdf"!=e.value&&t.byId("printLegend")?t.byId("printLegendCB").style.display="none":t.byId("printLegendCB").style.display="inline-block","geotiff"!=e.value?document.getElementById("printInst").innerHTML="Disable pop-up blocker. Printout will open in a new tab.":document.getElementById("printInst").innerHTML=""})}function printMap(){require(["esri/tasks/PrintTask","esri/tasks/PrintTemplate","esri/tasks/PrintParameters","esri/urlUtils","esri/config","esri/graphic","esri/geometry/Point","esri/tasks/LegendLayer","esri/layers/GraphicsLayer","dojo/dom","dijit/registry"],function(e,t,i,n,r,a,d,l,p,s,o){function y(e){var t,i,n=s.byId("format"),r=Date.now()-startTim,a=previewMap.getScale();a<9028?i="10k":a<36112?i="24k":a<72224?i="50k":a<144448?i="100k":a<288896?i="250k":a<577791?i="500k":a<1155582?i="1M":a<2311163?i="2M":a<4622325?i="4M":a<9244649&&(i="9M");var d=n.options[n.selectedIndex].value,l=s.byId("size").options[s.byId("size").selectedIndex].innerHTML+" "+d+" ";L&&document.getElementById("printLegend").checked&&(l+="legend ");var p=s.byId("size").options[s.byId("size").selectedIndex].innerHTML,y=Math.floor(r/1e3),g="";for(t=0;t<previewMap.layerIds.length;t++)switch(previewMap.layerIds[t]){case"Motor Vehicle Use Map":g+="M";break;case"Hunter Reference":g+="R";break;case"Game Species":g+="G";break;case"Fishing Info":g+="F";break;case"Reference":g+="R"}if(l+=g,console.log("Time to create map = "+y+" seconds for "+l+" "+i),"function"==typeof gtag&&(gtag("event","print",{seconds:y,app_name:app,page_size:p,map_services:g,map_scale:i,map_type:d}),gtag("event",{widget_name:"Print",app_name:app})),console.log("printing to "+e.url),e.url.indexOf("tif")>-1||e.url.indexOf("svgz")>-1)document.getElementById("printInst").innerHTML="Click on the link below to download the image file.",document.getElementById("printMapLink").innerHTML="<a href='"+e.url+"' target='_blank'>"+B.format.toUpperCase()+" File</a>";else{document.getElementById("printInst").innerHTML="Disable pop-up blocker. Printout will open in a new tab.";try{window.open(e.url,"_blank")}catch(e){console.log("Can't open printout in new window. Use link provided.")}document.getElementById("printMapLink").innerHTML="Opened map in a new tab.<br/>Link to <a href='"+e.url+"' target='_blank'>"+B.format.toUpperCase()+" File</a>"}for(t=0;t<b;t++)removeDrawItem();h&&(o.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none"),h=!0}function g(e){o.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",alert("Error printing with basemap, "+mapBasemap+". Error Code: "+e,"Code Error",e),document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="";for(var t=0;t<b;t++)removeDrawItem();printDialog.hide()}function m(e){console.log("printing legend to "+e.url);try{window.open(e.url,"_blank")}catch(e){console.log("Can't open printout in new window. Use link provided.")}h&&(o.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none"),document.getElementById("printLegendLink").innerHTML="Opened legend in a new tab.Link to <a href='"+e.url+"' target='_blank'>"+B.format.toUpperCase()+" File</a>",h=!0}function u(e){o.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",document.getElementById("printLegendLink").innerHTML="",document.getElementById("printMapLink").innerHTML="",e.details?alert("Error printing the legend: "+e+e.details,"Code Error",e):alert("Error printing the legend: "+e,"Code Error",e),printDialog.hide()}var c,b=0;try{var h=!1,L="inline-block"==s.byId("printLegendCB").style.display;L||(h=!0),o.byId("print_button").set("label","Creating..."),document.getElementById("printLoading").style.display="inline-block",document.getElementById("printMapLink").innerHTML="",document.getElementById("printLegendLink").innerHTML="";var f,v,I=previewMap.getLayersVisibleAtScale(),w=[],M=0;for(c=1;c<I.length;c++)if(I[c].visible&&"topo"!=I[c].id&&"streets"!=I[c].id&&"hybrid"!=I[c].id){if(I[c].id.indexOf("drawgraphics")>0){if(I[c].graphics.length>1&&"point"==I[c].graphics[0].geometry.type&&!I[c].graphics[0].symbol.text){b++;var x=new d(I[c].graphics[0].geometry.x,I[c].graphics[0].geometry.y,map.spatialReference),k=new a(x),E=new p;E.id="drawgraphics"+drawGraphicsCounter,drawGraphicsCount.push(E.id),drawGraphicsCounter++,addLabel(k,I[c].graphics[1].symbol.text,E,"11pt")}continue}I[c].visibleLayers&&(f=new l,f.layerId=I[c].id,f.subLayerIds=I[c].visibleLayers,w.push(f),f=null,M++)}var T=new i,B=new t,P=s.byId("orient"),_=s.byId("format");index=P.selectedIndex;var O=P.options[index].value,H=s.byId("size");index=H.selectedIndex;var S=H.options[index].value;if(B.exportOptions={dpi:dpi,width:parseInt(inchesWidth*dpi),height:parseInt(inchesHeight*dpi)},"pdf"!=_.options[_.selectedIndex].value){var C;if(B.layout=app+" "+S+O,v=new e(printGeoServiceUrl),B.preserveScale=!0,h=!0,B.format=_.options[_.selectedIndex].value,"geopdf"!=B.format)C="none",B.exportOptions={dpi:dpi,width:parseInt(inchesWidth*dpi),height:parseInt(inchesHeight*dpi)};else if("geopdf"!=B.format||document.getElementById("printLegend").checked)C="Legend Letter "+O,B.format="pdf";else if(C="none",B.format="pdf",0==M)return alert("Printing of basemaps alone does not work. Please add map layers. From the menu, select 'Map Layers & Legend.'","Warning"),o.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",document.getElementById("printMapLink").innerHTML="",void(document.getElementById("printLegendLink").innerHTML="");T.extraParameters={Georef_Info:"True",Legend_Template:C}}else L&&!document.getElementById("printLegend").checked&&(h=!0),v=new e(printServiceUrl),B.preserveScale=!0,B.format=_.options[_.selectedIndex].value.toUpperCase(),S.indexOf("Letter")>-1?B.layout=S+"ANSI A "+O:B.layout=S+"ANSI B "+O;B.showAttribution=!1;var D=document.getElementById("printTitle").value;if("geopdf"==_.options[_.selectedIndex].value&&(D+=" (Geo PDF)"),L&&document.getElementById("printLegend").checked?B.layoutOptions={titleText:D,authorText:prtDisclaimer,legendLayers:w,customTextElements:[{Subtitle:document.getElementById("printSubTitle").value},{Legend:w}]}:B.layoutOptions={titleText:D,authorText:prtDisclaimer,legendLayers:[],customTextElements:[{Subtitle:document.getElementById("printSubTitle").value}]},D=null,T.map=previewMap,T.template=B,!fullExtent.contains(previewMap.extent))return alert("Printing is only allowed for Colorado.","Warning"),o.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none",document.getElementById("printMapLink").innerHTML="",void(document.getElementById("printLegendLink").innerHTML="");if(v.execute(T,y,g),startTim=Date.now(),"pdf"==_.options[_.selectedIndex].value&&L&&document.getElementById("printLegend").checked){var G=new e(printServiceUrl),W=new i,j=new t;j.exportOptions={dpi:dpi},j.layout="Legend Letter "+O,j.format="PDF",j.layoutOptions={titleText:document.getElementById("printTitle").value,authorText:prtDisclaimer,legendLayers:w,customTextElements:[{Subtitle:document.getElementById("printSubTitle").value},{Legend:w}]},W.map=previewMap,W.template=j,G.execute(W,m,u)}}catch(e){for(c=0;c<b;c++)removeDrawItem();alert("Error while printing: "+e.message,"Code Error",e),o.byId("print_button").set("label","Print"),document.getElementById("printLoading").style.display="none"}})}var startTim,inchesWidth,inchesHeight,prtDisclaimer="",dpi=96;