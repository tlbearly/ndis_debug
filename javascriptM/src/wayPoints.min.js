function wayPointInit(){require(["javascript/HelpWin"],function(e){wayPointHelp=new e({label:"Way Point Help",content:"Allows clicking on the map to add way points with a label and description. Way points will only show up when you are zoomed in. If needed, the map will automatically zoom in to let you see the new way point you are adding. Once a way point is added, you may click on it to see the description, to edit the label or description, or to delete it. In Bookmark (on the main menu) you can save your way points in your browser's bookmarks or cache.<br/><br/>"}),document.body.appendChild(wayPointHelp.domNode),wayPointHelp.startup()})}function safeInput(e){return e.value=e.value.replace(/\"/g,"``"),e.value=e.value.replace(/\'/g,"`"),e.value=e.value.replace(/;/g,""),e.value=e.value.replace(/&/g,"and"),e.value=e.value.replace(/\n/g,"newline"),regexp=/([^a-zA-Z0-9 \-,Â°`\.!_\*()])/g,regexp.test(e.value)&&alert("Illegal characters were removed.","Note"),e.value=e.value.replace(regexp,""),e.value=e.value.replace(/newline/g,"\n"),e.value}function resizeTextBox(e){e?(e.style.height="auto",e.style.height=e.scrollHeight+"px",hideLoading()):hideLoading()}function addPoint(e,t,a,n){require(["dojo/dom","esri/layers/GraphicsLayer","esri/graphic","esri/symbols/SimpleMarkerSymbol","dojo/_base/Color","esri/symbols/Font","esri/symbols/TextSymbol","dojox/mobile/ExpandingTextArea","esri/InfoTemplate"],function(i,r,o,l,s,p,d,c,y){t=t.replace(/~/g," "),a=a.replace(/~/g," "),t=t.replace(/\"/g,"``"),a=a.replace(/\"/g,"``"),t=t.replace(/\'/g,"`"),a=a.replace(/\'/g,"`"),drawGraphicsLayer=new r,drawGraphicsLayer.id="drawgraphics"+drawGraphicsCounter;var u=new o(e,n);drawGraphicsLayer.add(u);var m=new l(l.STYLE_CIRCLE,40,null,new s([0,0,255,.05]));u=new o(e,m),drawGraphicsLayer.add(u);var w=new p("9pt",p.STYLE_NORMAL,p.VARIANT_NORMAL,p.WEIGHT_BOLDER,"Helvetica"),g=new d(t,w,new s("black"));g.setOffset(0,-23),u=new o(e,g),u.setAttributes({name:t,description:a}),drawGraphicsLayer.add(u),drawGraphicsLayer.setMinScale(wayPtMaxScale),drawGraphicsLayer.setMaxScale(0),map.addLayer(drawGraphicsLayer),drawGraphicsLayer.title=t,drawGraphicsLayer.desc=a,drawGraphicsLayer.refresh(),drawGraphicsLayer.content="<div id='wayptContent'><div class='esriPopupItemTitle'>Way Point found at map click:</div><form id='popupForm'><input id='wayPtTitle' type='text' maxlength='50' style='width:250px;max-width:96%;margin-left:5px;' value='"+t+"'></input><textarea id='wayPtDesc' maxlength='200' onkeyup='javascript:resizeTextBox(this)' style='height:80px; width: calc(100% - 25px)!important;width: -moz-calc(100% - 25x)!important;width: -webkit-calc(100% - 25px)!important; margin:5px; overflow:hidden; resize:none;'  placeHolder=\"Description\">"+a+"</textarea><p align='center'><button class='mblButton' type='button' onclick=\"var gr=map.getLayer('"+drawGraphicsLayer.id+"');var title=safeInput(document.getElementById('wayPtTitle'));var desc=safeInput(document.getElementById('wayPtDesc'));gr.content = gr.content.replace(gr.title,title);gr.content = gr.content.replace(gr.desc+'</textarea>',desc+'</textarea>');gr.title=title;gr.desc=desc;gr.graphics[2].symbol.text = title;gr.refresh();map.infoWindow.popupInfoView.container.style.display='none';map.infoWindow.popupNavigationBar.container.style.display='none';document.getElementById('wayPtDesc').blur();document.body.focus();\">Save</button>&nbsp;&nbsp;<button type='button' class='mblButton' onclick='map.infoWindow.setTitle(\"\");map.infoWindow.setContent(\"\");map.infoWindow.popupInfoView.container.style.display=\"none\";map.infoWindow.popupNavigationBar.container.style.display=\"none\";' data-dojo-type='dojox/mobile/Button'>Close</button>&nbsp;&nbsp;<button type='button' onclick='map.infoWindow.setTitle(\"\");map.infoWindow.popupInfoView.container.style.display=\"none\";map.infoWindow.popupNavigationBar.container.style.display=\"none\";map.graphics.clear();map.removeLayer(map.getLayer(\""+drawGraphicsLayer.id+'"));drawGraphicsCount.splice(drawGraphicsCount.indexOf("'+drawGraphicsLayer.id+"\"),1);drawGraphicsCounter--;map.infoWindow.setContent(\"\");' class='mblButton'>Delete</button></p><br/><br/></form></div><script>  document.getElementById('wayptContent').addEventListener('load', function() {  document.getElementsByClassName('esriPopupItemTitle')[0].scrollIntoView();  console.log('loaded');});</script>",drawGraphicsLayer.on("click",function(e){if(!drawing){clickPoint=getScreenClick(e),map.infoWindow.setTitle(this.title),map.infoWindow.wayPt=!0,map.infoWindow.setContent(this.content),getIdentifyFooter(),showIdentify();var t="onorientationchange"in window,a=t?"orientationchange":"resize";window.addEventListener(a,function(){document.getElementById("wayPtDesc")&&(showLoading(),setTimeout(resizeTextBox(document.getElementById("wayPtDesc")),500))},!1)}}),drawGraphicsCount.push(drawGraphicsLayer.id),drawGraphicsCounter++,drawGraphicsLayer.on("mouse-over",function(){map.setMapCursor("pointer")}),drawGraphicsLayer.on("mouse-out",function(){map.setMapCursor("default")}),drawGraphicsLayer=null,g=null,m=null})}function drawInit(){require(["dojo/dom","dijit/registry","dojo/_base/lang","dojo/_base/Color","dojo/on","esri/toolbars/draw","esri/graphic","dojo/json","esri/config","esri/map","esri/geometry/Geometry","esri/geometry/Extent","esri/SpatialReference","esri/tasks/GeometryService","esri/tasks/LengthsParameters","esri/tasks/AreasAndLengthsParameters","esri/layers/FeatureLayer","esri/layers/LabelLayer","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/SimpleMarkerSymbol","esri/layers/GraphicsLayer","dijit/form/Select","esri/geometry/Point","esri/geometry/Polyline","esri/geometry/webMercatorUtils","esri/symbols/Font","esri/symbols/TextSymbol","esri/InfoTemplate"],function(e,t,a,n,i,r,o,l,s,p,d,c,y,u,m,w,g,b,h,L,v,f,S,I,E,C,T,x,G){function P(){toolbar.deactivate(),map.enableClickRecenter(),map.enableDoubleClickZoom(),map.showZoomSlider()}function _(){drawing=!0,dragging=!1,closeMenu(),document.getElementById("wayPtsPane").style.display="none",map.infoWindow.hide();var t=!1;detectmob()&&(Y=i(e.byId("mapDiv_layers"),"click",function(e){if(measuring){if(t&&lenGraphicsLayer.clear(),!t){var a=getScreenClick(e),i=new v(v.STYLE_CIRCLE,5,null,new n([255,0,0,1]));i.setOffset(0,-8),lenGraphicsLayer.add(new o(a,i)),t=!0}}else B(e)}))}function k(e){var t=e.result;console.log(l.stringify(t));var a=t.lengths[0].toFixed(1)+" miles";addLabel(labelPoint,a,lenGraphicsLayer,"11pt")}function B(e){if(dragging)dragging=!1;else{e.stopImmediatePropagation&&e.stopImmediatePropagation(),closeAlert(),Y&&Y.remove();var t,a=window.map;if(t=getScreenClick(e),"point"==t.type)addPoint(t,document.getElementById("wayPtInputTitle").value,document.getElementById("wayPtInputDesc").value,O()),a.getScale()>wayPtMaxScale&&(alert("Zooming in to show way points...","",null,!1),a.setScale(wayPtMaxScale),a.centerAt(t));else if("polyline"==t.type){lastPoint=!1,pointAdded=!1,measuring=!1,document.getElementById("removeLengthBtn").style.visibility="visible";var i=new h(h.STYLE_SOLID,new n([255,0,10]),2);lenGraphicsLayer.add(new o(t,i)),labelPoint=new o(new I(t.paths[0][1],a.spatialReference));var r=new m;r.lengthUnit=u.UNIT_STATUTE_MILE,r.calculationType="geodesic",geometryService.simplify([t],function(e){r.polylines=e,geometryService.lengths(r)})}geometryService.on("lengths-complete",k),P(),t=null,drawing=!1}}function O(){var e;return t.byId("pointStyle").value.indexOf("smblue")>-1?e=new v(v.STYLE_CIRCLE,7,new h(h.STYLE_SOLID,new n([0,0,200]),1),new n([0,0,255,.6])):t.byId("pointStyle").value.indexOf("medblue")>-1?e=new v(v.STYLE_CIRCLE,14,new h(h.STYLE_SOLID,new n([0,0,200]),1),new n([0,0,255,.6])):t.byId("pointStyle").value.indexOf("lgblue")>-1?e=new v(v.STYLE_CIRCLE,21,new h(h.STYLE_SOLID,new n([0,0,200]),1),new n([0,0,255,.6])):t.byId("pointStyle").value.indexOf("smgreen")>-1?e=new v(v.STYLE_CIRCLE,7,new h(h.STYLE_SOLID,new n([0,150,5]),1),new n([0,255,0,.6])):t.byId("pointStyle").value.indexOf("medgreen")>-1?e=new v(v.STYLE_CIRCLE,14,new h(h.STYLE_SOLID,new n([0,150,5]),1),new n([0,255,0,.6])):t.byId("pointStyle").value.indexOf("lggreen")>-1?e=new v(v.STYLE_CIRCLE,21,new h(h.STYLE_SOLID,new n([0,150,5]),1),new n([0,255,0,.6])):t.byId("pointStyle").value.indexOf("smgray")>-1?e=new v(v.STYLE_CIRCLE,7,new h(h.STYLE_SOLID,new n([100,100,100]),1),new n([100,100,100,.6])):t.byId("pointStyle").value.indexOf("medgray")>-1?e=new v(v.STYLE_CIRCLE,14,new h(h.STYLE_SOLID,new n([100,100,100]),1),new n([100,100,100,.6])):t.byId("pointStyle").value.indexOf("lggray")>-1?e=new v(v.STYLE_CIRCLE,21,new h(h.STYLE_SOLID,new n([100,100,100]),1),new n([100,100,100,.6])):t.byId("pointStyle").value.indexOf("smred")>-1?e=new v(v.STYLE_CIRCLE,7,new h(h.STYLE_SOLID,new n([255,0,10]),1),new n([255,0,0,.6])):t.byId("pointStyle").value.indexOf("medred")>-1?e=new v(v.STYLE_CIRCLE,14,new h(h.STYLE_SOLID,new n([255,0,10]),1),new n([255,0,0,.6])):t.byId("pointStyle").value.indexOf("lgred")>-1&&(e=new v(v.STYLE_CIRCLE,21,new h(h.STYLE_SOLID,new n([255,0,10]),1),new n([255,0,0,.6]))),e}function D(){if(0!=lenGraphicsCount.length){lenGraphicsCounter--;var e=lenGraphicsCount.pop();map.removeLayer(map.getLayer(e)),0==lenGraphicsCount.length&&(document.getElementById("removeLengthBtn").style.visibility="hidden"),closeMenu()}}var Y,R=new S({name:"pointStyle",id:"pointStyle",labelAttr:"label",options:[{label:"<span class='sprite sprite-ptsmblue'>",value:"smblue"},{label:"<span class='sprite sprite-ptsmgreen'></span>",value:"smgreen"},{label:"<span class='sprite sprite-ptsmgray'></span>",value:"smgray"},{label:"<span class='sprite sprite-ptsmred'></span>",value:"smred"},{type:"separator"},{label:"<span class='sprite sprite-ptmedblue'></span>",value:"medblue"},{label:"<span class='sprite sprite-ptmedgreen'></span>",value:"medgreen"},{label:"<span class='sprite sprite-ptmedgray'></span>",value:"medgray"},{label:"<span class='sprite sprite-ptmedred'></span>",value:"medred"},{type:"separator"},{label:"<span class='sprite sprite-ptlgblue'></span>",value:"lgblue"},{label:"<span class='sprite sprite-ptlggreen'></span>",value:"lggreen"},{label:"<span class='sprite sprite-ptlggray'></span>",value:"lggray"},{label:"<span class='sprite sprite-ptlgred'></span>",value:"lgred"}]},"pointStyleDiv");R.startup(),R.set("value","medblue"),toolbar=new r(map),toolbar.on("draw-end",a.hitch(map,B)),document.getElementById("wayPtForm").addEventListener("submit",function(t){return t.stopImmediatePropagation(),t.preventDefault(),"function"==typeof ga&&ga("send","event","label-wayPt","click","Label | Way Point","1"),"function"==typeof gtag&&gtag("event","widget_click",{widget_name:"Label | Way Point"}),safeInput(e.byId("wayPtInputTitle")),safeInput(e.byId("wayPtInputDesc")),map.disableClickRecenter(),_(),toolbar.activate(r.POINT),map.hideZoomSlider(),map.getScale()>wayPtMaxScale&&(alert("Zooming in to show way points...","",null,!1),map.setScale(wayPtMaxScale)),alert("Tap to add a way point","",null,!1),document.getElementById("wayPtInputDesc").blur(),document.body.focus(),!1}),document.getElementById("lengthBtn").addEventListener("click",function(e){if(toolbar.activate(r.POLYLINE),measuring=!0,"function"==typeof ga&&ga("send","event","draw-measure","click","Draw | Measure","1"),"function"==typeof gtag&&gtag("event","widget_click",{widget_name:"Draw | Measure"}),lenGraphicsCount.length>0){lenGraphicsCounter--;var t=lenGraphicsCount.pop();map.removeLayer(map.getLayer(t))}lenGraphicsLayer=new f,lenGraphicsLayer.id="lengraphics"+lenGraphicsCounter,lenGraphicsCount.push(lenGraphicsLayer.id),lenGraphicsCounter++,map.addLayer(lenGraphicsLayer),map.disableDoubleClickZoom(),_(),map.hideZoomSlider(),alert("Tap to enter 2 or more points. <button data-dojo-type='dojox/mobile/Button' class='mblButton' onclick='toolbar.finishDrawing()'>Done</button>","",null,!1)}),document.getElementById("removeLengthBtn").addEventListener("click",D)})}var toolbar,drawGraphicsLayer,lenGraphicsLayer,labelPoint,drawGraphicsCount=[],lenGraphicsCount=[],drawGraphicsCounter=0,lenGraphicsCounter=0,wayPtMaxScale=4622324.434309,wayPointHelp=null;