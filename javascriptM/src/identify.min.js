function readSettingsWidget(){map.infoWindow.on("hide",function(e){map.infoWindow.setTitle("")}),document.title=app;var e=app+"/SettingsWidget.xml?v="+ndisVer,i=createXMLhttpRequest();i.onreadystatechange=function(){if(4==i.readyState&&200==i.status)try{var e=createXMLdoc(i);settings={};var t=e.getElementsByTagName("use_gmus")[0]&&"true"==e.getElementsByTagName("use_gmus")[0].childNodes[0].nodeValue?1:0;t?(settings.useGMUs=!0,e.getElementsByTagName("gmu_url")[0]?settings.elkUrl=e.getElementsByTagName("gmu_url")[0].childNodes[0].nodeValue:alert("Missing tag: gmu_url in "+app+"/SettingsWidget.xml","Data Error"),e.getElementsByTagName("gmu_field")[0]?settings.elkField=e.getElementsByTagName("gmu_field")[0].childNodes[0].nodeValue:alert("Missing tag: gmu_field in "+app+"/SettingsWidget.xml","Data Error"),e.getElementsByTagName("sheep_gmu_url")[0]?settings.sheepUrl=e.getElementsByTagName("sheep_gmu_url")[0].childNodes[0].nodeValue:alert("Missing tag: sheep_gmu_url in "+app+"/SettingsWidget.xml","Data Error"),e.getElementsByTagName("sheep_gmu_field")[0]?settings.sheepField=e.getElementsByTagName("sheep_gmu_field")[0].childNodes[0].nodeValue:alert("Missing tag: sheep_gmu_field in "+app+"/SettingsWidget.xml","Data Error"),e.getElementsByTagName("goat_gmu_url")[0]?settings.goatUrl=e.getElementsByTagName("goat_gmu_url")[0].childNodes[0].nodeValue:alert("Missing tag: goat_gmu_url in "+app+"/SettingsWidget.xml","Data Error"),e.getElementsByTagName("goat_gmu_field")[0]?settings.goatField=e.getElementsByTagName("goat_gmu_field")[0].childNodes[0].nodeValue:alert("Missing tag: goat_gmu_field in "+app+"/SettingsWidget.xml","Data Error")):settings.useGMUs=!1,require(["dojo/query","dojo/dom-construct","dojo/on","dojo/dom","dojo/domReady!"],function(i,t,a,n){i("div.titleButton.arrow.hidden",map.infoWindow.domNode).on("click",placeIdGroupCombo);t.create("span",{class:"actionList"},map.infoWindow.domNode);t.create("a",{id:"zoomTo",class:"action",innerHTML:"Zoom To",href:"javascript:void(0);"},i(".actionList",map.infoWindow.domNode)[0]),a(i(".actionList #zoomTo")[0],"click",zoomToPt);var r=e.getElementsByTagName("driving_directions")[0]&&"true"==e.getElementsByTagName("driving_directions")[0].childNodes[0].nodeValue?1:0;r&&(t.create("a",{style:"padding-left:20px",class:"action",id:"dirLink",innerHTML:"Directions",href:"javascript:void(0);"},i(".actionList",map.infoWindow.domNode)[0]),a(n.byId("dirLink"),"click",getDirections)),e.getElementsByTagName("elevation")[0]&&e.getElementsByTagName("elevation")[0].firstChild.nodeValue&&(show_elevation="true"==e.getElementsByTagName("elevation")[0].firstChild.nodeValue?1:0),show_elevation&&e.getElementsByTagName("elevation_url")[0]&&(e.getElementsByTagName("elevation_url")[0].firstChild.nodeValue?elevation_url=e.getElementsByTagName("elevation_url")[0].firstChild.nodeValue:alert("Missing elevation_url tag in SettingsWidget.xml.","Data Error")),t.create("div",{class:"action",id:"identifyPoint",innerHTML:"Loading lat, long..."},i(".actionList",map.infoWindow.domNode)[0]),i("div.titleButton.close",map.infoWindow.domNode).on("click",clearContent),a(i("div.esriMobileNavigationItem.left")[0],"click",clearContent)}),folder=e.getElementsByTagName("folder");for(var a=0;a<folder.length;a++){0==a&&(identifyGroup=folder[a].getAttribute("label")),identifyGroups.push(folder[a].getAttribute("label")),identifyLayerIds[identifyGroups[a]]=[];var n=folder[a].getElementsByTagName("layer");identifyLayers[identifyGroups[a]]={},folder[a].getElementsByTagName("desc")[0]&&(identifyLayers[identifyGroups[a]].desc=folder[a].getElementsByTagName("desc")[0].firstChild.nodeValue);for(var r="missing label",o=0;o<n.length;o++){n[o].getAttribute("label")?r=n[o].getAttribute("label"):alert("Error in "+app+"/SettingsWidget.xml. Missing label in folder: "+identifyGroups[a]+".","Data Error"),folder[a].getAttribute("id_vis_only")&&"true"==folder[a].getAttribute("id_vis_only").toLowerCase()&&(n[o].getElementsByTagName("vis_url")[0]&&n[o].getElementsByTagName("vis_id")[0]||alert("Error in "+app+"/SettingsWidget.xml. When vis_id_only is set in a folder, every layer in the folder must have a vis_id and vis_url tag for the layer that is in the map to check if it is visible or not. Missing vis_url and vis_id tags in folder: "+identifyGroups[a]+".","Data Error")),identifyLayers[identifyGroups[a]][r]={},"Wildfire Perimeters"===n[o].getAttribute("label")&&(n[o].getElementsByTagName("irwin_to_inciweb")&&n[o].getElementsByTagName("irwin_to_inciweb")[0]?irwin_to_inciweb_url=n[o].getElementsByTagName("irwin_to_inciweb")[0].childNodes[0].nodeValue:alert("Error in "+app+"/readSettingsWidget.xml. Missing irwin_to_inciweb tag in Wildfire Perimeters layer. This contains the report info."));var s=!1;if(n[o].getElementsByTagName("url")[0]&&n[o].getElementsByTagName("id")[0])for(var d=0;d<identifyLayerIds[identifyGroups[a]].length;d++)folder[a].getAttribute("id_vis_only")&&"true"==folder[a].getAttribute("id_vis_only").toLowerCase()&&identifyLayerIds[identifyGroups[a]][d].url==n[o].getElementsByTagName("url")[0].childNodes[0].nodeValue&&identifyLayerIds[identifyGroups[a]][d].vis_url==n[o].getElementsByTagName("vis_url")[0].childNodes[0].nodeValue&&identifyLayerIds[identifyGroups[a]][d].geometry==n[o].getElementsByTagName("geometry")[0].childNodes[0].nodeValue.toLowerCase()?(identifyLayerIds[identifyGroups[a]][d].ids.push(n[o].getElementsByTagName("id")[0].childNodes[0].nodeValue),identifyLayerIds[identifyGroups[a]][d].vis_ids.push(n[o].getElementsByTagName("vis_id")[0].childNodes[0].nodeValue),s=!0):identifyLayerIds[identifyGroups[a]][d].url==n[o].getElementsByTagName("url")[0].childNodes[0].nodeValue&&identifyLayerIds[identifyGroups[a]][d].geometry==n[o].getElementsByTagName("geometry")[0].childNodes[0].nodeValue.toLowerCase()&&(identifyLayerIds[identifyGroups[a]][d].ids.push(n[o].getElementsByTagName("id")[0].childNodes[0].nodeValue),s=!0);else alert("Error in "+app+"/SettingsWidget.xml. Missing url or id in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error");if(!s)if(n[o].getElementsByTagName("url")[0]&&n[o].getElementsByTagName("id")[0]){var l=null,y=[];folder[a].getAttribute("id_vis_only")&&"true"==folder[a].getAttribute("id_vis_only").toLowerCase()&&(l=n[o].getElementsByTagName("vis_url")[0].childNodes[0].nodeValue,y.push(n[o].getElementsByTagName("vis_id")[0].childNodes[0].nodeValue)),identifyLayerIds[identifyGroups[a]].push({url:n[o].getElementsByTagName("url")[0].childNodes[0].nodeValue,ids:new Array(n[o].getElementsByTagName("id")[0].childNodes[0].nodeValue),geometry:n[o].getElementsByTagName("geometry")[0].childNodes[0].nodeValue.toLowerCase(),id_vis_only:!(!folder[a].getAttribute("id_vis_only")||"true"!=folder[a].getAttribute("id_vis_only").toLowerCase()),vis_url:l,vis_ids:y})}else alert("Error in "+app+"/SettingsWidget.xml. Missing url or id in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error");n[o].getElementsByTagName("database")[0]?(n[o].getElementsByTagName("url")[0]?identifyLayers[identifyGroups[a]][r].url=n[o].getElementsByTagName("url")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing url in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("id")[0]?identifyLayers[identifyGroups[a]][r].id=n[o].getElementsByTagName("id")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing id in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("geometry")[0]?identifyLayers[identifyGroups[a]][r].geometry=n[o].getElementsByTagName("geometry")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing geometry in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("fields")[0]?identifyLayers[identifyGroups[a]][r].fields=n[o].getElementsByTagName("fields")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing fields in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("displaynames")[0]?identifyLayers[identifyGroups[a]][r].displaynames=n[o].getElementsByTagName("displaynames")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing displaynames in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("position")[0]?identifyLayers[identifyGroups[a]][r].position=n[o].getElementsByTagName("position")[0].childNodes[0].nodeValue:identifyLayers[identifyGroups[a]][r].position=0,n[o].getElementsByTagName("database")[0]?identifyLayers[identifyGroups[a]][r].database=n[o].getElementsByTagName("database")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing database in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("filename")[0]?identifyLayers[identifyGroups[a]][r].filename=n[o].getElementsByTagName("filename")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing filename in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("one2one_fields")[0]&&n[o].getElementsByTagName("one2one_fields")[0].childNodes.length>0&&(identifyLayers[identifyGroups[a]][r].one2one_fields=n[o].getElementsByTagName("one2one_fields")[0].childNodes[0].nodeValue.split(",")),n[o].getElementsByTagName("one2one_display")[0]&&n[o].getElementsByTagName("one2one_display")[0].childNodes.length>0&&(identifyLayers[identifyGroups[a]][r].one2one_display=n[o].getElementsByTagName("one2one_display")[0].childNodes[0].nodeValue.split(",")),n[o].getElementsByTagName("one2many_fields")[0]&&n[o].getElementsByTagName("one2many_fields")[0].childNodes.length>0&&(identifyLayers[identifyGroups[a]][r].one2many_fields=n[o].getElementsByTagName("one2many_fields")[0].childNodes[0].nodeValue.split(","))):(n[o].getElementsByTagName("url")[0]?identifyLayers[identifyGroups[a]][r].url=n[o].getElementsByTagName("url")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing url in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("id")[0]?identifyLayers[identifyGroups[a]][r].id=n[o].getElementsByTagName("id")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing id in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("geometry")[0]?identifyLayers[identifyGroups[a]][r].geometry=n[o].getElementsByTagName("geometry")[0].childNodes[0].nodeValue:alert("Error in "+app+"/SettingsWidget.xml. Missing geometry in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("fields")[0]?identifyLayers[identifyGroups[a]][r].fields=n[o].getElementsByTagName("fields")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing fields in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),n[o].getElementsByTagName("displaynames")[0]?identifyLayers[identifyGroups[a]][r].displaynames=n[o].getElementsByTagName("displaynames")[0].childNodes[0].nodeValue.split(","):alert("Error in "+app+"/SettingsWidget.xml. Missing displaynames in folder: "+identifyGroups[a]+" for layer: "+r+".","Data Error"),"Big Game GMU Boundaries"==r&&(identifyLayers[identifyGroups[a]]["Bighorn GMU"]={},identifyLayers[identifyGroups[a]]["Bighorn GMU"].url=settings.sheepUrl.slice(0,settings.sheepUrl.length-2),identifyLayers[identifyGroups[a]]["Bighorn GMU"].id=settings.sheepUrl.slice(settings.sheepUrl.length-1),identifyLayers[identifyGroups[a]]["Bighorn GMU"].geometry="polygon",identifyLayers[identifyGroups[a]]["Bighorn GMU"].fields=[settings.sheepField],identifyLayers[identifyGroups[a]]["Bighorn GMU"].displaynames=["GMU Number"],identifyLayers[identifyGroups[a]]["Goat GMU"]={},identifyLayers[identifyGroups[a]]["Goat GMU"].url=settings.goatUrl.slice(0,settings.goatUrl.length-2),identifyLayers[identifyGroups[a]]["Goat GMU"].id=settings.goatUrl.slice(settings.goatUrl.length-1),identifyLayers[identifyGroups[a]]["Goat GMU"].geometry="polygon",identifyLayers[identifyGroups[a]]["Goat GMU"].fields=[settings.goatField],identifyLayers[identifyGroups[a]]["Goat GMU"].displaynames=["GMU Number"]))}}setIdGroupCombo(),document.getElementById("loading").style.display="none"}catch(e){alert("Error reading "+app+"/SettingsWidget.xml in javascriptM/identify.js readSettingsWidget(): "+e.message,"Data Error",e),hideLoading("")}else 404===i.status?(alert("Error: Missing "+app+"/settingsWidget.xml file.","Data Error"),hideLoading()):4===i.readyState&&500===i.status&&(alert("Error reading "+app+"/settingsWidget.xml.","Code Error"),hideLoading())},i.open("GET",e,!0),i.send()}function clearContent(){map.infoWindow.setContent(""),map.infoWindow.setTitle(""),map.getLayer("mapDiv_graphics")&&map.removeLayer(map.getLayer("mapDiv_graphics"))}function doIdentify(e){if(e.Event&&(e=e.Event),!measuring)if(drawing)drawing=!1;else if(!dragging){var i=this;if(i.infoWindow.isShowing&&!i.infoWindow.wayPt)return i.infoWindow.hide(),i.infoWindow.setTitle(""),hideLoading(""),void(-1!=navigator.userAgent.indexOf("Android")&&e.stopImmediatePropagation());require(["dojo/dom-construct","dojo/query","dojo/dom","dojo/on","dojo/domReady!"],function(t,a,n,r){if("function"==typeof ga&&ga("send","event","identify","click","Identify","1"),"function"==typeof gtag&&gtag("event","widget_click",{widget_name:"Identify"}),clickPoint=getScreenClick(e),i.infoWindow.isShowing&&!i.infoWindow.wayPt&&lastTitle==i.infoWindow._title.innerHTML)return i.infoWindow.hide(),-1!=navigator.userAgent.indexOf("Android")&&e.stopImmediatePropagation(),void i.emit("click",{bubbles:!0,cancelable:!0,Event:e});-1==navigator.userAgent.indexOf("Android")||""!=i.infoWindow._title.innerHTML&&"No Information"!=i.infoWindow._title.innerHTML||e.stopImmediatePropagation(),i.infoWindow.wayPt=!1,numDatabaseCalls=0,processedDatabaseCalls=0,features=[],theEvt=e,showLoading(),groupContent["Way Point"]&&delete groupContent["Way Point"];for(var o=0;o<identifyGroups.length;o++)groupContent[identifyGroups[o]]=null;if(""!=i.infoWindow._title.innerHTML&&"No Information"!=i.infoWindow._title.innerHTML){"Way Point"!=identifyGroup&&(lastIDGroup=identifyGroup),identifyGroup="Way Point",groupContent["Way Point"]=i.infoWindow._contentPane.innerHTML,null==idGroupCombo.getOptions("Way Point")&&(idGroupCombo.addOption({value:"Way Point",label:"Way Point"}),idGroupCombo.startup()),idGroupCombo.set("displayedValue","Way Point");var s="onorientationchange"in window,d=s?"orientationchange":"resize";window.addEventListener(d,function(){document.getElementById("wayPtDesc")&&(showLoading(),setTimeout(resizeTextBox(document.getElementById("wayPtDesc")),500))},!1),lastTitle=i.infoWindow._title.innerHTML}else i.infoWindow.hide(),i.infoWindow.setTitle("Loading..."),i.infoWindow.setContent("<p align='center'>Loading...</p>"),"Way Point"===identifyGroup&&(identifyGroup=lastIDGroup),idGroupCombo.getOptions("Way Point")&&idGroupCombo.removeOption("Way Point");n.byId("identifyPoint").innerHTML="Loading lat, long...",elevation_url&&(a(".actionList #elevation",i.infoWindow.domNode)[0]?(t.empty(a(".actionList #elevation",i.infoWindow.domNode)[0]),t.place(t.toDom("Elevation: loading..."),a(".actionList #elevation",i.infoWindow.domNode)[0])):t.create("span",{class:"action",id:"elevation",innerHTML:"Elevation: loading..."},a(".actionList",i.infoWindow.domNode)[0])),showIdentify(),displayContent()})}}function displayContent(){require(["esri/tasks/IdentifyTask","dojo/promise/all","dojo/Deferred","esri/tasks/query","esri/tasks/QueryTask"],function(e,i,t,a,n){if(groupContent[identifyGroup])return map.infoWindow.setContent(groupContent[identifyGroup]),"Way Point"==identifyGroup&&document.getElementById("wayPtDesc")&&resizeTextBox(document.getElementById("wayPtDesc")),getIdentifyFooter(),void hideLoading("");var r;identifyParams.geometry=clickPoint,identifyParams.mapExtent=map.extent,identifyParams.width=map.width,identifyParams.height=map.height;for(var o=-1,s=[],d=0;d<identifyLayerIds[identifyGroup].length;d++){var l=identifyLayerIds[identifyGroup][d];if(l){if(l.url.indexOf("Wildfire")>-1){for(var y=map.getLayersVisibleAtScale(),f=0,u=0;u<y.length;u++)if(y[u].id.indexOf("Wildfire")>-1){f=1;break}if(!f){alert("Cannot display incident report at this time. The external map service that provides Wildfire Perimeters is experiencing problems. This issue is out of CPW control. We will make the National Interagency Fire Center aware of this issue.","Notice");continue}r=new n(l.url);var m=new a;identifyLayers[identifyGroup][identifyGroup].url===r.url?m.outFields=identifyLayers[identifyGroup][identifyGroup].fields:identifyLayers[identifyGroup]["Wildfire Incidents"].url===r.url?(m.outFields=identifyLayers[identifyGroup]["Wildfire Incidents"].fields,m.distance=2,m.units="miles"):alert("In SettingsWidget.xml tag Wildfire Perimeters folder, must contain layers with the following names: Wildfire Perimeters or Wildfire Incidents.","Data Error"),m.geometry=clickPoint,m.returnGeometry=!0,m.spatialRelationship="esriSpatialRelIntersects",m.outSpatialReference=map.spatialReference,o=!0,s.push(r.execute(m,identifySuccess,handleQueryError));continue}if(identifyParams.layerIds=l.ids.slice(),"polygon"!=l.geometry?map.getScale()<=36112?identifyParams.tolerance=25:map.getScale()<=288895?identifyParams.tolerance=20:identifyParams.tolerance=10:identifyParams.tolerance=1,l.id_vis_only){r=new e(l.vis_url);var g=map.getLayersVisibleAtScale(map.getScale()),p=l.vis_url;"/"==l.vis_url[l.vis_url.length-1]&&(p=l.vis_url.substr(0,l.vis_url.length-1));var c=[];identifyParams.layerIds=l.vis_ids.slice(),g.forEach(function(e){if(e.url==p)if(1==e.visible){o=!1;for(var i=0;i<identifyParams.layerIds.length;i++)for(var t=identifyParams.layerIds[i];1==e.layerInfos[t].visible;){if(-1==e.layerInfos[t].parentLayerId){c.push(identifyParams.layerIds[i]);break}t=e.layerInfos[t].parentLayerId}identifyParams.layerIds=c}else-1==o&&(o=!0)})}else o=!1,r=new e(l.url);if(settings.elkUrl&&l.url==settings.elkUrl.slice(0,settings.elkUrl.lastIndexOf("/")+1)&&"Big Game GMU"!=gmu){var h=identifyParams.layerIds.indexOf(settings.elkUrl.slice(settings.elkUrl.lastIndexOf("/")+1));h>-1&&identifyParams.layerIds.splice(h,1)}0==identifyParams.layerIds.length&&(o=!0),o||s.push(r.execute(identifyParams,identifySuccess,handleQueryError))}}if("GMU and Land Management"===identifyGroup&&("Bighorn GMU"==gmu?(identifyParams.tolerance=1,identifyParams.layerIds=[settings.sheepUrl.slice(settings.sheepUrl.lastIndexOf("/")+1)],r=new e(settings.sheepUrl.slice(0,settings.sheepUrl.lastIndexOf("/")+1)),s.push(r.execute(identifyParams,identifySuccess,handleQueryError))):"Goat GMU"==gmu&&(identifyParams.tolerance=1,identifyParams.layerIds=[settings.goatUrl.slice(settings.goatUrl.lastIndexOf("/")+1)],r=new e(settings.goatUrl.slice(0,settings.goatUrl.lastIndexOf("/")+1)),s.push(r.execute(identifyParams,identifySuccess,handleQueryError)))),s&&s.length>0){var N=i(s);N.then(handleQueryResults)}else numDatabaseCalls=0,processedDatabaseCalls=0,features=[],title="No "+identifyGroup,map.infoWindow.setTitle(title),displayInfoWindow()})}function identifySuccess(e){}function handleQueryError(e){e.details?alert("Error in identify.js/doIdentify.  "+e.details+" "+e.message+" Check SettingsWidget.xml urls.","Data Error"):alert("Error in identify.js/doIdentify.  "+e.message+" Check SettingsWidget.xml urls.","Data Error"),hideLoading("")}function handleQueryResults(e){try{function i(e){for(r=0;r<e.length;r++)if(e[r]&&e[r].length>0)for(o=0;o<e[r].length;o++)if(identifyLayers[identifyGroup][e[r][o].layerName])return void(s=!1)}if(!e)return void alert("Error in identify.js/handleQueryResults. IdentifyTask returned null.","Data Error");var t,a,n=getIdentifyHeader(identifyGroup);if("Wildfire Perimeters"==identifyGroup)return void require(["esri/tasks/query","esri/tasks/QueryTask"],function(i,r){var o;if(0==e[0].features.length&&0==e[1].features.length)return a="No "+identifyGroup,map.infoWindow.setTitle(a),getIdentifyFooter(),map.infoWindow.setContent("No Wildfire Perimeters/Incidents at this point.<br/><br/>"),groupContent[identifyGroup]="No Wildfire Perimeters/Incidents at this point.",void hideLoading("");o=e[0].features.length>0?0:1,a=e[o].features[0].attributes.IncidentName,map.infoWindow.setTitle(a),t=e[o].features[0].attributes.IncidentName+"</strong><div style='padding-left: 10px;'>";var s,d=new r(irwin_to_inciweb_url),l=new i;s=0==o?e[o].features[0].attributes.IRWINID.substr(1,e[o].features[0].attributes.IRWINID.length-2).toLocaleLowerCase():e[o].features[0].attributes.IrwinID.substr(1,e[o].features[0].attributes.IrwinID.length-2).toLocaleLowerCase(),l.where="IrwinID='"+s+"'",l.outFields=["LinkURI","IrwinID"],l.returnGeometry=!1,d.execute(l,function(e){0!=e.features.length&&e.features[0].attributes&&e.features[0].attributes.LinkURI?t+="<br/><a href='"+e.features[0].attributes.LinkURI+"' target='_blank'>Incident Report</a>":t+="<br/>No incident report found",t+="</div><br/>",n+="<div><strong>"+t,groupContent[identifyGroup]=n,map.infoWindow.setContent(n),getIdentifyFooter(),hideLoading("")},function(e){alert("Error in javascript/identify.js/handleQueryResults/queryTask.execute, url="+queryLayer+". Where irwinID='"+s+"'. Error message: "+e.message,"Code Error",e)})});for(theResults=e,e.forEach(function(e){e&&e.length>0&&e.forEach(function(e){void 0!==identifyLayers[identifyGroup][e.layerName]&&void 0!==identifyLayers[identifyGroup][e.layerName].database&&numDatabaseCalls++})}),index=0;XMLHttpRequestObjects.length>0;)XMLHttpRequestObjects.pop();var r,o,s=!0;if(i(e),s)a="No "+identifyGroup;else if("WATERCODE"==e[r][o].displayFieldName){a="";for(var d=0;d<e[r].length;d++)if("ALL LAKES"==e[r][d].layerName.toUpperCase()){a=e[r][d].value;break}""==a&&(a=e[r][o].layerName)}else a="LOC_ID"==e[r][o].displayFieldName?e[r][o].layerName:"GMUID"==e[r][o].displayFieldName?"GMU "+e[r][o].feature.attributes[e[r][o].displayFieldName]:-1!=e[r][o].layerName.indexOf("Land Management")&&""==e[r][o].feature.attributes[e[r][o].displayFieldName]?e[r][o].feature.attributes.MANAGER:e[r][o].layerName.indexOf("Mule Deer")>-1?"Mule Deer Ranges":e[r][o].layerName.indexOf("Elk")>-1?"Elk Ranges":e[r][o].layerName.indexOf("BLM Colorado Roads and Trails")>-1?"Null"!=e[r][o].feature.attributes["Route Primary Name"]&&""!=e[r][o].feature.attributes["Route Primary Name"].trim()?e[r][o].feature.attributes["Route Primary Name"]:"Null"!=e[r][o].feature.attributes["Route Primary Number"]&&""!=e[r][o].feature.attributes["Route Primary Number"].trim()?e[r][o].feature.attributes["Route Primary Number"]:e[r][o].feature.attributes[e[r][o].displayFieldName]:e[r][o].feature.attributes[e[r][o].displayFieldName];map.infoWindow.setTitle(a),lastTitle=a,e.forEach(function(e){e.length>0&&e.forEach(function(e){var i,a=e.feature;if(a.attributes.layerName=e.layerName,void 0!==identifyLayers[identifyGroup][e.layerName])if(void 0!==identifyLayers[identifyGroup][e.layerName].database)try{createMultiXMLhttpRequest();var s=app+"/"+identifyLayers[identifyGroup][e.layerName].database+"?v="+ndisVer+"&key="+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[0]];XMLHttpRequestObjects[index].open("GET",s,!0),XMLHttpRequestObjects[index].onreadystatechange=(i=index,function(){if(4==XMLHttpRequestObjects[i].readyState){if(200==XMLHttpRequestObjects[i].status){t=e.layerName+"</strong><div style='padding-left: 10px;'>";var a=createXMLdoc(XMLHttpRequestObjects[i]);for(f=0;f<identifyLayers[identifyGroup][e.layerName].displaynames.length;f++)if(f>0&&e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[f]]&&" "!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[f]]&&"Null"!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[f]]&&""!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[f]]&&("http"==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[f]].substring(0,4)?t+="<a href='"+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[f]]+"' target='_blank'>"+identifyLayers[identifyGroup][e.layerName].displaynames[f]+"</a>":"<a href"==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[f]].substring(0,7)&&-1==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[f]].indexOf("target")?t+=identifyLayers[identifyGroup][e.layerName].displaynames[f]+": "+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[f]].replace(">"," target='_blank'>"):t+=identifyLayers[identifyGroup][e.layerName].displaynames[f]+": "+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[f]],t+="<br/>"),identifyLayers[identifyGroup][e.layerName].position==f){if(void 0!==identifyLayers[identifyGroup][e.layerName].one2one_fields)for(o=0;o<identifyLayers[identifyGroup][e.layerName].one2one_fields.length;o++)if(a.getElementsByTagName(identifyLayers[identifyGroup][e.layerName].one2one_fields[o]).length>0){var r=a.getElementsByTagName(identifyLayers[identifyGroup][e.layerName].one2one_fields[o])[0];r.getElementsByTagName("linkname").length>0&&r.getElementsByTagName("linkurl").length>0?(t+=identifyLayers[identifyGroup][e.layerName].one2one_display[o]+": ",t+="<a href='"+r.getElementsByTagName("linkurl")[0].firstChild.nodeValue+"'>"+r.getElementsByTagName("linkname")[0].firstChild.nodeValue+"</a>",t+="<br/>"):r.childNodes.length>0&&(t+=identifyLayers[identifyGroup][e.layerName].one2one_display[o]+": ",t+=r.childNodes[0].nodeValue,t+="<br/>")}if(void 0!==identifyLayers[identifyGroup][e.layerName].one2many_fields)for(o=0;o<identifyLayers[identifyGroup][e.layerName].one2many_fields.length;o++){var d=a.getElementsByTagName(identifyLayers[identifyGroup][e.layerName].one2many_fields[o]);t+=identifyLayers[identifyGroup][e.layerName].displaynames[0]+":<ul style='margin-top: 0px; margin-bottom: 0px;'>";for(var l=0;l<d.length;l++)d[l].getElementsByTagName("linkname").length>0&&d[l].getElementsByTagName("linkurl").length>0?t+="<li><a href='"+d[l].getElementsByTagName("linkurl")[0].firstChild.nodeValue+"' target='_blank'>"+d[l].getElementsByTagName("linkname")[0].firstChild.nodeValue+"</a></li>":t+="<li>"+d[l].childNodes[0].nodeValue+"</li>";t+="</ul style='margin-bottom: 0px; margin-top: 0px;'>"}}t+="</div><br/>",processedDatabaseCalls++,-1==n.indexOf(t)&&(n+="<div><strong>"+t,groupContent[identifyGroup]=n,map.infoWindow.setContent(n)),features.push(e.feature)}else 404==XMLHttpRequestObjects[i].status?(alert("Identify failed. File not found: "+s,"Data Error"),processedDatabaseCalls=numDatabaseCalls,displayInfoWindow()):(alert("Identify failed for call to "+s+". Make sure it exists and does not have errors. Must be in the same directory as index.html or a lower directory. XMLHttpRequestObjects["+i+"].status was "+XMLHttpRequestObjects[i].status,"Data Error"),processedDatabaseCalls=numDatabaseCalls,displayInfoWindow());for(var y=!0,f=0;f<numDatabaseCalls;f++)if(!XMLHttpRequestObjects[f]||4!==XMLHttpRequestObjects[f].readyState){y=!1;break}y&&displayInfoWindow()}}),XMLHttpRequestObjects[index].send()}catch(i){alert("Identify on "+e.layerName+" failed with error: "+i.message+" in javascript/identify.js handleQueryResults().","Data Error"),console.log(i.message),hideLoading("")}else{t=e.layerName+"</strong><div style='padding-left: 10px;'>";var d=!0;for(r=0;r<identifyLayers[identifyGroup][e.layerName].displaynames.length;r++)e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[r]]&&" "!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[r]]&&"Null"!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[r]]&&""!==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[r]]&&(d?d=!1:t+="<br/>","http"==e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[r]].substring(0,4)?t+="<a href='"+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[r]]+"' target='_blank'>"+identifyLayers[identifyGroup][e.layerName].displaynames[r]+"</a>":t+=identifyLayers[identifyGroup][e.layerName].displaynames[r]+": "+e.feature.attributes[identifyLayers[identifyGroup][e.layerName].fields[r]]);t+="</div></div><br/>",-1==n.indexOf(t)&&(n+="<div><strong>"+t,groupContent[identifyGroup]=n,map.infoWindow.setContent(n)),features.push(e.feature)}})}),displayInfoWindow()}catch(e){alert(e.message+" in javascript/identify.js handleQueryResults().","Code Error",e)}}function highlightFeature(e){require(["esri/graphic","esri/layers/GraphicsLayer"],function(i,t){var a;"polygon"===features[e].geometry.type?a=polySymbol:"point"===features[e].geometry.type?a=pointSymbol:"line"===features[e].geometry.type&&(a=lineSymbol);var n=newGraphicsLayer();n.id="identifygraphics";for(var r=0;r<features.length;r++)features[r].attributes.layerName==features[e].attributes.layerName&&n.add(new i(features[e].geometry,a));map.addLayer(n),n=null,a=null})}function removeHighlight(){map.getLayer("identifygraphics")&&map.removeLayer(map.getLayer("identifygraphics"))}function showIdentify(){map.infoWindow.show(clickPoint),map.getLayer("mapDiv_graphics")&&map.getLayer("mapDiv_graphics").clear(),require(["dojo/query"],function(e){if(e(".top")&&e(".top")[0].outerHTML.indexOf("hidden")>-1){var i=parseInt(e(".esriPopupMobile")[0].style.top)-addToTop;e(".esriPopupMobile")[0].style.top=i+"px"}})}function getIdentifyHeader(e){return identifyLayers[e].desc?"<div class='esriPopupItemTitle'>"+e+" found at map click:</div><br/><p style='font-style:italic;top:-15px;position:relative;'>"+identifyLayers[e].desc+"</p>":"<div class='esriPopupItemTitle'>"+e+" found at map click:</div>"}function getIdentifyFooter(){require(["esri/geometry/webMercatorUtils","esri/SpatialReference","esri/tasks/ProjectParameters","esri/tasks/GeometryService","dojo/dom"],function(e,i,t,a,n){try{var r;r=e.webMercatorToGeographic(clickPoint),n.byId("identifyPoint").innerHTML="Lat Long: "+r.y.toFixed(5)+" N, "+r.x.toFixed(5)+" W",displayElevation()}catch(e){alert(e.message+" in javascript/identify.js getIdentifyFooter().","Code Error",e)}})}function displayElevation(){elevation_url&&require(["esri/request"],function(e){var i='{"xmin":'+map.extent.xmin+',"ymin":'+map.extent.ymin+',"xmax":'+map.extent.xmax+',"ymax":'+map.extent.ymax+',"spatialReference":{"wkid":102100,"latestWkid":102100}}',t=e({url:elevation_url+"/identify",content:{f:"json",geometry:JSON.stringify(clickPoint),geometryType:"esriGeometryPoint",tolerance:"5",mapExtent:i,sr:"102100",imageDisplay:map.width+","+map.height+",96",returnGeometry:!1},handleAs:"json",callbackParamName:"callback"});t.then(function(e){require(["dojo/dom-attr","dojo/dom-construct","dojo/query","dojo/dom","dojo/on","dojo/domReady!"],function(i,t,a,n,r){0==e.results.length||isNaN(e.results[0].attributes["Pixel Value"])?a(".actionList #elevation",map.infoWindow.domNode)[0]?(t.empty(a(".actionList #elevation",map.infoWindow.domNode)[0]),t.place(t.toDom("Elevation: data not available"),a(".actionList #elevation",map.infoWindow.domNode)[0])):t.create("span",{class:"action",id:"elevation",innerHTML:"Elevation: data not available"},a(".actionList",map.infoWindow.domNode)[0]):a(".actionList #elevation",map.infoWindow.domNode)[0]?(t.empty(a(".actionList #elevation",map.infoWindow.domNode)[0]),t.place(t.toDom("Elevation: "+Math.round(e.results[0].attributes["Pixel Value"])+" ft "+Math.round(.3048*e.results[0].attributes["Pixel Value"])+" m"),a(".actionList #elevation",map.infoWindow.domNode)[0])):t.create("span",{class:"action",id:"elevation",innerHTML:"Elevation: "+Math.round(e.results[0].attributes["Pixel Value"])+" ft "+Math.round(.3048*e.results[0].attributes["Pixel Value"])+" m"},a(".actionList",map.infoWindow.domNode)[0])})},function(e){require(["dojo/dom-attr","dojo/dom-construct","dojo/query","dojo/dom","dojo/on","dojo/domReady!"],function(e,i,t,a,n){
t(".actionList #elevation",map.infoWindow.domNode)[0]?(i.empty(t(".actionList #elevation",map.infoWindow.domNode)[0]),i.place(i.toDom("Elevation: data not available"),t(".actionList #elevation",map.infoWindow.domNode)[0])):i.create("span",{class:"action",id:"elevation",innerHTML:"Elevation: data not available"},t(".actionList",map.infoWindow.domNode)[0])}),hideLoading("")})})}function changeIdentifyGroup(e){identifyGroup=e.get("displayedValue"),map.infoWindow.setContent("<p align='center'>Loading...</p>"),features=[],numDatabaseCalls=0,processedDatabaseCalls=0,displayContent()}function setIdGroupCombo(){require(["dojo/store/Memory","dijit/form/Select"],function(e,i){for(var t=[],a=0;a<identifyGroups.length;a++)t.push({value:identifyGroups[a],label:identifyGroups[a]});idGroupCombo=new i({id:"idGroup",name:"feature",value:identifyGroup,sortByLabel:!1,labelAttr:"name",maxHeight:-1,style:{height:"36px!important",lineHeight:"22px",fontSize:"17px",color:"black",position:"absolute",top:"0px",left:"40px",display:"block"},onChange:function(){changeIdentifyGroup(this)}},"idGroup"),idGroupCombo.set("options",t),idGroupCombo.startup()})}function placeIdGroupCombo(){require(["dojo/dom-construct","dojo/query","dojo/dom-class","dijit/registry"],function(e,i,t,a){map.infoWindow.setContent(groupContent[identifyGroup]),"Way Point"==identifyGroup&&document.getElementById("wayPtDesc")?(resizeTextBox(document.getElementById("wayPtDesc")),i("div.esriMobileNavigationBar",map.domNode)[0].style.overflow="visible",i("div.esriMobileNavigationItem.center",map.domNode)[0].style.display="none",e.place(idGroupCombo.domNode,i("div.esriMobileNavigationItem.center",map.domNode)[0],"before"),a.byId("idGroup").attr("displayedValue","Way Point"),i("div.esriMobileNavigationItem.right1",map.domNode)[0].className="esriMobileNavigationItem right1 hidden",i("div.esriMobileNavigationItem.right2",map.domNode)[0].className="esriMobileNavigationItem right2 hidden",document.getElementById("wayPtDesc")&&(document.getElementById("wayPtDesc").style.height="auto",document.getElementById("wayPtDesc").style.height=document.getElementById("wayPtDesc").scrollHeight+"px")):i("div.esriMobileNavigationItem.center",map.domNode).length>0&&(i("div.esriMobileNavigationItem.center",map.domNode)[0].style.display="none",i("div.esriMobileNavigationItem.right1",map.domNode)[0].className="esriMobileNavigationItem right1 hidden",i("div.esriMobileNavigationItem.right2",map.domNode)[0].className="esriMobileNavigationItem right2 hidden",e.place(idGroupCombo.domNode,i("div.esriMobileNavigationItem.center",map.domNode)[0],"before"),a.byId("idGroup").attr("displayedValue",identifyGroup))})}function displayInfoWindow(){if(numDatabaseCalls==processedDatabaseCalls){if(numDatabaseCalls=0,processedDatabaseCalls=0,getIdentifyFooter(),0==features.length){var e,i="";identifyLayerIds[identifyGroup][0].id_vis_only&&(i="visible "),identifyLayers[identifyGroup].desc?(e="<div><p style='font-style:italic;top:-15px;position:relative;'>"+identifyLayers[identifyGroup].desc+"</p>No "+i+identifyGroup+" at this point.<br/><br/></div>",groupContent[identifyGroup]=e):(e="<br/><div>No "+i+identifyGroup+" at this point.<br/><br/></div>",groupContent[identifyGroup]=e),map.infoWindow.setContent(e)}showIdentify(),hideLoading("")}}function getDirections(e){require(["esri/geometry/webMercatorUtils"],function(e){var i=e.webMercatorToGeographic(clickPoint),t="http://google.com/maps?output=classic&q="+i.y+","+i.x;window.open(t,"_blank")})}function zoomToPt(){var e=5;map.getLevel()>5&&(e=map.getLevel()),map.centerAndZoom(clickPoint,e)}var tasks,clickPoint,identifyGroup,theEvt,theResults,polySymbol,pointSymbol,lineSymbol,idGroupCombo,identifyParams=null,features=[],numDatabaseCalls=0,processedDatabaseCalls=0,folder=[],identifyGroups=[],identifyLayers={},groupContent={},identifyLayerIds=[],elevation_url=null,show_elevation=!1,addToTop=30,lastTitle="",lastIDGroup="",irwin_to_inciweb_url="";require(["esri/tasks/IdentifyParameters","esri/symbols/SimpleLineSymbol","esri/symbols/SimpleFillSymbol","esri/symbols/PictureMarkerSymbol","dojo/_base/Color"],function(e,i,t,a,n){identifyParams=new e,identifyParams.tolerance=5,identifyParams.returnGeometry=!0,identifyParams.layerOption=e.LAYER_OPTION_ALL,polySymbol=new t(t.STYLE_SOLID,new i(i.STYLE_SOLID,new n([255,0,0]),1),new n([125,125,125,.35])),pointSymbol=new a("assets/images/i_flag.png",40,40),lineSymbol=new i(i.STYLE_SOLID,new n([255,0,10]),1)});